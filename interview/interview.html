<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>interview</title><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-require-zoom-fix foreignobject { font-size: var(--mermaid-font-zoom); }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
  --mermaid-theme: night;
  --node-fill: #BDD5EA;
}

[lang='mermaid'] .label {
  color: #333;
}

/* CSS Document */

/** code highlight */

.cm-s-inner .cm-variable,
.cm-s-inner .cm-operator,
.cm-s-inner .cm-property {
    color: #b8bfc6;
}

.cm-s-inner .cm-keyword {
    color: #C88FD0;
}

.cm-s-inner .cm-tag {
    color: #7DF46A;
}

.cm-s-inner .cm-attribute {
    color: #7575E4;
}

.CodeMirror div.CodeMirror-cursor {
    border-left: 1px solid #b8bfc6;
    z-index: 3;
}

.cm-s-inner .cm-string {
    color: #D26B6B;
}

.cm-s-inner .cm-comment,
.cm-s-inner.cm-comment {
    color: #DA924A;
}

.cm-s-inner .cm-header,
.cm-s-inner .cm-def,
.cm-s-inner.cm-header,
.cm-s-inner.cm-def {
    color: #8d8df0;
}

.cm-s-inner .cm-quote,
.cm-s-inner.cm-quote {
    color: #57ac57;
}

.cm-s-inner .cm-hr {
    color: #d8d5d5;
}

.cm-s-inner .cm-link {
    color: #d3d3ef;
}

.cm-s-inner .cm-negative {
    color: #d95050;
}

.cm-s-inner .cm-positive {
    color: #50e650;
}

.cm-s-inner .cm-string-2 {
    color: #f50;
}

.cm-s-inner .cm-meta,
.cm-s-inner .cm-qualifier {
    color: #b7b3b3;
}

.cm-s-inner .cm-builtin {
    color: #f3b3f8;
}

.cm-s-inner .cm-bracket {
    color: #997;
}

.cm-s-inner .cm-atom,
.cm-s-inner.cm-atom {
    color: #84B6CB;
}

.cm-s-inner .cm-number {
    color: #64AB8F;
}

.cm-s-inner .cm-variable {
    color: #b8bfc6;
}

.cm-s-inner .cm-variable-2 {
    color: #9FBAD5;
}

.cm-s-inner .cm-variable-3 {
    color: #1cc685;
}

.CodeMirror-selectedtext,
.CodeMirror-selected {
    background: #4a89dc;
    color: #fff !important;
    text-shadow: none;
}

.CodeMirror-gutters {
    border-right: none;
}

/* CSS Document */

/** markdown source **/
.cm-s-typora-default .cm-header, 
.cm-s-typora-default .cm-property
{
    color: #cebcca;
}

.CodeMirror.cm-s-typora-default div.CodeMirror-cursor{
    border-left: 3px solid #b8bfc6;
}

.cm-s-typora-default .cm-comment {
    color: #9FB1FF;
}

.cm-s-typora-default .cm-string {
    color: #A7A7D9
}

.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number {
    color: #848695;
    font-style: italic;
}

.cm-s-typora-default .cm-link {
    color: #95B94B;
}

.cm-s-typora-default .CodeMirror-activeline-background {
    background: rgba(51, 51, 51, 0.72);
}

.cm-s-typora-default .cm-comment, .cm-s-typora-default .cm-code {
	color: #8aa1e1;
}@import "";
@import "";
@import "";

:root {
    --bg-color:  #363B40;
    --side-bar-bg-color: #2E3033;
    --text-color: #b8bfc6;

    --select-text-bg-color:#4a89dc;

    --item-hover-bg-color: #0a0d16;
    --control-text-color: #b7b7b7;
    --control-text-hover-color: #eee;
    --window-border: 1px solid #555;

    --active-file-bg-color: rgb(34, 34, 34);
    --active-file-border-color: #8d8df0;

    --primary-color: #a3d5fe;

    --active-file-text-color: white;
    --item-hover-bg-color: #70717d;
    --item-hover-text-color: white;
    --primary-color: #6dc1e7;

    --rawblock-edit-panel-bd: #333;

    --search-select-bg-color: #428bca;
}

html {
    font-size: 16px;
}

html,
body {
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
    background: #363B40;
    background: var(--bg-color);
    fill: currentColor;
    line-height: 1.625rem;
}

#write {
    max-width: 914px;
}


@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

html,
body,
button,
input,
select,
textarea,
div.code-tooltip-content {
    color: #b8bfc6;
    border-color: transparent;
}

div.code-tooltip,
.md-hover-tip .md-arrow:after {
    background: #333;
}

.popover.bottom > .arrow:after {
    border-bottom-color: #333;
}

html,
body,
button,
input,
select,
textarea {
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}

hr {
    height: 2px;
    border: 0;
    margin: 24px 0 !important;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    font-family: "Lucida Grande", "Corbel", sans-serif;
    font-weight: normal;
    clear: both;
    -ms-word-wrap: break-word;
    word-wrap: break-word;
    margin: 0;
    padding: 0;
    color: #DEDEDE
}

h1 {
    font-size: 2.5rem;
    /* 36px */
    line-height: 2.75rem;
    /* 40px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1.5px;
}

h2 {
    font-size: 1.63rem;
    /* 24px */
    line-height: 1.875rem;
    /* 30px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1px;
    font-weight: bold;
}

h3 {
    font-size: 1.17rem;
    /* 18px */
    line-height: 1.5rem;
    /* 24px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1px;
    font-weight: bold;
}

h4 {
    font-size: 1.12rem;
    /* 16px */
    line-height: 1.375rem;
    /* 22px */
    margin-bottom: 1.5rem;
    /* 24px */
    color: white;
}

h5 {
    font-size: 0.97rem;
    /* 16px */
    line-height: 1.25rem;
    /* 22px */
    margin-bottom: 1.5rem;
    /* 24px */
    font-weight: bold;
}

h6 {
    font-size: 0.93rem;
    /* 16px */
    line-height: 1rem;
    /* 16px */
    margin-bottom: 0.75rem;
    color: white;
}

@media (min-width: 980px) {
    h3.md-focus:before,
    h4.md-focus:before,
    h5.md-focus:before,
    h6.md-focus:before {
        color: #ddd;
        border: 1px solid #ddd;
        border-radius: 3px;
        position: absolute;
        left: -1.642857143rem;
        top: .357142857rem;
        float: left;
        font-size: 9px;
        padding-left: 2px;
        padding-right: 2px;
        vertical-align: bottom;
        font-weight: normal;
        line-height: normal;
    }

    h3.md-focus:before {
        content: 'h3';
    }

    h4.md-focus:before {
        content: 'h4';
    }

    h5.md-focus:before {
        content: 'h5';
        top: 0px;
    }

    h6.md-focus:before {
        content: 'h6';
        top: 0px;
    }
}

a {
    text-decoration: none;
    outline: 0;
}

a:hover {
    outline: 0;
}

a:focus {
    outline: thin dotted;
}

sup.md-footnote {
    background-color: #555;
    color: #ddd;
}

p {
    -ms-word-wrap: break-word;
    word-wrap: break-word;
}

p,
ul,
dd,
ol,
hr,
address,
pre,
table,
iframe,
.wp-caption,
.wp-audio-shortcode,
.wp-video-shortcode {
    margin-top: 0;
    margin-bottom: 1.5rem;
    /* 24px */
}

audio:not([controls]) {
    display: none;
}

[hidden] {
    display: none;
}

::-moz-selection {
    background: #4a89dc;
    color: #fff;
    text-shadow: none;
}

*.in-text-selection,
::selection {
    background: #4a89dc;
    color: #fff;
    text-shadow: none;
}

ul,
ol {
    padding: 0 0 0 1.875rem;
    /* 30px */
}

ul {
    list-style: square;
}

ol {
    list-style: decimal;
}

ul ul,
ol ol,
ul ol,
ol ul {
    margin: 0;
}

b,
th,
dt,
strong {
    font-weight: bold;
}

i,
em,
dfn,
cite {
    font-style: italic;
}

blockquote {
    padding-left: 1.875rem;
    margin: 0 0 1.875rem 1.875rem;
    border-left: solid 2px #474d54;
    padding-left: 30px;
    margin-top: 35px;
}

pre,
code,
kbd,
tt,
var {
    font-size: 0.875rem;
    font-family: Monaco, Consolas, "Andale Mono", "DejaVu Sans Mono", monospace;
}

code,
tt,
var {
    background: rgba(0, 0, 0, 0.05);
}

kbd {
    padding: 2px 4px;
    font-size: 90%;
    color: #fff;
    background-color: #333;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 rgba(0,0,0,.25);
}

pre.md-fences {
    padding: 10px 10px 10px 30px;
    margin-bottom: 20px;
    background: #333;
}

.CodeMirror-gutters {
    background: #333;
    border-right: 1px solid transparent;
}

.enable-diagrams pre.md-fences[lang="sequence"] .code-tooltip,
.enable-diagrams pre.md-fences[lang="flow"] .code-tooltip,
.enable-diagrams pre.md-fences[lang="mermaid"] .code-tooltip {
    bottom: -2.2em;
    right: 4px;
}

code,
kbd,
tt,
var {
    padding: 2px 5px;
}

table {
    max-width: 100%;
    width: 100%;
    border-collapse: collapse;
    border-spacing: 0;
}

th,
td {
    padding: 5px 10px;
    vertical-align: top;
}

a {
    -webkit-transition: all .2s ease-in-out;
    transition: all .2s ease-in-out;
}

hr {
    background: #474d54;
    /* variable */
}

h1 {
    margin-top: 2em;
}

a {
    color: #e0e0e0;
    text-decoration: underline;
}

a:hover {
    color: #fff;
}

.md-inline-math script {
    color: #81b1db;
}

b,
th,
dt,
strong {
    color: #DEDEDE;
    /* variable */
}

mark {
    background: #D3D40E;
}

blockquote {
    color: #9DA2A6;
}

table a {
    color: #DEDEDE;
    /* variable */
}

th,
td {
    border: solid 1px #474d54;
    /* variable */
}

.task-list {
    padding-left: 0;
}

.md-task-list-item {
    padding-left: 1.25rem;
}

.md-task-list-item > input {
    top: auto;
}

.md-task-list-item > input:before {
    content: "";
    display: inline-block;
    width: 0.875rem;
    height: 0.875rem;
    vertical-align: middle;
    text-align: center;
    border: 1px solid #b8bfc6;
    background-color: #363B40;
    margin-top: -0.4rem;
}

.md-task-list-item > input:checked:before,
.md-task-list-item > input[checked]:before {
    content: '\221A';
    /*◘*/
    font-size: 0.625rem;
    line-height: 0.625rem;
    color: #DEDEDE;
}

/** quick open **/
.auto-suggest-container {
    border: 0px;
    background-color: #525C65;
}

#typora-quick-open {
    background-color: #525C65;
}

#typora-quick-open input{
    background-color: #525C65;
    border: 0;
    border-bottom: 1px solid grey;
}

.typora-quick-open-item {
    background-color: inherit;
    color: inherit;
}

.typora-quick-open-item.active,
.typora-quick-open-item:hover {
    background-color: #4D8BDB;
    color: white;
}

.typora-quick-open-item:hover {
    background-color: rgba(77, 139, 219, 0.8);
}

.typora-search-spinner > div {
  background-color: #fff;
}

#write pre.md-meta-block {
    border-bottom: 1px dashed #ccc;
    background: transparent;
    padding-bottom: 0.6em;
    line-height: 1.6em;
}

.btn,
.btn .btn-default {
    background: transparent;
    color: #b8bfc6;
}

.ty-table-edit {
    border-top: 1px solid gray;
    background-color: #363B40;
}

.popover-title {
    background: transparent;
}

.md-image>.md-meta {
    color: #BBBBBB;
    background: transparent;
}

.md-expand.md-image>.md-meta {
    color: #DDD;
}

#write>h3:before,
#write>h4:before,
#write>h5:before,
#write>h6:before {
    border: none;
    border-radius: 0px;
    color: #888;
    text-decoration: underline;
    left: -1.4rem;
    top: 0.2rem;
}

#write>h3.md-focus:before {
    top: 2px;
}

#write>h4.md-focus:before {
    top: 2px;
}

.md-toc-item {
    color: #A8C2DC;
}

#write div.md-toc-tooltip {
    background-color: #363B40;
}

.dropdown-menu .btn:hover,
.dropdown-menu .btn:focus,
.md-toc .btn:hover,
.md-toc .btn:focus {
    color: white;
    background: black;
}

#toc-dropmenu {
    background: rgba(50, 54, 59, 0.93);
    border: 1px solid rgba(253, 253, 253, 0.15);
}

#toc-dropmenu .divider {
    background-color: #9b9b9b;
}

.outline-expander:before {
    top: 2px;
}

#typora-sidebar {
    box-shadow: none;
    border-right: 1px dashed;
    border-right: none;
}

.sidebar-tabs {
    border-bottom:0;
}

#typora-sidebar:hover .outline-title-wrapper {
    border-left: 1px dashed;
}

.outline-title-wrapper .btn {
    color: inherit;
}

.outline-item:hover {
    border-color: #363B40;
    background-color: #363B40;
    color: white;
}

h1.md-focus .md-attr,
h2.md-focus .md-attr,
h3.md-focus .md-attr,
h4.md-focus .md-attr,
h5.md-focus .md-attr,
h6.md-focus .md-attr,
.md-header-span .md-attr {
    color: #8C8E92;
    display: inline;
}

.md-comment {
    color: #5a95e3;
    opacity: 1;
}

.md-inline-math svg {
    color: #b8bfc6;
}

#math-inline-preview .md-arrow:after {
    background: black;
}

.modal-content {
    background: var(--bg-color);
    border: 0;
}

.modal-title {
    font-size: 1.5em;
}

.modal-content input {
    background-color: rgba(26, 21, 21, 0.51);
    color: white;
}

.modal-content .input-group-addon {
    color: white;
}

.modal-backdrop {
    background-color: rgba(174, 174, 174, 0.7);
}

.modal-content .btn-primary {
    border-color: var(--primary-color);
}

.md-table-resize-popover {
    background-color: #333;
}

.form-inline .input-group .input-group-addon {
    color: white;
}

#md-searchpanel {
    border-bottom: 1px dashed grey;
}

/** UI for electron */

.context-menu,
#spell-check-panel,
#footer-word-count-info {
    background-color: #42464A;
}

.context-menu.dropdown-menu .divider,
.dropdown-menu .divider {
    background-color: #777777;
}

footer {
    color: inherit;
}

@media (max-width: 1000px) {
    footer {
        border-top: none;
    }
    footer:hover {
        color: inherit;
    }
}

#file-info-file-path .file-info-field-value:hover {
    background-color: #555;
    color: #dedede;
}

.megamenu-content,
.megamenu-opened header {
    background: var(--bg-color);
}

.megamenu-menu-panel h2,
.megamenu-menu-panel h1,
.long-btn {
    color: inherit;
}

.megamenu-menu-panel input[type='text'] {
    background: inherit;
    border: 0;
    border-bottom: 1px solid;
}

#recent-file-panel-action-btn {
    background: inherit;
    border: 1px grey solid;
}

.megamenu-menu-panel .dropdown-menu > li > a {
    color: inherit;
    background-color: #2F353A;
    text-decoration: none;
}

.megamenu-menu-panel table td:nth-child(1) {
    color: inherit;
    font-weight: bold;
}

.megamenu-menu-panel tbody tr:hover td:nth-child(1) {
    color: white;
}

.modal-footer .btn-default, 
.modal-footer .btn-primary,
.modal-footer .btn-default:not(:hover) {
    border: 1px solid;
    border-color: transparent;
}

.btn-primary {
    color: white;
}

.btn-default:hover, .btn-default:focus, .btn-default.focus, .btn-default:active, .btn-default.active, .open > .dropdown-toggle.btn-default {
    color: white;
    border: 1px solid #ddd;
    background-color: inherit;
}

.modal-header {
    border-bottom: 0;
}

.modal-footer {
    border-top: 0;
}

#recent-file-panel tbody tr:nth-child(2n-1) {
    background-color: transparent !important;
}

.megamenu-menu-panel tbody tr:hover td:nth-child(2) {
    color: inherit;
}

.megamenu-menu-panel .btn {
    border: 1px solid #eee;
    background: transparent;
}

.mouse-hover .toolbar-icon.btn:hover,
#w-full.mouse-hover,
#w-pin.mouse-hover {
    background-color: inherit;
}

.typora-node::-webkit-scrollbar {
    width: 5px;
}

.typora-node::-webkit-scrollbar-thumb:vertical {
    background: rgba(250, 250, 250, 0.3);
}

.typora-node::-webkit-scrollbar-thumb:vertical:active {
    background: rgba(250, 250, 250, 0.5);
}

#w-unpin {
    background-color: #4182c4;
}

#top-titlebar, #top-titlebar * {
    color: var(--item-hover-text-color);
}

.typora-sourceview-on #toggle-sourceview-btn,
#footer-word-count:hover,
.ty-show-word-count #footer-word-count {
    background: #333333;
}

#toggle-sourceview-btn:hover {
    color: #eee;
    background: #333333;
}

/** focus mode */
.on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) * {
    color: #686868 !important;
}

.on-focus-mode .md-end-block:not(.md-focus) img,
.on-focus-mode .md-task-list-item:not(.md-focus-container)>input {
    opacity: #686868 !important;
}

.on-focus-mode li[cid]:not(.md-focus-container){
    color: #686868;
}

.on-focus-mode .md-fences.md-focus .CodeMirror-code>*:not(.CodeMirror-activeline) *,
.on-focus-mode .CodeMirror.cm-s-inner:not(.CodeMirror-focused) * {
    color: #686868 !important;
}

.on-focus-mode .md-focus,
.on-focus-mode .md-focus-container {
    color: #fff;
}

.on-focus-mode #typora-source .CodeMirror-code>*:not(.CodeMirror-activeline) * {
    color: #686868 !important;
}


/*diagrams*/
#write .md-focus .md-diagram-panel {
    border: 1px solid #ddd;
    margin-left: -1px;
    width: calc(100% + 2px);
}

/*diagrams*/
#write .md-focus.md-fences-with-lineno .md-diagram-panel {
    margin-left: auto;
}

.md-diagram-panel-error {
    color: #f1908e;
}

.active-tab-files #info-panel-tab-file,
.active-tab-files #info-panel-tab-file:hover,
.active-tab-outline #info-panel-tab-outline,
.active-tab-outline #info-panel-tab-outline:hover {
    color: #eee;
}

.sidebar-footer-item:hover,
.footer-item:hover {
    background: inherit;
    color: white;
}

.ty-side-sort-btn.active,
.ty-side-sort-btn:hover,
.selected-folder-menu-item a:after {
    color: white;
}

#sidebar-files-menu {
    border:solid 1px;
    box-shadow: 4px 4px 20px rgba(0, 0, 0, 0.79);
    background-color: var(--bg-color);
}

.file-list-item {
    border-bottom:none;
}

.file-list-item-summary {
    opacity: 1;
}

.file-list-item.active:first-child {
    border-top: none;
}

.file-node-background {
    height: 32px;
}

.file-library-node.active>.file-node-content,
.file-list-item.active {
    color: white;
    color: var(--active-file-text-color);
}

.file-library-node.active>.file-node-background{
    background-color: rgb(34, 34, 34);
    background-color: var(--active-file-bg-color);
}
.file-list-item.active {
    background-color: rgb(34, 34, 34);
    background-color: var(--active-file-bg-color);
}

#ty-tooltip {
    background-color: black;
    color: #eee;
}

.md-task-list-item>input {
    margin-left: -1.3em;
    margin-top: 0.3rem;
    -webkit-appearance: none;
}

.md-mathjax-midline {
    background-color: #57616b;
    border-bottom: none;
}

footer.ty-footer {
    border-color: #656565;
}

.ty-preferences .btn-default {
    background: transparent;
}
.ty-preferences .btn-default:hover {
    background: #57616b;
}

.ty-preferences select {
    border: 1px solid #989698;
    height: 21px;
}

.ty-preferences .nav-group-item.active {
    background: var(--item-hover-bg-color);
}

.ty-preferences input[type="search"] {
    border-color: #333;
    background: #333;
    line-height: 22px;
    border-radius: 6px;
    color: white;
}

.ty-preferences input[type="search"]:focus {
    box-shadow: none;
}

[data-is-directory="true"] .file-node-content {
    margin-bottom: 0;
}

.file-node-title {
    line-height: 22px;
}

.html-for-mac .file-node-open-state, .html-for-mac .file-node-icon {
    line-height: 26px;
}

::-webkit-scrollbar-thumb {
    background: rgba(230, 230, 230, 0.30);
}

::-webkit-scrollbar-thumb:active {
    background: rgba(230, 230, 230, 0.50);
}

#typora-sidebar:hover div.sidebar-content-content::-webkit-scrollbar-thumb:horizontal {
    background: rgba(230, 230, 230, 0.30);
}

.nav-group-item:active {
    background-color: #474d54;
}

.md-search-hit {
    background: rgba(199, 140, 60, 0.81);
    color: #eee;
}

.md-search-hit * {
    color: #eee;
}

#md-searchpanel input {
    color: white;
}

.export-detail,
.export-item.active,
.export-items-list-control {
    background: #d6d6d4
}

.modal-backdrop.in {
    opacity: 1;
    backdrop-filter: blur(1px);
}


</style>
</head>
<body class='typora-export os-windows'>
<div id='write'  class=''><h2><a name="描述jvm加载class文件的机制" class="md-header-anchor"></a><span>描述JVM加载CLASS文件的机制 </span></h2><h5><a name="首先jvm中类的加载是通过类加载器完成的分别是根加载器bootstrap-扩展加载器extention-系统加载器system-自定义类加载器b-负责加载基础核心类库e负责加载系统属性所指定的目录-s加载环境变量或系统属性指定的类类的加载是创建一个字节数组将class文件中的数据读取到内存中然后会产生所加载类的class对象当类被加载后进入连接阶段包括验证准备为静态变量分配内存并且设置初始值解析将符号引用变成直接引用最后jvm对类进行初始化类的加载使用父亲委托机制pdm更好的保证了安全性类的加载首先请求父亲加载器父亲加载器不行了子类加载器自行加载" class="md-header-anchor"></a><span>首先JVM中类的加载是通过类加载器完成的，分别是，根加载器(Bootstrap)， 扩展加载器(Extention)， 系统加载器(System)， 自定义类加载器，B 负责加载基础核心类库，E负责加载系统属性所指定的目录, S加载环境变量或系统属性指定的类。类的加载是创建一个字节数组将.class文件中的数据读取到内存中，然后会产生所加载类的Class对象。当类被加载后进入连接阶段，包括验证，准备(为静态变量分配内存并且设置初始值)，解析(将符号引用变成直接引用)，最后JVM对类进行初始化。类的加载使用父亲委托机制(PDM),更好的保证了安全性。类的加载首先请求父亲加载器，父亲加载器不行了子类加载器自行加载。</span></h5><h2><a name="java开发中抽象类和接口都有什么区别" class="md-header-anchor"></a><span>Java开发中抽象类和接口都有什么区别？</span></h2><blockquote><p><span>抽象类用abstract关键字修饰，接口用interface修饰</span></p><p><span>抽象类可以有抽象方法和具体方法，接口只能有抽象方法(jdk8之前)</span></p><p><span>一个类只能继承一个抽象类，但是可以实现多个接口</span></p></blockquote><h2><a name="静态嵌套类static-nested-class）和内部类inner-class）的不同" class="md-header-anchor"></a><span>静态嵌套类（Static Nested Class）和内部类（Inner Class）的不同</span></h2><h5><a name="在一个类的内部定义一个类就是嵌套类嵌套类分两种静态嵌套类和内部类内部类分三种" class="md-header-anchor"></a><span>在一个类的内部定义一个类就是嵌套类，嵌套类分两种，静态嵌套类和内部类。内部类分三种：</span></h5><ol start='' ><li><span>在外部类中直接定义的内部类</span></li><li><span>在一个外部类的方法中定义的内部类</span></li><li><span>匿名内部类</span></li></ol><h5><a name="在静态嵌套类中不能访问外部类的非静态成员外部类不能直接访问内部类的变量定义在方法内部的内部类不能访问本方法的成员变量只能访问本方法的final变量除了这个其他关键字都不能用" class="md-header-anchor"></a><span>在静态嵌套类中不能访问外部类的非静态成员，外部类不能直接访问内部类的变量，定义在方法内部的内部类不能访问本方法的成员变量，只能访问本方法的final变量，除了这个，其他关键字都不能用。</span></h5><h2><a name="什么情况下会发生堆内存溢出栈内存溢出结合实例说明" class="md-header-anchor"></a><span>什么情况下会发生堆内存溢出，栈内存溢出，结合实例说明</span></h2><h5><a name="一-栈溢出stackoverflowerror" class="md-header-anchor"></a><span>一、 栈溢出(StackOverflowError)</span></h5><h6><a name="栈内存溢出就是栈帧的数量太多超过了系统预先设定的值方法执行是创建的栈帧超过了栈的深度所以导致内存溢出可以使用参数--xss-去调整jvm栈的大小" class="md-header-anchor"></a><span>栈内存溢出就是栈帧的数量太多超过了系统预先设定的值，方法执行是创建的栈帧超过了栈的深度,所以导致内存溢出,可以使用参数 -Xss 去调整JVM栈的大小</span></h6><h5><a name="二-堆溢出outofmemoryerrorjava-heap-space" class="md-header-anchor"></a><span>二、 堆溢出(OutOfMemoryError:java heap space)</span></h5><h6><a name="堆中主要存储的是对象如果不断的new对象则会导致堆中的空间溢出" class="md-header-anchor"></a><span>堆中主要存储的是对象。如果不断的new对象则会导致堆中的空间溢出</span></h6><h2><a name="静态变量和实例变量的区别" class="md-header-anchor"></a><span>静态变量和实例变量的区别</span></h2><h5><a name="静态变量是用static修饰的不属于任何一个对象只属于类一个类不管创建多少个对象静态变量在内存中有且仅有一个拷贝实例变量必须依存于某一实例要先创建对象然后才能通过对象访问他静态变量可以实现让多个对象共享内存" class="md-header-anchor"></a><span>静态变量是用static修饰的，不属于任何一个对象，只属于类。一个类不管创建多少个对象，静态变量在内存中有且仅有一个拷贝，实例变量必须依存于某一实例，要先创建对象，然后才能通过对象访问他。静态变量可以实现让多个对象共享内存</span></h5><h2><a name="gc是什么为什么要有gc" class="md-header-anchor"></a><span>GC是什么？为什么要有GC？</span></h2><h5><a name="gc是垃圾收集的意思java提供的gc功能可以自动监测对象是可以回收而达到自动回收内存的目的垃圾回收可以有效的防止内存泄露有效的使用可以使用的内存垃圾回收器通常是作为一个单独的低优先级的线程运行不可预知的情况下对内存堆中已经死亡的或者长时间没有使用的对象进行清除和回收程序员不能实时的调用垃圾回收器对某个对象或所有对象进行垃圾回收采用的是分代式垃圾收集这种方法会根据java对象的生命周期划分为不同区域在收集过程中可能会把对象移动到不同区域" class="md-header-anchor"></a><span>GC是垃圾收集的意思，Java提供的GC功能可以自动监测对象是可以回收而达到自动回收内存的目的，垃圾回收可以有效的防止内存泄露，有效的使用可以使用的内存。垃圾回收器通常是作为一个单独的低优先级的线程运行，不可预知的情况下对内存堆中已经死亡的或者长时间没有使用的对象进行清除和回收，程序员不能实时的调用垃圾回收器对某个对象或所有对象进行垃圾回收。采用的是“分代式垃圾收集”，这种方法会根据java对象的生命周期划分为不同区域，在收集过程中，可能会把对象移动到不同区域：</span></h5><ul><li><span>伊甸园（Eden）：这是对象最初诞生的区域，并且对大多数对象来说，这里是它们唯一存在过的区域。 </span></li><li><span>幸存者乐园（Survivor）：从伊甸园幸存下来的对象会被挪到这里。 </span></li><li><span>终身颐养园（Tenured）：这是足够老的幸存对象的归宿。年轻代收集（Minor-GC）过程是不会触及这个地方的。当年轻代收集不能把对象放进终身颐养园时，就会触发一次完全收集（Major-GC），这里可能还会牵扯到压缩，以便为大对象腾出足够的空间。</span></li></ul><h2><a name="解释内存中的栈stack堆heap和方法区method-area的用法" class="md-header-anchor"></a><span>解释内存中的栈(stack)、堆(heap)和方法区(method area)的用法</span></h2><ul><li><p><span>栈的使用：通常我们定义一个基本数据类型的变量，一个对象的引用，还有就是函数调用的现场保存都使用JVM中的栈空间。</span></p></li><li><p><span>堆的使用：通过new关键字和构造器创建的对象则放在堆空间，堆是垃圾收集器管理的主要区域。</span></p></li><li><p><span>方法区的使用：方法区和堆都是各个线程共享的内存区域，用于存储已经被JVM加载的类信息、常量、静态变量、JIT编译器编译后的代码等数据；程序中的字面量（literal）如直接书写的100、&quot;hello&quot;和常量都是放在常量池中，常量池是方法区的一部分。</span></p></li><li><p><span>栈空间操作起来最快但是栈很小，通常大量的对象都是放在堆空间，栈和堆的大小都可以通过JVM的启动参数来进行调整，栈空间用光了会引发StackOverflowError，而堆和常量池空间不足则会引发OutOfMemoryError。</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">例子：</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">String str = new String("hello");</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">上面的语句中变量str放在栈上，用new创建出来的字符串对象放在堆上，而"hello"这个字面量是放在方法区的。</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 78px;"></div><div class="CodeMirror-gutters" style="height: 78px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre></li></ul><h2><a name="为什么不能根据返回类型来区分重载" class="md-header-anchor"></a><span>为什么不能根据返回类型来区分重载</span></h2><h5><a name="打个比方float-maxint-a-int-b-int-maxint-a-int-b-像这种编译器就不知道调用的是哪个方法的返回值是方法运行过后的一个状态不能作为标识" class="md-header-anchor"></a><span>打个比方float max(int a, int b); int max(int a, int b); 像这种编译器就不知道调用的是哪个，方法的返回值是方法运行过后的一个状态，不能作为标识。</span></h5><h2><a name="非受检异常运行时异常）和受检异常的区别" class="md-header-anchor"></a><span>非受检异常（运行时异常）和受检异常的区别</span></h2><h5><a name="除了runtimeexception和javalangerror类及其子类其他都是受检异常受检异常强制进行显示的声明或捕获否则就产生编译错误运行时异常就是编译不会捕获运行时才被抛出" class="md-header-anchor"></a><span>除了RuntimeException和java.lang.Error类及其子类，其他都是受检异常。受检异常强制进行显示的声明或捕获，否则就产生编译错误，运行时异常就是编译不会捕获，运行时才被抛出</span></h5><ul><li><p><span>非受检异常</span></p><ul><li><code>ClassCastException</code></li><li><code>ArrayIndexOutOfBoundsException</code></li><li><code>IndexOutOfBoundsException</code></li><li><code>NullPointerException</code></li></ul></li><li><p><span>受检异常</span></p><ul><li><code>NoSuchFieldException</code></li><li><code>ClassNotFoundException</code></li><li><code>SQLException</code></li><li><code>IOException</code></li></ul></li></ul><h2><a name="对象的四种引用" class="md-header-anchor"></a><span>对象的四种引用</span></h2><h5><a name="强引用例如object-object--new-object被强引用的对象不会被gc回收gc宁愿抛出oom也不会回收强引用对象来释放空间" class="md-header-anchor"></a><span>强引用：例如Object object = new Object();,被强引用的对象不会被gc回收，gc宁愿抛出oom也不会回收强引用对象来释放空间</span></h5><h5><a name="引用reference类）下面三个都是它的子类它有四个方法" class="md-header-anchor"></a><span>引用（Reference类）下面三个都是它的子类，它有四个方法</span></h5><ul><li><span>clean()： 清除对象</span></li><li><span>enqueue()： 将此引用对象添加到其注册的队列</span></li><li><span>get()： 返回此引用对象的指示。通过这个方法可以吧软引用对象变成强引用</span></li><li><span>isEnqueued()： 通过程序或垃圾收集器来告知这个引用对象是否已经放入队列;</span></li></ul><h5><a name="软引用softreference-软引用的生命周期比强引用短一些只有当-jvm-认为内存不足时才会去试图回收软引用指向的对象他可以和引用队列一起使用如果被回收了就会加到引用队列中可以使用poll方法查看然后可以吧这些对象清除掉" class="md-header-anchor"></a><span>软引用(SoftReference)： 软引用的生命周期比强引用短一些，只有当 JVM 认为内存不足时，才会去试图回收软引用指向的对象，他可以和引用队列一起使用如果被回收了就会加到引用队列中，可以使用poll()方法查看，然后可以吧这些对象清除掉</span></h5><h5><a name="弱引用weakreference-弱引用的生命周期比软引用短垃圾回收器只要发现有弱引用对象就会回收也可以和队列一起使用被回收后会加到队列中" class="md-header-anchor"></a><span>弱引用(WeakReference)： 弱引用的生命周期比软引用短，垃圾回收器只要发现有弱引用对象就会回收，也可以和队列一起使用，被回收后会加到队列中</span></h5><h5><a name="虚引用phantomreference-虚引用等同于没有引用在任何时候都可能被gc回收设置虚引用的目的是为了看到被虚引用关联的对象在被垃圾回收器回收的时候能够收到一个系统通知用来跟踪对象被gc回收的活动）" class="md-header-anchor"></a><span>虚引用(PhantomReference)： 虚引用等同于没有引用，在任何时候都可能被GC回收。设置虚引用的目的是为了看到被虚引用关联的对象在被垃圾回收器回收的时候，能够收到一个系统通知（用来跟踪对象被GC回收的活动）</span></h5><h2><a name="synchronizedmap和concurrenthashmap有什么区别" class="md-header-anchor"></a><span>SynchronizedMap和ConcurrentHashMap有什么区别？</span></h2><h5><a name="答-synchronizedmap&nbsp;是锁住整张表保证每次只有一个线程访问concurrenthashmap&nbsp;使用分段锁来保证多线程下的性能在concurrenthashmap&nbsp;中默认将hash分为16个桶每次锁住一个桶诸如&nbsp;getputremove&nbsp;等常用操作只锁当前需要用到的桶这样原来只能进一个线程现在可以让16线程同时读写性能提升显著concurrenthashmap&nbsp;使用了一种不同的迭代方式当&nbsp;iterator&nbsp;被创建后集合再发生改变就不再是抛出&nbsp;concurrentmodificationexception了取而代之的是在改变的时候new新的数据应该是把新老数据合并成一个新的集合iterator&nbsp;完成后再将头指针替换为新的数据这样&nbsp;iterator线程可以使用原来老的数据而写线程也可以并发的完成改变" class="md-header-anchor"></a><span>答： SynchronizedMap 是锁住整张表，保证每次只有一个线程访问，ConcurrentHashMap 使用分段锁来保证多线程下的性能。在ConcurrentHashMap 中，默认将hash分为16个桶，每次锁住一个桶，诸如 get,put,remove 等常用操作只锁当前需要用到的桶。这样原来只能进一个线程，现在可以让16线程同时读写，性能提升显著。ConcurrentHashMap 使用了一种不同的迭代方式，当 iterator 被创建后集合再发生改变就不再是抛出 ConcurrentModificationException了，取而代之的是在改变的时候new新的数据(应该是把新老数据合并成一个新的集合)，iterator 完成后再将头指针替换为新的数据，这样 iterator线程可以使用原来老的数据，而写线程也可以并发的完成改变。</span></h5><h2><a name="创建内部类对象和静态内部类" class="md-header-anchor"></a><span>创建内部类对象和静态内部类</span></h2><details>
  <summary>查看代码</summary>
  <pre><code> 
	public class asdf {
	    public static void main(String[] args) {
        test1 test1 = new asdf().new test1(); //创建内部类对象
        test2 test2 = new test2(); //创建静态内部类
    }</code></pre></details><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">String s = "aa";</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">public void b() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  // System.out.println(s1); 不能访问内部类的资源</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">static class test2 {}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">class test1 {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  String s1 = "a"; //作用域只在test1里</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  public void a() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  System.out.println(s1);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  System.out.println(s); //内部类可以访问到外面的资源</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 364px;"></div><div class="CodeMirror-gutters" style="height: 364px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre><p><span>}</span></p><h2><a name="详解jvm内存模型" class="md-header-anchor"></a><span>详解JVM内存模型</span></h2><h5><a name="jvm内存模型分为5块线程共享-方法区-堆线程私有-本地方法栈虚拟栈程序寄存器" class="md-header-anchor"></a><span>JVM内存模型分为5块，线程共享： 方法区， 堆。线程私有： 本地方法栈，虚拟栈，程序寄存器</span></h5><h6><a name="程序寄存器-当前线程所执行的字节码的行号指示器用于记录正在执行的虚拟机字节指令地址线程私有" class="md-header-anchor"></a><span>程序寄存器： 当前线程所执行的字节码的行号指示器，用于记录正在执行的虚拟机字节指令地址，线程私有。</span></h6><h6><a name="虚拟栈存放基本数据类型对象的引用方法出口等" class="md-header-anchor"></a><span>虚拟栈：存放基本数据类型、对象的引用、方法出口等</span></h6><h6><a name="本地方法栈和虚拟栈相似只不过它服务于native方法" class="md-header-anchor"></a><span>本地方法栈：和虚拟栈相似，只不过它服务于Native方法</span></h6><h6><a name="方法区存放已被加载的类信息常量静态变量即时编译器编译后的代码数据等即永久带）回收目标主要是常量池的回收和类型的卸载" class="md-header-anchor"></a><span>方法区：存放已被加载的类信息、常量、静态变量、即时编译器编译后的代码数据等。（即永久带），回收目标主要是常量池的回收和类型的卸载</span></h6><h6><a name="堆java内存最大的一块所有对象实例数组都存放在java堆gc回收的地方" class="md-header-anchor"></a><span>堆：java内存最大的一块，所有对象实例、数组都存放在java堆，GC回收的地方</span></h6><h2><a name="jvm中一次完整的gc流程是怎样的对象如何晋升到老年代" class="md-header-anchor"></a><span>JVM中一次完整的GC流程是怎样的，对象如何晋升到老年代</span></h2><h5><a name="首先gc是发生在堆中的分为新生代和老年代新生代又分为三块eden-s0s1新生代占13老年代占23首先会判断eden区有没有空间当年轻代的内存满了会触发minor-gcminor-gc采用的复制算法它的过程就是复制--清空--互换复制是指的吧eden和s0的复制到s1然后清空eden和s0的然后把s0和s1置换原来s1的就成了下次gc的对象了然后存活下来的对象会放到survivor区此时它的年龄1每熬过一次minor-gc年龄就会1直到大于15就被收进老年代还有一种大对象就会直接进入老年代老年代的中会使用major-gcfull-gc老年代gc来清除垃圾但是它的速度很慢major-gc采用的标记清除算法先标记存活的然后在清除没有标记的缺点耗费时间-容易产生内存碎片当老年代都装不下了就会抛出oom异常" class="md-header-anchor"></a><span>首先GC是发生在堆中的，分为新生代和老年代，新生代又分为三块，eden， s0，s1，新生代占1/3，老年代占2/3。首先会判断Eden区有没有空间，当年轻代的内存满了会触发Minor GC。Minor GC采用的复制算法，它的过程就是复制 =&gt; 清空 =&gt; 互换。复制是指的吧Eden和s0的复制到s1，然后清空Eden和s0的，然后把s0和s1置换，原来s1的就成了下次GC的对象了。然后存活下来的对象会放到Survivor区，此时它的年龄+1，每熬过一次Minor GC年龄就会+1，直到大于15就被收进老年代，还有一种大对象就会直接进入老年代。老年代的中会使用Major GC/Full GC(老年代GC)来清除垃圾，但是它的速度很慢。Major GC采用的标记清除算法，先标记存活的，然后在清除没有标记的，缺点：耗费时间， 容易产生内存碎片。当老年代都装不下了就会抛出OOM异常</span></h5><h2><a name="垃圾回收算法有哪些" class="md-header-anchor"></a><span>垃圾回收算法有哪些</span></h2><ul><li><span>标记-清除算法：就是先标记内存中存活的对象，然后把其他的清除掉，缺点是会产生内存碎片</span></li><li><span>复制算法：把内存分成两块，把存活的放到一遍，然后把另一块内存全部回收，缺点是利用率不高</span></li><li><span>标记-整理算法：把内存中存活的对象赶到另一头，然后以存活的对象为边界，把其他的都回收了，解决的内存碎片跟利用率不高的问题</span></li><li><span>分代收集算法：就是把内存分成很多块，每块用不同的回收算法回收</span></li></ul><h2><a name="jvm判断对象是否已死方算法" class="md-header-anchor"></a><span>JVM判断对象是否已死方算法</span></h2><ul><li><span>引用计数法: 给对象添加一个引用计数器，多一个地方引用，计数器就+1，当引用失效时计数器-1,当计数器为0时，表示对象已死，可以回收。缺点是：无法解决对象循环引用的问题，当A引用B，且B引用A且他们的计数器都不为0，但是他两实际没有意义。</span></li><li><span>可达性分析算法： 这个算法的基本思路就是通过一个系列名为GC Roots的对象作为起始点，从这些节点往下搜索，搜索所走过的路径就是引用链，当一个对象到GC Roots没有任何一个引用链时，则表示这个对象不可达，不可达不等于可回收，要等这个经过两次标记才能是可回收对象</span></li></ul><h2><a name="你知道哪几种垃圾收集器重点讲下cms和g1包括原理流程各自的优缺点" class="md-header-anchor"></a><span>你知道哪几种垃圾收集器，重点讲下cms和G1,包括原理,流程,各自的优缺点。</span></h2><h5><a name="1-serial收集器-单线程的收集器收集垃圾时必须stop-the-world使用复制算法" class="md-header-anchor"></a><span>1. Serial收集器： 单线程的收集器，收集垃圾时，必须stop the world，使用复制算法。</span></h5><h5><a name="2-parnew收集器-serial收集器的多线程版本也需要stop-the-world复制算法" class="md-header-anchor"></a><span>2. ParNew收集器： Serial收集器的多线程版本，也需要stop the world，复制算法。</span></h5><h5><a name="3-parallel-scavenge收集器-新生代收集器复制算法的收集器并发的多线程收集器目标是达到一个可控的吞吐量如果虚拟机总共运行100分钟其中垃圾花掉1分钟吞吐量就是99" class="md-header-anchor"></a><span>3. Parallel Scavenge收集器： 新生代收集器，复制算法的收集器，并发的多线程收集器，目标是达到一个可控的吞吐量。如果虚拟机总共运行100分钟，其中垃圾花掉1分钟，吞吐量就是99%。</span></h5><h5><a name="4-serial-old收集器-是serial收集器的老年代版本单线程收集器使用标记整理算法" class="md-header-anchor"></a><span>4. Serial Old收集器： 是Serial收集器的老年代版本，单线程收集器，使用标记整理算法。</span></h5><h5><a name="5-parallel-old收集器-是parallel-scavenge收集器的老年代版本使用多线程标记-整理算法" class="md-header-anchor"></a><span>5. Parallel Old收集器： 是Parallel Scavenge收集器的老年代版本，使用多线程，标记-整理算法。</span></h5><h5><a name="6-cmsconcurrent-mark-sweep-收集器-是一种以获得最短回收停顿时间为目标的收集器标记清除算法运作过程初始标记并发标记重新标记并发清除收集结束会产生大量空间碎片" class="md-header-anchor"></a><span>6. CMS(Concurrent Mark Sweep) 收集器： 是一种以获得最短回收停顿时间为目标的收集器，标记清除算法，运作过程：初始标记，并发标记，重新标记，并发清除，收集结束会产生大量空间碎片。</span></h5><h5><a name="7-g1收集器-标记整理算法实现运作流程主要包括以下初始标记并发标记最终标记筛选标记不会产生空间碎片可以精确地控制停顿" class="md-header-anchor"></a><span>7. G1收集器： 标记整理算法实现，运作流程主要包括以下：初始标记，并发标记，最终标记，筛选标记。不会产生空间碎片，可以精确地控制停顿。</span></h5><h4><a name="cms收集器是一种老年代垃圾收集器使用多线程标记--清除算法主要目的是获取最短的垃圾回收停顿时间分为4个阶段" class="md-header-anchor"></a><span>CMS收集器是一种老年代垃圾收集器，使用多线程标记–清除算法，主要目的是获取最短的垃圾回收停顿时间，分为4个阶段：</span></h4><ol start='' ><li><span>初始标记：标记GC Roots能关联到的对象</span></li><li><span>并发标记：进行GCRoots Tracing（可达性分析）过程，时间很长</span></li><li><span>重新标记：修正并发标记期间因用户程序继续运作而导致标记产生变动的那一部分对象的标记记录，时间较长</span></li><li><span>并发清除：回收内存空间，时间很长</span></li></ol><ul><li><span>缺点：无法清除浮动垃圾(在清理垃圾时重新产生的垃圾)，使用标记清除算法会产生内存碎片</span></li></ul><h4><a name="g1收集器是基于标记--整理算法不会产生内存碎片可以精确的控制停顿时间避免了全区域的垃圾收集它把堆内存分成大小固定的几个独立区域并且跟踪这些垃圾收集进度在后台维护一张优先级列表每次根据在允许收集的时间内优先回收垃圾最多的区域有如下特点" class="md-header-anchor"></a><span>G1收集器是基于标记–整理算法，不会产生内存碎片。可以精确的控制停顿时间，避免了全区域的垃圾收集，它把堆内存分成大小固定的几个独立区域，并且跟踪这些垃圾收集进度。在后台维护一张优先级列表，每次根据在允许收集的时间内，优先回收垃圾最多的区域。有如下特点：</span></h4><ol start='' ><li><span>并行和并发：让用户线程并发执行</span></li><li><span>分代收集：独立管理整个堆，但是能够采用不同的方式去处理新创建的对象和已经存活了一段时间和熬过多次GC的对象</span></li><li><span>空间整合： 使用标记整理算法，没有内存碎片产生</span></li></ol><h2><a name="说说arraylistvector和linkedlist" class="md-header-anchor"></a><span>说说Arraylist，Vector和LinkedList</span></h2><ol start='' ><li><h5><a name="扩容机制arraylist的是15倍扩容vector的是2倍扩容" class="md-header-anchor"></a><span>扩容机制，arraylist的是1.5倍扩容，vector的是2倍扩容</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>5</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">arraylist</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);等于原来的长度加上原来长度的一半</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">vector</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ?capacityIncrement : oldCapacity);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">当capacityIncrement小于0时就是扩容的时候，新的长度就等于两个旧的的长度</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="height: 130px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre></li><li><p><span>同步方面，arraylist是线程不安全的，但是效率高，Vector的方法都用synchronized修饰了，线程安全，但是速度慢</span></p></li><li><p><span>arraylist底层是数组，LinkedList底层是链表，所以arraylist查询快，增删改慢，LinkedList查询慢，增删改快</span></p></li></ol><h2><a name="hashmap原理" class="md-header-anchor"></a><span>HashMap原理</span></h2><h5><a name="在jdk17之前用的数组链表在18之后用的是数组链表红黑树当链表长度大于等于7时就会变成红黑树hashmap保存数据时使用key的hash值然后找到对应的位置如果为空就插进去如果不为空就会先跟这个位置的所有key比较如果相等就覆盖不等于就在最末的位置插入然后如果长度超过7就转换成红黑树删除元素小于6就变成链表它的扩容机制当容量达到它的阈值就是当前数组的长度乘以加载因子的值就会扩容扩容的容量是当前容量的2倍最大值就是2的31次方减1然后大小为什么是2的幂次方就是因为用key的hash值进行位移运算减少碰撞" class="md-header-anchor"></a><span>在jdk1.7之前用的数组+链表，在1.8之后用的是数组，链表+红黑树，当链表长度大于等于7时就会变成红黑树。hashmap保存数据时，使用key的hash值然后找到对应的位置，如果为空，就插进去，如果不为空就会先跟这个位置的所有key比较，如果相等就覆盖，不等于就在最末的位置插入，然后如果长度超过7就转换成红黑树，删除元素小于6就变成链表。它的扩容机制，当容量达到它的阈值，就是当前数组的长度乘以加载因子的值就会扩容，扩容的容量是当前容量的2倍，最大值就是2的31次方减1。然后大小为什么是2的幂次方就是因为用key的hash值进行位移运算，减少碰撞</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>8</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">例如长度为9时候，3&amp;(9-1)=0  2&amp;(9-1)=0 ，都在0上，碰撞了；</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">例如长度为8时候，3&amp;(8-1)=3  2&amp;(8-1)=2 ，不同位置上，不碰撞；</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3的二进制是0000 0011 2的二进制是0000 0010， 7的二进制是0000 0111， 8的二进制是0000 1000</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>3 &amp; 8 &nbsp; &nbsp; &nbsp; 2 &amp; 8 &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>3 $ 7  <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span>2 $ 7</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">第一个值：0011 &nbsp; <span class="cm-tab" role="presentation" cm-text="	">    </span>0010<span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>0011<span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> 0010</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">第二个值：1000<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span>1000<span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>0111<span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> 0111</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">结果： &nbsp; 0000(0)<span class="cm-tab" role="presentation" cm-text="	">   </span>  0000(0)<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>  0011(3)<span class="cm-tab" role="presentation" cm-text="	">   </span> &nbsp; 0010(2)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">这两个就是在同一个位置，就发生碰撞<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>这就不会碰撞，两个值不同</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 208px;"></div><div class="CodeMirror-gutters" style="height: 208px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h2><a name="concurrenthashmap原理" class="md-header-anchor"></a><span>ConcurrentHashMap原理</span></h2><h5><a name="首先说下hashmap在多线程环境下会出现死循环假设一个map长度为2此时里面有一个值1了然后进行put值2的时候会进行扩容多线程情况下线程1put值2把2插到1的后面然后线程2进行扩容头插法把2放到1的前面然后线程1继续执行在找2后面是否为null时就会找到1原本线程1在2后面找应该是null正常结束的但是现在线程2进行扩容线程1获取到-数组信息时2的next是指向1的然后就开始死循环" class="md-header-anchor"></a><span>首先说下HashMap在多线程环境下会出现死循环，假设一个map长度为2，此时里面有一个值1了，然后进行put值2的时候，会进行扩容。多线程情况下，线程1put值2，把2插到1的后面，然后线程2进行扩容，头插法把2放到1的前面。然后线程1继续执行，在找2后面是否为null时就会找到1，原本线程1在2后面找应该是null正常结束的。但是现在线程2进行扩容，线程1获取到 数组信息时2的next是指向1的，然后就开始死循环。</span></h5><p><img src="../img/image-20211018151605054.png" referrerpolicy="no-referrer" alt="image-20211018151605054"><span> </span></p><h5><a name="17的concurrenthashmap会把hash分成16个段segment每次操作只锁住一个段这样就允许了16个线程并发写操作读操作是不会限制的concurrenthashmap是由segment数组和hashentry数组组成segment是一种可重入锁继承了reentrantlock类一个concurrenthashmap里包含一个segment数组一个segment数组里包含一个hashentry数组hashentry又是链表结构的修改hashentry的时候必须要先获取segment锁18的concurrenthashmap使用的是cas和synchronized来保证并发不再使用segment而是使用node数组每个node数组都是独立加锁解锁的18的数据结构和hashmap一样" class="md-header-anchor"></a><span>1.7的ConcurrentHashMap会把hash分成16个段(Segment)，每次操作只锁住一个段，这样就允许了16个线程并发写操作，读操作是不会限制的。ConcurrentHashMap是由Segment数组和HashEntry数组组成，Segment是一种可重入锁，继承了ReentrantLock类。一个ConcurrentHashMap里包含一个Segment数组，一个Segment数组里包含一个HashEntry数组，HashEntry又是链表结构的，修改HashEntry的时候必须要先获取Segment锁。1.8的ConcurrentHashMap使用的是CAS和Synchronized来保证并发。不再使用Segment而是使用node数组，每个node数组都是独立加锁解锁的。1.8的数据结构和hashmap一样。</span></h5><h2><a name="list-map-set-三个接口存取元素时各有什么特点" class="md-header-anchor"></a><span>List、 Map、 Set 三个接口，存取元素时，各有什么特点？</span></h2><h5><a name="list跟set都是collection接口的子类set里面不能有重复元素调用add方法会返回是否添加成功list存元素时是按照顺序存的但是也可以指定索引插入map存的是key-valuekey可以为null但是只能有一个取值的时候可以取出所有key或者所有值或者所有的键值对" class="md-header-anchor"></a><span>List跟Set都是Collection接口的子类，Set里面不能有重复元素，调用add方法会返回是否添加成功，List存元素时，是按照顺序存的，但是也可以指定索引插入。Map存的是key-value，key可以为null但是只能有一个，取值的时候可以取出所有key，或者所有值，或者所有的键值对</span></h5><h2><a name="hashset-treeset-linkedhashset的区别" class="md-header-anchor"></a><span>HashSet, TreeSet, LinkedHashSet的区别</span></h2><h5><a name="hashset的底层是hashmap他不能有重复元素存对象的时候到重写对象的hashcode和equals方法hashset-的值是作为-hashmap-的-key-存储在hashmap-中的当存储的值已经存在时返回-false是线程不安全的treeset底层是treemap就是二叉树支持两种排序方式自然排序和定制排序linkedhashset是hashset的一个扩展版本底层是linkedhashmap他会根据hashcode决定元素存储的位置但是它也使用链表维护元素的顺序" class="md-header-anchor"></a><span>HashSet的底层是HashMap，他不能有重复元素，存对象的时候到重写对象的hashCode()和Equals()方法。HashSet 的值是作为 HashMap 的 key 存储在HashMap 中的，当存储的值已经存在时返回 false,是线程不安全的。TreeSet底层是TreeMap，就是二叉树，支持两种排序方式，自然排序和定制排序。LinkedHashSet是HashSet的一个“扩展版本”，底层是LinkedHashMap。他会根据hashCode决定元素存储的位置，但是它也使用链表维护元素的顺序</span></h5><h2><a name="treemap-linkedhashmap-hashtable的区别" class="md-header-anchor"></a><span>TreeMap, LinkedHashMap, HashTable的区别</span></h2><h5><a name="除了hashtable其他的都是不安全的hashmap它可以允许有一个为null的键因为它是线程不安全的所以不支持线程的同步当多个线程进行put操作时会出现覆盖等问题可以用concurrenthashmap解决" class="md-header-anchor"></a><span>除了HashTable，其他的都是不安全的，HashMap它可以允许有一个为null的键，因为它是线程不安全的所以不支持线程的同步，当多个线程进行put操作时会出现覆盖等问题，可以用ConcurrentHashMap解决</span></h5><h5><a name="linkedhashmap跟hashmap差不多继承了hashmap区别就是linkedhashmap记录了插入的顺序" class="md-header-anchor"></a><span>LinkedHashMap跟HashMap差不多，继承了HashMap区别就是LinkedHashMap记录了插入的顺序</span></h5><h5><a name="hashtable是线程安全的底层方法都用synchronized修饰的所以并发效率不高而且不能有null的键值hashmap则可以" class="md-header-anchor"></a><span>HashTable是线程安全的，底层方法都用synchronized修饰的，所以并发效率不高。而且不能有null的键值，HashMap则可以</span></h5><h5><a name="treemap是可排序的可以把它保存的记录根据键排序默认是升序的也可以指定排序的比较器他的键值都不能为空" class="md-header-anchor"></a><span>TreeMap是可排序的，可以把它保存的记录根据键排序，默认是升序的也可以指定排序的比较器，他的键值都不能为空</span></h5><h2><a name="concurrenthashmap-和-hashtable-的区别" class="md-header-anchor"></a><span>ConcurrentHashMap 和 HashTable 的区别</span></h2><h5><a name="底层数据结构concurrenthashmap在17之前用的是数组链表18之后跟hashmap一样用的是数组-链表红黑树hashtable用的是数组链表" class="md-header-anchor"></a><span>底层数据结构，ConcurrentHashMap在1.7之前用的是数组+链表，1.8之后跟HashMap一样用的是数组， 链表+红黑树，HashTable用的是数组+链表</span></h5><h5><a name="线程方面concurrenthashmap在1在18之前是使用的分段锁把hash分成16分每次写操作只锁住一个桶提高了并发到18的时候就不这么使用了用的是synchronized-和cas算法相当于一个优化后的线程安全的hashmaphashtable用的是synchronized关键字来保证线程安全当线程1put时线程2就不能put降低了并发" class="md-header-anchor"></a><span>线程方面，ConcurrentHashMap在1在1.8之前是使用的分段锁，把hash分成16分每次写操作只锁住一个桶，提高了并发，到1.8的时候就不这么使用了，用的是synchronized 和CAS算法，相当于一个优化后的线程安全的HashMap。HashTable用的是synchronized关键字来保证线程安全，当线程1put时线程2就不能put，降低了并发。</span></h5><h5><a name="cas算法compare-and-swap就是从主存中复制变量副本v20给线程然后cas算法中包含3个参数ven变量副本ve是预期值n是真实的值当ve时就把nv1值传到主存当线程2带着ven去修改的时候会发现v21然后再把主存中的值更新到自己的副本中在重试直到预期值等于主存中的值" class="md-header-anchor"></a><span>CAS算法(Compare And Swap)就是从主存中复制变量副本V=20给线程，然后CAS算法中包含3个参数(V,E,N),变量副本V，E是预期值，N是真实的值，当V=E时，就把N=V+1值传到主存，当线程2带着(V,E,N)去修改的时候会发现V=21，然后再把主存中的值更新到自己的副本中，在重试，直到预期值等于主存中的值。</span></h5><h5><a name="cas的aba问题线程1的v值是1线程2的也是1但是线程1的值经过操作变成了2然后有变成1此时线程2还是以为值没有变化过解决方法就是加版本号机制" class="md-header-anchor"></a><span>CAS的ABA问题：线程1的V值是1，线程2的也是1.但是线程1的值经过操作变成了2然后有变成1。此时线程2还是以为值没有变化过，解决方法就是加版本号机制</span></h5><h2><a name="iterator-和-listiterator-的区别是什么" class="md-header-anchor"></a><span>Iterator 和 ListIterator 的区别是什么</span></h2><ul><li><span>Iterator可以迭代List， Set集合， ListIterator只能迭代List</span></li><li><span>Iterator只能向前迭代，ListIterator可以前后迭代</span></li><li><span>ListIterator实现了Iterator并包含了其他功能</span></li></ul><h2><a name="java中的锁" class="md-header-anchor"></a><span>Java中的锁</span></h2><h5><a name="乐观锁悲观锁" class="md-header-anchor"></a><span>乐观锁，悲观锁</span></h5><h5><a name="自旋锁当两个线程争夺一个资源的时候另一个没有争抢到的线程就会等待然后隔段时间就尝试获取在这种采用循环加锁--等待的机制就是自旋锁自旋锁需要设置一个自旋等待的最大时间避免一直自旋当超过这个时间就会进入阻塞状态" class="md-header-anchor"></a><span>自旋锁：当两个线程争夺一个资源的时候，另一个没有争抢到的线程就会等待，然后隔段时间就尝试获取，在这种采用循环加锁 =&gt; 等待的机制就是自旋锁，自旋锁需要设置一个自旋等待的最大时间，避免一直自旋，当超过这个时间就会进入阻塞状态</span></h5><h5><a name="synchronized关键字-同步锁首先它的作用范围作用在方法上时锁住的是this实例当一个线程进入一个synchronized方法则其他线程就不能访问当前类中的synchronized方法当作用在静态方法上时锁住的是当前的class实例也就是整个类作用静态代码块上的就是锁住这个对象" class="md-header-anchor"></a><span>Synchronized关键字 同步锁：首先它的作用范围，作用在方法上时锁住的是this实例，当一个线程进入一个Synchronized方法，则其他线程就不能访问当前类中的Synchronized方法。当作用在静态方法上时锁住的是当前的Class实例也就是整个类。作用静态代码块上的就是锁住这个对象。</span></h5><h5><a name="reentrantlock-他是一种可重入锁能完成synchronized锁的功能还提供了公平锁非公平锁可响应中断锁等非公平锁就是随机获取轮到哪个就是哪个线程获取锁默认就是非公平锁公平锁就是跟句等待时间来安排哪个线程得到锁等待时间越久的就越先获的锁响应中断就是一个线程获取不到锁不会一直等reentrantlock会给一个中断响应" class="md-header-anchor"></a><span>ReentrantLock ：他是一种可重入锁，能完成Synchronized锁的功能，还提供了公平锁，非公平锁，可响应中断锁等。非公平锁就是随机获取，轮到哪个就是哪个线程获取锁，默认就是非公平锁。公平锁就是跟句等待时间来安排哪个线程得到锁，等待时间越久的就越先获的锁。响应中断就是一个线程获取不到锁，不会一直等，ReentrantLock会给一个中断响应</span></h5><h5><a name="readwritelock-读写锁在读的时候上读锁写的时候上写锁多个读锁不互斥读锁跟写锁互斥如果数据可以很多人读没有写操作就上读锁写的时候只能一个写不允许读就上写锁" class="md-header-anchor"></a><span>ReadWriteLock 读写锁：在读的时候上读锁，写的时候上写锁。多个读锁不互斥，读锁跟写锁互斥。如果数据可以很多人读，没有写操作就上读锁。写的时候只能一个写，不允许读就上写锁</span></h5><h5><a name="共享锁和独占锁独占锁是一种悲观的加锁策略如果某个只读线程获取了锁其他读线程就会被阻塞避免了读读冲突这种情况限制了不必要的并发性因为多个线程读数据并不影响共享锁允许多个线程同时获取锁并发访问它是一种乐观锁允许多个执行读线程同时访问共享资源" class="md-header-anchor"></a><span>共享锁和独占锁：独占锁是一种悲观的加锁策略，如果某个只读线程获取了锁，其他读线程就会被阻塞。避免了读/读冲突，这种情况限制了不必要的并发性，因为多个线程读数据并不影响。共享锁允许多个线程同时获取锁，并发访问，它是一种乐观锁，允许多个执行读线程同时访问共享资源。</span></h5><h2><a name="semaphore-信号量" class="md-header-anchor"></a><span>Semaphore 信号量</span></h2><h5><a name="semaphore是一种基于计数的信号量它可以设置一个阈值-然后多个线程来竞争信号量超过阈值后后面的线程都会阻塞当线程执行完后会释放信号量打个比方就是一个停车场3个车位来了五辆车只放进来前面三辆后面两辆被阻塞当停车场空出一个位置后面的车才能进来如果把信号量设置成1的话就相当于互斥锁互斥锁就是只要资源被锁住其他线程都无法访问" class="md-header-anchor"></a><span>Semaphore是一种基于计数的信号量，它可以设置一个阈值， 然后多个线程来竞争信号量，超过阈值后，后面的线程都会阻塞。当线程执行完后会释放信号量。打个比方就是一个停车场3个车位，来了五辆车，只放进来前面三辆，后面两辆被阻塞，当停车场空出一个位置，后面的车才能进来。如果把信号量设置成1的话就相当于互斥锁，互斥锁就是只要资源被锁住，其他线程都无法访问。</span></h5><h2><a name="synchronized底层原理参考链接httpswwwcnblogscomaspirantp11470858html" class="md-header-anchor"></a><span>Synchronized底层原理，</span><a href='https://www.cnblogs.com/aspirant/p/11470858.html'><span>参考链接</span></a></h2><h4><a name="java反编译过程" class="md-header-anchor"></a><span>Java反编译过程</span></h4><blockquote><p><span>通过 JDK 自带的 </span><code>javap</code><span> 命令查看 </span><code>SynchronizedDemo</code><span> 类的相关字节码信息：首先切换到类的对应目录执行 </span><code>javac SynchronizedDemo.java</code><span> 命令生成编译后的 .class 文件，然后执行</span><code>javap -c -s -v -l SynchronizedDemo.class</code><span>。</span></p></blockquote><h4><a name="监视器monitor）" class="md-header-anchor"></a><span>监视器（Monitor）</span></h4><ul><li><span>任何一个对象都有Monitor与之关联，且当Monitor被持有后将处于锁定状态，</span><mark><span>Synchronized在JVM中的实现都是基于进入和退出</span></mark><mark><span>Monitor对象来实现方法同步和代码块同步，</span></mark><mark><span>而监视器锁本质又是依赖于底层的操作系统的Mutex Lock(互斥锁)来实现的。操作系统线程之间切换需要从用户态转换到内核态，这个成本非常高，这就是Synchronized效率低的原因</span></mark><span>。所有Java对象都是天生的Monitor，因为每个java对象创建的时候就带了一把看不见的锁，叫做</span><strong><span>内部锁或者Monitor锁</span></strong><span>，Monitor对象存在于每个Java对象的对象头Mark Word中。</span></li></ul><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>8</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 同步代码块</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">SynchronizedDemo</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">method</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">synchronized</span> (<span class="cm-keyword">this</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Method 1 start"</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 208px;"></div><div class="CodeMirror-gutters" style="height: 208px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><p><img src="../img/image-20211016135921947.png" referrerpolicy="no-referrer" alt="image-20211016135921947"><span> </span></p><h4><a name="代码块反编译结果" class="md-header-anchor"></a><span>代码块反编译结果</span></h4><ul><li><p><strong><span>monitorenter</span></strong><span>：每个对象都是一个monitor(监视器锁)，当monitor被占用时句处于锁定状态，线程执行</span><code>monitorenter</code><span>尝试获取monitor的过程如下：</span></p><ul><li><span>如果monitor的进入数为0则该线程进入并设置进入数+1，该线程就是monitor的所有者</span></li><li><span>如果该线程只是重新进入monitor则进入数+1</span></li><li><span>如果monitor已经被其他线程占用，则会阻塞，知道monitor的进入数为0，再尝试获取monitor的所有权</span></li></ul></li><li><p><strong><span>monitorexit</span></strong><span>：执行monitorexit的线程必须是对应的monitor的持有者，指令执行时，进入数-1，如果monitor进入数为0，这个线程就会退出，让其他被阻塞的线程去获取。</span></p></li></ul><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>6</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 同步方法</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">SynchronizedMethod</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">synchronized</span> <span class="cm-variable-3">void</span> <span class="cm-variable">method</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Hello World!"</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 156px;"></div><div class="CodeMirror-gutters" style="height: 156px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><p><img src="../img/image-20211016143727159.png" referrerpolicy="no-referrer" alt="image-20211016143727159"><span> </span></p><h4><a name="同步方法反编译结果" class="md-header-anchor"></a><span>同步方法反编译结果</span></h4><ul><li><p><span>从编译结果来看，方法的同步没有通过</span><strong><span>monitorenter</span></strong><span>和</span><strong><span>monitorexit</span></strong><span>来实现(理论上可以实现)，不过在常量池中多了</span><mark><code>ACC_SYNCHRONIZED</code></mark><span>标识符，JVM就是通过这个来实现方法同步的</span></p><blockquote><p><span>当方法调用时，调用指令会检查方法的ACC_SYNCHRONIZED访问标志是否被设置了，如果被设置了，执行线程将先获取monitor，获取成功后才能执行方法体，方法执行完再释放monitor，</span><mark><span>在方法执行期间其他任何线程都不能获取同一个monitor对象</span></mark></p></blockquote></li></ul><h2><a name="锁升级过程" class="md-header-anchor"></a><span>锁升级过程</span></h2><h4><a name="状态有4种等级依次由低到高为无锁状态偏向锁轻量级锁重量级锁" class="md-header-anchor"></a><span>状态有4种，等级依次由低到高为，无锁状态，偏向锁，轻量级锁，重量级锁 </span></h4><h4><a name="synchronized用的锁信息时存在对象头里的主要包含两部分数据mark-word标记字段klass-pointer类型指针" class="md-header-anchor"></a><span>synchronized用的锁信息时存在对象头里的。主要包含两部分数据：Mark Word(标记字段)，Klass Pointer(类型指针)。</span></h4><ul><li><strong><span>类型指针</span></strong><span>: 对象指向它类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例</span></li><li><strong><span>标记字段</span></strong><span>：默认存储对象的hashCode，GC分代年龄、</span><mark><span>锁状态标志</span></mark><span>、线程持有的锁、偏向线程 ID、偏向时间戳等。分代年龄以及标志位信息。它被设计成一个非固定的数据结构，里面的数据会根据 锁的变化而变化</span></li></ul><p><img src="../img/image-20211016105653447.png" referrerpolicy="no-referrer" alt="image-20211016105653447"><span> </span></p><ul><li><span>当有一个线程访问同步块的时候升级成偏向锁。偏向锁主要优化同一个线程多次访问同步代码块的问题。当偏向锁线程执行代码块时，又来一个线程访问代码块则升级成为轻量级锁。轻量级锁优化的是多个线程访问同步代码块的问题。然后自旋等待十次就会升级为重量级锁</span></li></ul><h2><a name="sleepwaityield方法的区别" class="md-header-anchor"></a><span>Sleep，wait，yield方法的区别</span></h2><ul><li><span>sleep()： 是属于Thread的方法，不会释放锁，只会使线程进入阻塞状态，让出cpu给其他线程，就是挂起，等睡眠时间过了就继续执行，不会考虑线程的优先级</span></li><li><span>wait()： wait()是object类的方法，只能在 synchronized 修饰的代码块中使用。使用期间会释放锁，只有调用notify()方法才能唤醒</span></li><li><span>yield()： 也是Thread的方法，只是暂停当前线程，不会释放锁。与sleep不同的是它不会使线程进入阻塞状态，而是回到就绪状态。</span></li></ul><h2><a name="什么是阻塞队列如何使用阻塞队列来实现生产者-消费者模型" class="md-header-anchor"></a><span>什么是阻塞队列？如何使用阻塞队列来实现生产者-消费者模型？</span></h2><h5><a name="阻塞队列有两个特性一个是当队列满了时插入数据的操作会阻塞当队列为空时获取数据的操作会阻塞阻塞队列不接受空值否则会报npe" class="md-header-anchor"></a><span>阻塞队列有两个特性，一个是当队列满了时，插入数据的操作会阻塞。当队列为空时，获取数据的操作会阻塞。阻塞队列不接受空值，否则会报NPE。</span></h5><h2><a name="cyclicbarrier-countdownlatch-semaphore-的用法" class="md-header-anchor"></a><span>CyclicBarrier、 CountDownLatch、 Semaphore 的用法</span></h2><h5><a name="countdownlatch-类似线程计数器就好比一个计数的闸门线程到达闸门计数-1当计数为0时继续往后执行同时闸门失效只能用一次" class="md-header-anchor"></a><span>CountDownLatch: 类似线程计数器，就好比一个计数的闸门，线程到达闸门，计数-1，当计数为0时继续往后执行，同时闸门失效，只能用一次。</span></h5><h5><a name="cyclicbarrier-字面意思是回环栅栏类似上面的可以重复使用就是可以使一组线程等待至某个状态后再同步执行叫做回环是因为所有线程都被释放后cyclicbarrier可以被重用" class="md-header-anchor"></a><span>CyclicBarrier： 字面意思是回环栅栏。类似上面的，可以重复使用。就是可以使一组线程等待至某个状态后再同步执行，叫做回环是因为所有线程都被释放后CyclicBarrier可以被重用。</span></h5><h5><a name="semaphore-字面意思信号量可以控制同时访问的线程数量通过acquire获的许可没有许可则一直等待release就是释放许可" class="md-header-anchor"></a><span>Semaphore： 字面意思信号量，可以控制同时访问的线程数量，通过acquire()获的许可，没有许可则一直等待，release()就是释放许可</span></h5><h2><a name="volatile-关键字的作用变量可见性禁止重排序）" class="md-header-anchor"></a><span>Volatile 关键字的作用（变量可见性、禁止重排序）</span></h2><h5><a name="是比synchronized关键字更轻量级的同步锁用来将变量的更新操作通知到其他线程不会缓存被volatile修饰的变量每次拿到的都是最新值有两个特性变量可见性禁止重排序变量可见性就是保证这个变量对所有的线程可见还有当一个线程修改了值其他线程也可以立即获得这个新值禁止重排序就是禁止了指令重排" class="md-header-anchor"></a><span>是比Synchronized关键字更轻量级的同步锁。用来将变量的更新操作通知到其他线程，不会缓存被volatile修饰的变量，每次拿到的都是最新值。有两个特性，变量可见性，禁止重排序。变量可见性就是保证这个变量对所有的线程可见，还有当一个线程修改了值，其他线程也可以立即获得这个新值。禁止重排序就是禁止了指令重排。</span></h5><h2><a name="threadlocal-作用线程隔离）" class="md-header-anchor"></a><span>ThreadLocal 作用（线程隔离）</span></h2><h5><a name="内部结构早起的版本是每个threadlocal都有一个mapmap的key为线程value为要保存的值现在的threadlocal是每个线程都维护一个threadlocalmapthrealocal对象为key要保存的值为valuethreadlocalmap-是threadlocal的静态内部类里面用来存数据的entry也是自己实现的不是继承map的entry的key只能是threadlocal还继承了weakreference表示key是弱引用" class="md-header-anchor"></a><span>内部结构：早起的版本是每个ThreadLocal都有一个map，map的key为线程，value为要保存的值。现在的ThreadLocal是每个线程都维护一个ThreadLocalMap，ThreaLocal对象为key，要保存的值为value。</span><strong><span>ThreadLocalMap</span></strong><span> 是ThreadLocal的静态内部类，里面用来存数据的Entry也是自己实现的不是继承map的。entry的key只能是ThreadLocal，还继承了</span><strong><span>WeakReference</span></strong><span>，表示key是弱引用。</span></h5><p><img src="../img/image-20211019193357730.png" referrerpolicy="no-referrer" alt="image-20211019193357730"><span> </span></p><h5><a name="弱引用和内存泄漏" class="md-header-anchor"></a><span>弱引用和内存泄漏：</span></h5><p><img src="../img/image-20211020153952597.png" referrerpolicy="no-referrer" alt="image-20211020153952597"><span> </span></p><p><span>首先始终有两条引用链引用着entry。不管上面那条是强引用还是弱引用，都存在引用链，entry都不会被回收，因为这个map是属于这个线程的，跟线程的生命周期一致。所以解决方法就是：</span></p><ul><li><span>手动remove，吧entry回收掉</span></li><li><span>让线程结束运行，对象也会被回收。</span></li></ul><p><span>为什么使用弱引用：因为在源码中只要调用set(),get(), remove()方法，如果key为null，都会把value回收掉，相当于多一层保障。</span></p><h2><a name="synchronized和reentrantlock的异同" class="md-header-anchor"></a><span>Synchronized和ReentrantLock的异同</span></h2><h5><a name="他们都是可重入锁就是一个线程可以多次获得同一个锁加锁方式同步都是阻塞式的同步就是一个线程获得对象锁进入了同步块其他访问这个同步块的线程需要在外面等待" class="md-header-anchor"></a><span>他们都是可重入锁，就是一个线程可以多次获得同一个锁。加锁方式同步，都是阻塞式的同步，就是一个线程获得对象锁，进入了同步块，其他访问这个同步块的线程需要在外面等待</span></h5><h5><a name="synchronized是java中的关键字reentrantlock是jdk15后提供的api层面的互斥锁需要lock和unlock方法手动加锁和解锁而synchronized是自动的不用手动加锁和释放锁reentrantlock的粒度和灵活性要比synchronized高reentrantlock提供了一些synchronized没有的功能响应中断非公平锁公平锁" class="md-header-anchor"></a><span>Synchronized是java中的关键字，ReentrantLock是jdk1.5后提供的api层面的互斥锁。需要lock()和unlock()方法手动加锁和解锁，而Synchronized是自动的，不用手动加锁和释放锁。ReenTrantLock的粒度和灵活性要比Synchronized高。ReentrantLock提供了一些Synchronized没有的功能，响应中断，非公平锁，公平锁。</span></h5><h2><a name="lock和synchronized的区别" class="md-header-anchor"></a><span>Lock和Synchronized的区别</span></h2><h5><a name="synchronized可以加在方法上类上代码块上lock需要显示的加锁和解锁为防止死锁一般在finally块中写unlocksynchronized是托管给jvm执行的lock是用代码写的是api层中操作synchronized是悲观锁机制即独占锁一个线程获取到锁其他线程都被阻塞效率低lock采用的乐观锁机制就是用的cas机制synchronized可以实现的lock都能实现lock还有更多功能如响应中断公平锁非公平锁" class="md-header-anchor"></a><span>Synchronized可以加在方法上，类上，代码块上。lock需要显示的加锁和解锁。为防止死锁一般在finally块中写unlock()。synchronized是托管给jvm执行的，lock是用代码写的，是api层中操作。synchronized是悲观锁机制，即独占锁，一个线程获取到锁，其他线程都被阻塞，效率低。Lock采用的乐观锁机制，就是用的CAS机制。synchronized可以实现的Lock都能实现，Lock还有更多功能，如响应中断，公平锁，非公平锁。</span></h5><h2><a name="java中用到的线程调度" class="md-header-anchor"></a><span>Java中用到的线程调度</span></h2><h5><a name="抢占式调度每条线程的执行时间系统的切换都由系统控制每条线程分配到不同的时间片在这种机制下一个线程阻塞不会导致整个系统崩溃" class="md-header-anchor"></a><span>抢占式调度：每条线程的执行时间，系统的切换都由系统控制。每条线程分配到不同的时间片，在这种机制下，一个线程阻塞不会导致整个系统崩溃。</span></h5><h5><a name="协同式调度就是一个线程执行完在接下一个线程执行类似接力赛不存在多线程同步问题但是如果有一个线程阻塞那么整个系统都会瘫痪" class="md-header-anchor"></a><span>协同式调度：就是一个线程执行完在接下一个线程执行。类似接力赛，不存在多线程同步问题，但是如果有一个线程阻塞，那么整个系统都会瘫痪。</span></h5><h2><a name="juc中的atomic类为什么是线程安全" class="md-header-anchor"></a><span>JUC中的atomic类为什么是线程安全</span></h2><h5><a name="当多个线程同时执行这里面的方法时具有排他性就是当某个线程进入方法执行其中的指令时不会被其他线程打断而别的线程就像自旋锁一样一直等到该方法执行完成才让其他线程进入" class="md-header-anchor"></a><span>当多个线程同时执行这里面的方法时，具有排他性。就是当某个线程进入方法执行其中的指令时，不会被其他线程打断，而别的线程就像自旋锁一样一直等到该方法执行完成，才让其他线程进入。</span></h5><h2><a name="注解" class="md-header-anchor"></a><span>注解</span></h2><h5><a name="四种元注解" class="md-header-anchor"></a><span>四种元注解</span></h5><ul><li><p><span>@Target: 修饰的对象范围，就是可不可以放在方法，类或者其他的上面</span></p></li><li><p><span>@Retention： 定义被保留的时间长短，就是注解的生命周期。有三个选项</span></p><ul><li><span>SOURCE：在源文件中有效</span></li><li><span>CLASS:在class文件中有效</span></li><li><span>RUNTIME:运行时有效</span></li></ul></li><li><p><span>@Document:Documented标记这个注解应该被 javadoc工具记录</span></p></li><li><p><span>@Inherited:如果使用@Inherited修饰的注解被用到某个class上，那么它的子类也会有</span><span>	</span></p></li><li><p><span>@interface：使用这个自定义注解时，不能继承其他的注解或接口。</span></p></li></ul><h5><a name="自定义注解" class="md-header-anchor"></a><span>自定义注解：</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>5</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">@Target(ElementType.METHOD)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">@Retention(RetentionPolicy.RUNTIME)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">@Documented</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">public @interface EnableAuth {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="height: 130px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h2><a name="redis的五种数据类型的应用场景和数据结构" class="md-header-anchor"></a><span>Redis的五种数据类型的应用场景和数据结构</span></h2><h4><a name="场景" class="md-header-anchor"></a><span>场景</span></h4><ul><li><span>string： 通常用于保存单个字符串或json字符串数据，因为他是二进制安全的，所以可以吧图片文件的内容当成字符串存储，还可以做计数器(常规k-v缓存应用，常规计数，微博数，粉丝数)。</span></li><li><span>hash：常用于存储一个对象信息或商品信息。</span></li><li><span>list： 对数据量大的集合进行删减，可以做为任务队列。</span></li><li><span>set： 常用于对集合进行交集，并集，差集运算，实现共同好友等功能</span></li><li><span>zset：一般用于做排行榜，积分排行什么的还有销量排行</span></li></ul><h5><a name="结构" class="md-header-anchor"></a><span>结构</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>17</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">redis的一种数据类型都是一个对象，由于redis是k-v结构的，所以每次创建一个数据就会创建两个对象，k对象和v对象</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">这个就是value对象(redisobject对象)的属性</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">typedef struct redisObject{</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; //类型</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; unsigned type:4;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; //编码</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-tab" role="presentation" cm-text="	">   </span>unsigned encoding:4;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-tab" role="presentation" cm-text="	">   </span>//指向底层数据结构的指针</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-tab" role="presentation" cm-text="	">   </span>void *ptr;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-tab" role="presentation" cm-text="	">   </span>//引用计数</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-tab" role="presentation" cm-text="	">   </span>int refcount;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>//记录最后一次被程序访问的时间</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-tab" role="presentation" cm-text="	">   </span>unsigned lru:22;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> }robj</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 442px;"></div><div class="CodeMirror-gutters" style="height: 442px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre><h6><a name="string底层用的是sds简单动态字符串实现的它有三个属性free-len-buffree是剩余空间len是目前字符串的长度-buf是一个list存放真正的字符串数据" class="md-header-anchor"></a><span>string底层用的是SDS(简单动态字符串)实现的。它有三个属性，free， len， buf。free是剩余空间，len是目前字符串的长度， buf是一个list存放真正的字符串数据</span></h6><h6><a name="list底层使用的是链表结构有三个属性head指向链表的头部tail指向链表的尾部len是链表的长度redis是c语言写的但是c语言没有内置这个数据结构redis自己构建的双向链表	一个listnode包含前置节点后置节点节点的值然后多个listnode就能组成一个链表" class="md-header-anchor"></a><span>list底层使用的是链表结构。有三个属性，head指向链表的头部，tail指向链表的尾部，len是链表的长度。redis是c语言写的，但是c语言没有内置这个数据结构。redis自己构建的双向链表。</span><span>	</span><span>一个listNode包含前置节点，后置节点，节点的值。然后多个listNode就能组成一个链表</span></h6><h6><a name="hash结构底层类似jdk18之前的hashmap内部实现也差不多数组链表使用的hash表采用的链地址法解决的hash冲突" class="md-header-anchor"></a><span>hash结构底层类似JDK1.8之前的HashMap，内部实现也差不多(数组+链表)，使用的hash表，采用的链地址法解决的hash冲突。</span></h6><h6><a name="set底层使用的是一个叫整数集合的东西intsetintset有三个属性encoding记录数据的类型int16int32等length记录集合的长度content存着具体的数据" class="md-header-anchor"></a><span>set底层使用的是一个叫整数集合的东西(intset)。intset有三个属性，encoding记录数据的类型，int16，int32等，length记录集合的长度，content存着具体的数据</span></h6><h6><a name="zset底层是跳跃表实现的跳跃表由很多层构成每一层都是一个有序链表最底层的链表包含所有元素如果一个元素出现在level-x上那它在level-x链表之下也会出现每个节点包含两个指针一个指向链表的下一个元素一个指向下一层元素" class="md-header-anchor"></a><span>zset底层是跳跃表实现的。跳跃表由很多层构成，每一层都是一个有序链表，最底层的链表包含所有元素，如果一个元素出现在level x上，那它在level x链表之下也会出现，每个节点包含两个指针，一个指向链表的下一个元素，一个指向下一层元素。</span></h6><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>8</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">level 3  -1 ============&gt; 21 =======&gt; 37 ====================&gt; 1</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>  ↓<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>  ↓<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>  ↓</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">level 2  -1 =&gt; 7 =======&gt; 21 =======&gt; 37 =&gt; 71 ==============&gt; 1</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp;  ↓ &nbsp;  ↓ <span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span>  ↓ <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>  ↓  <span class="cm-tab" role="presentation" cm-text="	">   </span>↓<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">level 1  -1 =&gt; 7 =&gt; 14 =&gt; 21 =&gt; 32 =&gt; 37 =&gt; 71 =&gt; 85 =&gt; 117 =&gt; 1</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">其中 -1 表示 INT_MIN， 链表的最小值，1 表示 INT_MAX，链表的最大值。</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 208px;"></div><div class="CodeMirror-gutters" style="height: 208px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h2><a name="redis怎么做内存优化" class="md-header-anchor"></a><span>Redis怎么做内存优化</span></h2><ul><li><span>redisObject对象</span></li><li><span>缩减键值对象</span></li><li><span>共享对象池</span></li><li><span>字符串优化</span></li><li><span>编码优化</span></li><li><span>控制key的数量</span></li></ul><h2><a name="redis-有哪几种数据淘汰策略" class="md-header-anchor"></a><span>Redis 有哪几种数据淘汰策略？</span></h2><h4><a name="volatile-lru-从设置了过期时间的数据集中选择最近最久未使用的数据释放" class="md-header-anchor"></a><strong><span>volatile-lru:</span></strong><span> 从设置了过期时间的数据集中，选择最近最久未使用的数据释放；</span></h4><h4><a name="allkeys-lru从数据集中包括设置过期时间以及未设置过期时间的数据集中选择最近最久未使用的数据释放" class="md-header-anchor"></a><strong><span>allkeys-lru:</span></strong><span>从数据集中(包括设置过期时间以及未设置过期时间的数据集中)，选择最近最久未使用的数据释放；</span></h4><h4><a name="volatile-random从设置了过期时间的数据集中随机选择一个数据进行释放" class="md-header-anchor"></a><strong><span>volatile-random:</span></strong><span>从设置了过期时间的数据集中，随机选择一个数据进行释放；</span></h4><h4><a name="allkeys-random从数据集中包括了设置过期时间以及未设置过期时间随机选择一个数据进行入释放" class="md-header-anchor"></a><strong><span>allkeys-random:</span></strong><span>从数据集中(包括了设置过期时间以及未设置过期时间)随机选择一个数据进行入释放；</span></h4><h4><a name="volatile-ttl从设置了过期时间的数据集中选择马上就要过期的数据进行释放操作" class="md-header-anchor"></a><strong><span>volatile-ttl：</span></strong><span>从设置了过期时间的数据集中，选择马上就要过期的数据进行释放操作；</span></h4><h4><a name="noeviction不删除任意数据但redis还会根据引用计数器进行释放这时如果内存不够时会直接返回错误" class="md-header-anchor"></a><strong><span>noeviction：</span></strong><span>不删除任意数据(但redis还会根据引用计数器进行释放),这时如果内存不够时，会直接返回错误。</span></h4><h4><a name="volatile-lfu从已经设置过期时间的数据中挑选最不经常使用的数据-淘汰" class="md-header-anchor"></a><strong><span>volatile-lfu：</span></strong><span>从已经设置过期时间的数据中挑选最不经常使用的数据 淘汰</span></h4><h4><a name="allkeys-lfu从全部key中挑选最不经常使用的数据-淘汰" class="md-header-anchor"></a><strong><span>allkeys-lfu：</span></strong><span>从全部key中挑选最不经常使用的数据 淘汰</span></h4><h2><a name="布隆过滤器" class="md-header-anchor"></a><span>布隆过滤器</span></h2><h5><a name="是一个bit数组和一系列的hash算法优点就是比一般的算法效率更高缺点是有一定的误识别率和删除困难带过滤器的布隆过滤器有remove可以删除如果两个元素的hash值在同一个位置name计数器会1当remove时计数器-1当计数器为0时才把这个位置的值1改成0它的原理就是它初始化的时候是一个全为0的bit数组还有n个hash算法如果有集合元素x1-x2然后x1x2经过这3个hash算法就得到一个部分为1-部分为2的bit数组" class="md-header-anchor"></a><span>是一个bit数组和一系列的hash算法。优点就是比一般的算法效率更高，缺点是有一定的误识别率和删除困难。带过滤器的布隆过滤器有remove()可以删除。如果两个元素的hash值在同一个位置，name计数器会+1，当remove()时，计数器-1，当计数器为0时才把这个位置的值1改成0。它的原理就是它初始化的时候是一个全为0的bit数组，还有n个hash算法，如果有集合元素x1, x2，然后x1，x2经过这3个hash算法就得到一个部分为1， 部分为2的bit数组。</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>7</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>x1</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>↓<span class="cm-tab" role="presentation" cm-text="	">   </span>↓<span class="cm-tab" role="presentation" cm-text="	">   </span>↓</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>0<span class="cm-tab" role="presentation" cm-text="	">   </span>1<span class="cm-tab" role="presentation" cm-text="	">   </span>1<span class="cm-tab" role="presentation" cm-text="	">   </span>1<span class="cm-tab" role="presentation" cm-text="	">   </span>1<span class="cm-tab" role="presentation" cm-text="	">   </span>0<span class="cm-tab" role="presentation" cm-text="	">   </span>0<span class="cm-tab" role="presentation" cm-text="	">   </span>1<span class="cm-tab" role="presentation" cm-text="	">   </span>0<span class="cm-tab" role="presentation" cm-text="	">   </span>bit数组</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>↑<span class="cm-tab" role="presentation" cm-text="	">   </span>↑<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>↑</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>x2</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>↓箭头表示x1经过的3次hash算法，↑表示x2经过的hash算法</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 182px;"></div><div class="CodeMirror-gutters" style="height: 182px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h5><a name="如何判断一个元素x3是否在这个集合中就把x3使用这3个hash算法即可如果经过3次hash算法其中的得到的映射值有一个为0那不在里面如果全为1就一定在里面但是有时候会有误识别数组越长误识别率越低解决缓存穿透就是把redis的数据都放到bit数组中然后用户请求存在的值一定放行部分不存在的值也会放行这些少量的值对数据库的影响就比较小了" class="md-header-anchor"></a><span>如何判断一个元素x3是否在这个集合中，就把x3使用这3个hash算法即可。如果经过3次hash算法，其中的得到的映射值有一个为0那不在里面，如果全为1就一定在里面，但是有时候会有误识别。数组越长，误识别率越低。解决缓存穿透就是把redis的数据都放到bit数组中，然后用户请求存在的值一定放行，部分不存在的值也会放行，这些少量的值对数据库的影响就比较小了。</span></h5><h2><a name="redis集群方案怎么做" class="md-header-anchor"></a><span>Redis集群方案怎么做？</span></h2><h5><a name="官方cluster方案从redis-30版本开始支持redis-cluster集群redis-clustar采用无中心结构每个节点保存数据和整个集群状态每个节点都和其他节点连接是一种服务端分片技术" class="md-header-anchor"></a><span>官方cluster方案：从redis 3.0版本开始支持redis-cluster集群，redis-clustar采用无中心结构，每个节点保存数据和整个集群状态，每个节点都和其他节点连接，是一种服务端分片技术。</span></h5><h5><a name="twemproxy代理方案twemproxy是redis代理中间件利用一种中间件做分片的技术它接收客户端请求然后在转发给redis服务器降低了客户端直连后端的数量" class="md-header-anchor"></a><span>twemproxy代理方案：twemproxy是redis代理中间件，利用一种中间件做分片的技术。它接收客户端请求然后在转发给redis服务器，降低了客户端直连后端的数量</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>5</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">client1 &nbsp; -&gt;<span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>-&gt;<span class="cm-tab" role="presentation" cm-text="	">  </span>redis</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">client2<span class="cm-tab" role="presentation" cm-text="	"> </span>  -&gt;<span class="cm-tab" role="presentation" cm-text="	">    </span>twemproxy<span class="cm-tab" role="presentation" cm-text="	">   </span>-&gt;<span class="cm-tab" role="presentation" cm-text="	">  </span>redis</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">client3<span class="cm-tab" role="presentation" cm-text="	"> </span>  -&gt;<span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>-&gt;<span class="cm-tab" role="presentation" cm-text="	">  </span>redis</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="height: 130px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h5><a name="哨兵模式由一个或者多个sentinel实例组成的系统可以监视任意多个主服务器已经他们的从服务器在监视状态下主服务器进入下线状态就会把这个主服务器下的从服务器升级成新的主服务器" class="md-header-anchor"></a><span>哨兵模式：由一个或者多个Sentinel实例组成的系统可以监视任意多个主服务器已经他们的从服务器，在监视状态下主服务器进入下线状态，就会把这个主服务器下的从服务器升级成新的主服务器</span></h5><h5><a name="codiscodis是一个分布式的redis解决方案对客户端来说连接codis-proxy和连接redis-server没有明显区别就像使用单机redis一codis底层会处理转发请求" class="md-header-anchor"></a><span>codis：codis是一个分布式的redis解决方案。对客户端来说连接codis proxy和连接redis server没有明显区别，就像使用单机redis一，codis底层会处理转发请求。</span></h5><h5><a name="客户端分片在业务代码层实现对key进行hash计算然后取操作对应的redis实例就是由客户端自己选择到那个redis节点" class="md-header-anchor"></a><span>客户端分片：在业务代码层实现，对key进行hash计算，然后取操作对应的redis实例。就是由客户端自己选择到那个redis节点。</span></h5><h2><a name="说说-redis-哈希槽的概念" class="md-header-anchor"></a><span>说说 Redis 哈希槽的概念？</span></h2><h5><a name="redis最大集群数是16384个redis集群没有使用一致性hash用的是hash槽redis先用crc16算法算出一个结果然后把结果对16384取余这样每个key都会在0-16384之间的哈希槽集群的每个节点负责一部分hash槽他的好处就是增加删除节点比较方便" class="md-header-anchor"></a><span>redis最大集群数是16384个。redis集群没有使用一致性hash，用的是hash槽。redis先用crc16算法算出一个结果，然后把结果对16384取余，这样每个key都会在0-16384之间的哈希槽,集群的每个节点负责一部分hash槽。他的好处就是增加删除节点比较方便</span></h5><h2><a name="redis的watch-dog机制" class="md-header-anchor"></a><span>Redis的watch dog机制</span></h2><h5><a name="当客户端1加锁的锁key默认时间30秒如果超过30秒客户端1还想持有这把锁当客户端1加锁成功就会启动一个watch-dog看门狗这是一个后台线程会每间隔10秒检查一下如果客户端还持有锁key那么就会不断延长锁key的生存时间" class="md-header-anchor"></a><span>当客户端1加锁的锁key默认时间30秒，如果超过30秒客户端1还想持有这把锁。当客户端1加锁成功，就会启动一个watch dog，看门狗，这是一个后台线程，会每间隔10秒检查一下，如果客户端还持有锁key，那么就会不断延长锁key的生存时间</span></h5><h2><a name="redis-和-memcached-有啥区别而且redis为什么这么快" class="md-header-anchor"></a><span>Redis 和 memcached 有啥区别？而且redis为什么这么快？</span></h2><h5><a name="redis支持五种数据类型mc只有两种redis支持持久化mc不支持redis支持集群mc不支持因为redis是纯内存操作核心是基于非阻塞的io多路复用机制而且它是单线程的避免了线程上下文的切换" class="md-header-anchor"></a><span>redis支持五种数据类型，mc只有两种。redis支持持久化，mc不支持。redis支持集群，mc不支持。因为redis是纯内存操作，核心是基于非阻塞的IO多路复用机制，而且它是单线程的避免了线程上下文的切换</span></h5><h2><a name="redis-主从复制如何实现的-redis-的哨兵模式如何实现redis-的-key-是如何寻址的" class="md-header-anchor"></a><span>Redis 主从复制如何实现的？ redis 的哨兵模式如何实现？redis 的 key 是如何寻址的？</span></h2><h5><a name="主从复制从服务器连上主服务器发送psync指令然后master判断是全量复制还是增量复制全量复制master启动一个子线程生成一个rdb快照文件同时把从客户端收到的命令存在缓存中生成完成后会把rdb文件发给从服务器从服务器收到后会吧旧数据清空掉然后持久化到本地磁盘然后在写入内存中最后从服务器保存完成后master会把缓存中的命令发给从服务器同步数据增量复制在全量复制中网络断掉了从机重新连上主机时会触发增量复制master直接从自己的backlog中获取部分丢失的数据发给从机" class="md-header-anchor"></a><span>主从复制：从服务器连上主服务器，发送psync指令，然后master判断是全量复制还是增量复制。全量复制，master启动一个子线程生成一个RDB快照文件，同时把从客户端收到的命令存在缓存中，生成完成后会把RDB文件发给从服务器。从服务器收到后会吧旧数据清空掉，然后持久化到本地磁盘然后在写入内存中。最后从服务器保存完成后，master会把缓存中的命令发给从服务器，同步数据。增量复制，在全量复制中网络断掉了，从机重新连上主机时会触发增量复制，master直接从自己的backlog中获取部分丢失的数据发给从机。</span></h5><h5><a name="哨兵模式有三个任务监控sentinel会不断检查主服务器和从服务器看是否可用提醒-当一个服务器发生故障他可以通过api向其他机器发提醒告诉他们这个机器挂了自动故障迁移-当一个主服务器挂了之后它会进行选举将一个从服务器选举成为新的主服务器当客户端试图请求失效的服务器时集群也会返回新服务器的地址故障切换过程会先投票当master挂了sentinel会进行投票超过半数就下线然后在进行选举在从服务器中选举出一个新的主服务器" class="md-header-anchor"></a><span>哨兵模式：有三个任务，监控：Sentinel会不断检查主服务器和从服务器看是否可用。提醒： 当一个服务器发生故障，他可以通过api向其他机器发提醒告诉他们这个机器挂了。自动故障迁移: 当一个主服务器挂了之后，它会进行选举，将一个从服务器选举成为新的主服务器，当客户端试图请求失效的服务器时，集群也会返回新服务器的地址。故障切换过程会先投票，当master挂了，sentinel会进行投票，超过半数就下线。然后在进行选举，在从服务器中选举出一个新的主服务器。</span></h5><h5><a name="redis的key-是如何寻址的有三种hash算法一致性hash算法hash-slot算法" class="md-header-anchor"></a><span>redis的key 是如何寻址的:有三种，hash算法，一致性hash算法，hash slot算法</span></h5><ul><li><span>hash算法： 首先计算key的hash值，然后对节点数取余，打在不同的master上。假如一个master宕机，所有请求过来都会对最新的节点数取余，尝试获取数据，这样就会获取不到。</span></li><li><span>一致性hash： 这种方法吧hash值空间组织成一个虚拟的圆环，整个空间按照顺时针方向组织，然后将master节点(ip或主机名)进行hash，确定在hash环上的位置。对于一个key先计算它的hash值，然后顺时针走遇到的第一个master就是key所在的位置。在master节点较少的情况下容易造成缓存热点的问题，所以引入了虚拟节点机制。就是对每个节点计算多个hash，在计算结果的每个位置放虚拟节点，就实现了均匀分布。</span></li><li><span>hash slot算法： redis cluster有16384个hash槽，对每个key计算CRC16值，然后对16384取余，获取key对应的hash槽。</span></li></ul><h5><a name="当主从复制中主服务器挂了更好的办法就是哨兵模式哨兵模式中主服务器宕机就没有可以写的服务器了所以引出redis-clustar集群" class="md-header-anchor"></a><span>当主从复制中主服务器挂了，更好的办法就是哨兵模式，哨兵模式中主服务器宕机就没有可以写的服务器了，所以引出redis clustar集群</span></h5><h2><a name="redis分布式锁" class="md-header-anchor"></a><span>Redis分布式锁</span></h2><h5><a name="实现redis分布式锁要满足在任意时刻只有一个客户端能持有锁互斥客户端崩溃没有主动解锁也要保证后续其他人能加锁不能死锁只有大部分redis节点正常运行客户端就可以加锁解锁容错性可以通过set命令加锁设置一个值然后给过期时间在加个nx表示如果存在就不能插进去解锁的时候要验证value的正确性加锁的时候设置锁跟设置过期时间要是原子操作解锁的时候获取锁跟删除锁要是原子操作" class="md-header-anchor"></a><span>实现redis分布式锁要满足在任意时刻只有一个客户端能持有锁(互斥)，客户端崩溃没有主动解锁也要保证后续其他人能加锁(不能死锁)，只有大部分redis节点正常运行，客户端就可以加锁解锁(容错性)。可以通过set命令加锁，设置一个值然后给过期时间，在加个nx表示如果存在就不能插进去，解锁的时候要验证value的正确性。加锁的时候设置锁跟设置过期时间要是原子操作，解锁的时候获取锁跟删除锁要是原子操作</span></h5><h2><a name="redisson的分布式锁实现" class="md-header-anchor"></a><span>Redisson的分布式锁实现</span></h2><h5><a name="它是怎么加锁的呢就是两个线程同时获取锁获取成功的就执行lua脚本然后加锁获取锁失败的那个客户端就不停的尝试获取锁知道获取成功当客户端1超过30秒还想获取这把锁看门狗机制就会每隔10秒检查一下如果还持有就延长获取锁的时间释放锁的时候会判断key是否存在然后要判断value的值是否相同相同的话就把重入次数减1redisson是支持重入的当重入次数为0就把key删除把锁释放" class="md-header-anchor"></a><span>它是怎么加锁的呢？就是两个线程同时获取锁，获取成功的就执行lua脚本，然后加锁。获取锁失败的那个客户端就不停的尝试获取锁知道获取成功，当客户端1超过30秒还想获取这把锁，看门狗机制就会每隔10秒检查一下，如果还持有就延长获取锁的时间。释放锁的时候会判断key是否存在，然后要判断value的值是否相同，相同的话就把重入次数减1,(redisson是支持重入的)，当重入次数为0就把key删除把锁释放。</span></h5><h2><a name="zookeeper实现分布式锁" class="md-header-anchor"></a><span>Zookeeper实现分布式锁</span></h2><h5><a name="在zookepper中与要锁的方法对应的节点locker下创建一个临时有序节点nodea然后获取locker下所有子节点然后多个客户端来获取锁节点数量就会大于1先创建的节点编号肯定是小于后创建节点的然后从小到大排序排在第一位的就是最先创建的节点然后判断这个节点是不是刚创建的nodea如果是就表示获取到了锁不是的话就是没拿到锁就会监听比nodea节点小的里面最大的节点的删除事件当删除后就获取所有的子节点然后在比较知道nodea是最小的表示它拿到了锁" class="md-header-anchor"></a><span>在zookepper中与要锁的方法对应的节点locker下创建一个临时有序节点node_A，然后获取locker下所有子节点。然后多个客户端来获取锁，节点数量就会大于1。先创建的节点编号肯定是小于后创建节点的，然后从小到大排序，排在第一位的就是最先创建的节点，然后判断这个节点是不是刚创建的node_A，如果是就表示获取到了锁，不是的话就是没拿到锁，就会监听比node_A节点小的里面最大的节点的删除事件，当删除后就获取所有的子节点然后在比较，知道node_A是最小的表示它拿到了锁。</span></h5><h2><a name="redis分布式锁跟zk分布式锁的区别" class="md-header-anchor"></a><span>Redis分布式锁跟zk分布式锁的区别</span></h2><h5><a name="redis锁获取锁需要一直尝试获取zk锁的话只要注册一个监听器监听节点的删除事件即可当服务器挂了redis锁就要等待自动超时zk锁由于是创建的临时节点服务器宕机就会自动释放锁" class="md-header-anchor"></a><span>redis锁获取锁需要一直尝试获取，zk锁的话只要注册一个监听器监听节点的删除事件即可。当服务器挂了redis锁就要等待自动超时，zk锁由于是创建的临时节点，服务器宕机就会自动释放锁</span></h5><h2><a name="知道-redis-的持久化吗底层如何实现的有什么优点缺点" class="md-header-anchor"></a><span>知道 redis 的持久化吗？底层如何实现的？有什么优点缺点？</span></h2><ul><li><span>RDB：首先触发RDB快照有15分钟1次操作，5分钟10次操作和1分钟10000次操作，还有关服务器的时候会快照一次，flashALL的时候也会快照。redis会使用fork函数复制一个线程然后把内存中的数据写入硬盘，然后父进程继续接受命令，等写入完成后会把写入系统的文件覆盖掉旧的RDB文件。</span></li><li><span>AOF：aof以日志的方式记录每个写操作，redis重启就是把aof里的指令全部执行一次。appendfsync everysec有三种策略，always：每次执行写操作就重写一次aof文件，everysec： 每秒重写一次。no：不主动重写，等系统进行数据缓存的时候才重写。</span></li><li><span>优缺点：rdb方式因为是快照所以文件小，还原速度快。缺点是容易丢失数据，而且fork进程的时候会使内存翻倍。aof方式性能较差但是数据完整性好，加载优先级高，缺点就是恢复速度慢。</span></li></ul><h2><a name="假如-redis-里面有-1-亿个-key其中有-10w-个-key-是以某个固定的已知的前缀开头的如何将它们全部找出来" class="md-header-anchor"></a><span>假如 Redis 里面有 1 亿个 key，其中有 10w 个 key 是以某个固定的已知的前缀开头的，如何将它们全部找出来</span></h2><h5><a name="使用keys指令可以扫出指定模式的key列表" class="md-header-anchor"></a><span>使用keys指令可以扫出指定模式的key列表。</span></h5><h5><a name="对方接着追问如果这个redis正在给线上的业务提供服务那使用keys指令会有什么问题" class="md-header-anchor"></a><span>对方接着追问：如果这个redis正在给线上的业务提供服务，那使用keys指令会有什么问题？</span></h5><p><span>这个时候你要回答redis关键的一个特性：redis的单线程的。keys指令会导致线程阻塞一段时间，线上服务会停顿，直到指令执行完毕，服务才能恢复。这个时候可以使用scan指令，scan指令可以无阻塞的提取出指定模式的key列表，但是会有一定的重复概率，在客户端做一次去重就可以了，但是整体所花费的时间会比直接用keys指令长。</span></p><h2><a name="说说你对spring的理解" class="md-header-anchor"></a><span>说说你对spring的理解</span></h2><h5><a name="iocioc就是控制反转用户不用自己创建对象了交给spring的ioc容器管理由容器根据反射创建对象来使用ioc注入方式有四种构造方法set方法xml注解" class="md-header-anchor"></a><span>IOC：ioc就是控制反转，用户不用自己创建对象了，交给spring的ioc容器管理，由容器根据反射创建对象来使用。ioc注入方式有四种，构造方法，set方法，xml，注解。</span></h5><h5><a name="aopaop就是面向切面编程把与业务逻辑无关的代码提取出来降低模块之间的耦合aop中用来了动态代理又分为jdk自带的和cglib动态代理jdk动态代理必须实现一个以上的接口用反射机制生成一个代理接口的匿名类首先要创建一个实现invocationhandler的类然后实现invoke方法在这个方法中可以再方法执行前后做一些处理cglib代理就是对于那种没有实现接口的类使用cglib动态代理动态生成目标类的子类进行代理除此之外还有一个静态代理aspectjaop是程序运行的时候给方法增强aspectj是在编译期间增强aop是基于代理的aspectsj是基于字节码编译" class="md-header-anchor"></a><span>AOP：aop就是面向切面编程，把与业务逻辑无关的代码提取出来，降低模块之间的耦合。aop中用来了动态代理，又分为jdk自带的和cglib动态代理。jdk动态代理必须实现一个以上的接口，用反射机制生成一个代理接口的匿名类。首先要创建一个实现InvocationHandler的类，然后实现invoke方法，在这个方法中可以再方法执行前后做一些处理。cglib代理就是对于那种没有实现接口的类，使用cglib动态代理，动态生成目标类的子类进行代理。除此之外还有一个静态代理Aspectj，aop是程序运行的时候给方法增强，aspectj是在编译期间增强。aop是基于代理的，aspectsj是基于字节码编译。</span></h5><h5><a name="在-java-动态代理机制中-invocationhandler-接口和-proxy-类是核心" class="md-header-anchor"></a><span>在 Java 动态代理机制中 InvocationHandler 接口和 Proxy 类是核心。</span></h5><h5><a name="在-cglib-动态代理机制中-methodinterceptor-接口和-enhancer-类是核心" class="md-header-anchor"></a><span>在 CGLIB 动态代理机制中 MethodInterceptor 接口和 Enhancer 类是核心。</span></h5><h2><a name="beanfactory和applicationcontext有什么区别" class="md-header-anchor"></a><span>BeanFactory和ApplicationContext有什么区别？</span></h2><h5><a name="beanfactory是spring的最底层接口applicationcontext是beanfactory的子类他们两都可以作为容器使用beanfactory是使用的延迟加载只有需要用到bean的时候才加载applicationcontext就是一次把所有的bean都加载好" class="md-header-anchor"></a><span>BeanFactory是spring的最底层接口，ApplicationContext是BeanFactory的子类，他们两都可以作为容器使用。BeanFactory是使用的延迟加载，只有需要用到bean的时候才加载。ApplicationContext就是一次把所有的bean都加载好</span></h5><h2><a name="请解释-spring-bean-的自动装配" class="md-header-anchor"></a><span>请解释 Spring Bean 的自动装配</span></h2><ul><li><span>no： 这种方式是默认的，不使用自动装配</span></li><li><span>byName： 通过属性名称自动装配，会从容器中根据</span><code>&lt;bean&gt;</code><span>的id属性找。</span></li><li><span>byType： 通过类型自动装配，从容器中的</span><code>&lt;bean&gt;</code><span>的class属性中找。如果找到多个就会报错</span></li><li><span>constructor： 和byType差不多，但是应用于构造函数，如果容器中没有就报错</span></li><li><span>autodetect： 自动选择，如果对象没有无参构造方法，就自动选择constructor注入，如果有无参构造就使用byType进行setter注入</span></li></ul><h2><a name="spring中bean的加载过程" class="md-header-anchor"></a><span>Spring中bean的加载过程</span></h2><h2><a name="spring中bean的生命周期" class="md-header-anchor"></a><span>Spring中bean的生命周期</span></h2><h5><a name="精简版-首先通过构造方法或工厂方法创建bean实例给bean设置值和其他对象的引用然后把bean传到后置处理器的postprocessbeforeinitialization方法然后调用bean的初始化方法然后把bean传给后置处理器的postprocessafterinitialization方法然后就可以用到bean了当容器关闭时就调用bean的销毁方法" class="md-header-anchor"></a><span>精简版： 首先通过构造方法或工厂方法创建Bean实例，给Bean设置值和其他对象的引用。然后把Bean传到后置处理器的postProcessBeforeInitialization方法，然后调用bean的初始化方法。然后把bean传给后置处理器的postProcessAfterInitialization方法，然后就可以用到bean了，当容器关闭时就调用bean的销毁方法。</span></h5><ul><li><span>首先spring对bean进行实例化，</span></li><li><span>然后把值和引用注入到bean中。</span></li><li><span>如果Bean实现了BeanNameAware接口，Spring将Bean的ID传递给setBeanName()方法，</span></li><li><span>如果Bean实现了BeanFactoryAware接口，Spring将调用setBeanDactory(BeanFactory bf)方法并把BeanFactory容器实例作为参数传入，</span></li><li><span>如果Bean实现了ApplicationContextAwaer接口，Spring容器将调用setApplicationContext(ApplicationContext ctx)方法，把y应用上下文作为参数传入，</span></li><li><span>如果Bean实现了BeanPostProcess接口，Spring将调用它们的postProcessBeforeInitialization（预初始化）方法（初始化前执行，作用是在Bean实例创建成功后对进行增强处理，如对Bean进行修改，增加某个功能），</span></li><li><span>如果Bean实现了InitializingBean接口，Spring将调用它们的afterPropertiesSet方法，作用是在bean的全部属性设置成功后初始化，</span></li><li><span>如果Bean实现了BeanPostProcess接口，Spring将调用它们的postProcessAfterInitialization（初始化后执行）方法</span></li><li><span>如果Bean实现了DispostbleBean接口，Spring将调用它的destory方法，作用与在配置文件中对Bean使用destory-method属性的作用一样，都是在Bean实例销毁前执行的方法</span></li></ul><h2><a name="spring中的循环依赖" class="md-header-anchor"></a><span>Spring中的循环依赖</span></h2><h5><a name="首先循环依赖就是a依赖bb依赖c-c依赖a然后互相依赖分为两种-构造器循环依赖setter循环依赖构造器循环依赖spring解决不了就是usera对象的有参构造是userbuserb的有参构造是userc-userc的有参构造是usera到时候就会报错" class="md-header-anchor"></a><span>首先循环依赖就是A依赖B，B依赖C， C依赖A，然后互相依赖，分为两种： 构造器循环依赖，setter循环依赖。构造器循环依赖(spring解决不了),就是UserA对象的有参构造是UserB，UserB的有参构造是UserC， UserC的有参构造是UserA。到时候就会报错</span></h5><h5><a name="解决方法" class="md-header-anchor"></a><span>解决方法:</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>5</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">不使用构造方式注入，使用set方式注入</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">首先bean初始化的时候先实例化对象，然后在填充属性，过程中就可能出现循环依赖，spring使用了三级缓存来解决</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">假设a，b对象，首先spring通过ApplicationContext.getBean()方法实例化a对象，发现a对象依赖了b对象，就会递归实例化b对象</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">然后发现b对象依赖了a对象，就会把半成品的a对象设置进去，然后反递归吧b对象设置到a对象里。前提是spring开启了allowCircularReferences</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">正在创建的bean会放到半成品池子中，在注入的时候就会先往成品池子中获取，获取不到在从半成品池子中获取</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 156px;"></div><div class="CodeMirror-gutters" style="height: 156px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h2><a name="spring-提供了以下-5-中标准的事件" class="md-header-anchor"></a><span>Spring 提供了以下 5 中标准的事件</span></h2><ul><li><span>上下文更新事件（ContextRefreshedEvent）：该事件会在 ApplicationContext 被初始化或者更新时发布。也可以在调用 ConfigurableApplicationContext 接口中的 refresh()方法时被触发。</span></li><li><span>上下文开始事件（ContextStartedEvent）：当容器调用 ConfigurableApplicationContext 的Start()方法开始/重新开始容器时触发该事件。</span></li><li><span>上下文停止事件（ContextStoppedEvent）：当容器调用 ConfigurableApplicationContext 的Stop()方法停止容器时触发该事件。</span></li><li><span>上下文关闭事件（ContextClosedEvent）：当 ApplicationContext 被关闭时触发该事件。容器被关闭时，其管理的所有单例 Bean 都被销毁。</span></li><li><span>请求处理事件（RequestHandledEvent）：在 Web 应用中，当一个 http 请求（request）结束触发该事件。</span></li><li><span>还有一种通过扩展 ApplicationEvent 类来开发自定义的事件，要监听这个事件，还需要创建一个监听器，然后通过 applicationContext 接口的 publishEvent()方法来发布自定义事件。</span></li></ul><h2><a name="spring中的事务" class="md-header-anchor"></a><span>Spring中的事务</span></h2><h5><a name="分为两种一种是编程式事务一种是声明式事务声明式事务只需要用到transactional注解就可以了声明式事务就是使用aop对方法惊醒增强在方法执行的前后开启事务在方法执行后回滚或者提交事务" class="md-header-anchor"></a><span>分为两种，一种是编程式事务，一种是声明式事务。声明式事务只需要用到@Transactional注解就可以了。声明式事务就是使用AOP对方法惊醒增强，在方法执行的前后开启事务在方法执行后回滚或者提交事务。</span></h5><ul><li><p><span>@Transactional注解的参数</span></p><ul><li><p><span>timeout: 默认30秒超时</span></p></li><li><p><span>isolation ： 设置事务的隔离级别</span></p></li><li><p><span>propagation： 设置事务的传播行为，有7种，一般使用REQUIRED(如果有事务就加入事务，没有就创建一个)，REQUIRED_NEW(不管是否存在事务都创建新的事务)</span></p><ul><li><img src="../img/image-20211012115658053.png" referrerpolicy="no-referrer" alt="image-20211012115658053"><span> </span></li></ul></li><li><p><span>rollbackFor：指定回滚，例如： @Transactional(rollbackFor=Exception.class)</span></p></li></ul></li></ul><h2><a name="springmvc的执行流程" class="md-header-anchor"></a><span>SpringMVC的执行流程</span></h2><h5><a name="用户发请求到dispatcherservlet然后调用handlermapping处理映射器获取handle然后返回handle给dispatcherservlet然后dispatcherservlet调用handleradapter处理适配器handleradapter经过适配调用具体的处理器执行完后返回modelandview给dispatcherservlet然后在把这个modelandview交给viewresolver视图处理器解析后返回具体的view然后渲染视图返回给用户" class="md-header-anchor"></a><span>用户发请求到DispatcherServlet，然后调用HandlerMapping处理映射器获取handle，然后返回handle给DispatcherServlet，然后DispatcherServlet调用HandlerAdapter处理适配器，HandlerAdapter经过适配调用具体的处理器，执行完后返回ModelAndView给DispatcherServlet，然后在把这个ModelAndView交给ViewResolver视图处理器解析后返回具体的View，然后渲染视图返回给用户。</span></h5><h2><a name="mybatis是如何进行分页的分页插件的原理是什么插件运行原理" class="md-header-anchor"></a><span>Mybatis是如何进行分页的？分页插件的原理是什么？插件运行原理</span></h2><h5><a name="mybatis使用的是rowbounds对象进行分页的是针对结果集的内存分页而不是物理分页基本原理就是使用mybatis提供的插件接口自定义插件在插件的拦截方法中拦截要执行的sql然后重写sql添加对应的物理分页语句和参数" class="md-header-anchor"></a><span>mybatis使用的是RowBounds对象进行分页的，是针对结果集的内存分页，而不是物理分页。基本原理就是使用mybatis提供的插件接口自定义插件，在插件的拦截方法中拦截要执行的sql，然后重写sql添加对应的物理分页语句和参数。</span></h5><h5><a name="插件存在的目的就相当于javaweb中的拦截器可以拦截要操作的四大对象包装对象额外添加内容使得mybatis的灵活性更强" class="md-header-anchor"></a><span>插件存在的目的就相当于javaweb中的拦截器，可以拦截要操作的四大对象，包装对象额外添加内容，使得Mybatis的灵活性更强。</span></h5><h2><a name="mybatis动态sql有什么用执行原理有哪些动态sql" class="md-header-anchor"></a><span>Mybatis动态sql有什么用？执行原理？有哪些动态sql？</span></h2><h5><a name="作用就是把在xml文件中以标签的形式写动态sql执行原理是根据表达式的值完成逻辑判断和动态拼接sql" class="md-header-anchor"></a><span>作用就是把在xml文件中以标签的形式写动态sql，执行原理是根据表达式的值完成逻辑判断和动态拼接sql</span></h5><h5><a name="mybatis提供了9种动态sql标签trim--where--set--foreach--if--choose--when--otherwise--bind" class="md-header-anchor"></a><span>Mybatis提供了9种动态sql标签：trim | where | set | foreach | if | choose | when | otherwise | bind。</span></h5><h2><a name="mybatis是否支持延迟加载如果支持它的实现原理是什么" class="md-header-anchor"></a><span>Mybatis是否支持延迟加载？如果支持，它的实现原理是什么？</span></h2><h5><a name="支持可以通过lazyloadingenabledtruefalse开启原理就是使用cglib创建目标对象的代理对象当调用目标方法时就进入拦截器方法比如调用agetbgetname拦截器invoke方法发现agetb为null就会单独发送实现保存好的查询b的sql吧b查出来然后调用asetbb然后就有值了就看可以完成调用" class="md-header-anchor"></a><span>支持，可以通过lazyLoadingEnabled=true|false开启。原理就是使用CGLib创建目标对象的代理对象，当调用目标方法时就进入拦截器方法。比如调用a.getB().getName()，拦截器invoke()方法发现a.getB()为null，就会单独发送实现保存好的查询B的sql吧B查出来，然后调用a.setB(b)然后就有值了就看可以完成调用。</span></h5><h2><a name="mybatis的一级二级缓存" class="md-header-anchor"></a><span>Mybatis的一级、二级缓存</span></h2><h5><a name="mybatis有一级缓存和二级缓存一级缓存时默认开启的二级缓存需要配置usecachetrue一级缓存是指的sqlsession级别的缓存缓存结构是一个map在同一个session中发同样的sql就不会查数据库而是从缓存中取如果出现commit操作就会清空缓存数据下次就去数据库中查询二级缓存的作用域是mappernamespace所有的查询操作会先查缓存看是否存在不存在就查数据库" class="md-header-anchor"></a><span>mybatis有一级缓存和二级缓存。一级缓存时默认开启的。二级缓存需要配置useCache=true。一级缓存是指的sqlSession级别的缓存，缓存结构是一个map。在同一个session中发同样的sql就不会查数据库而是从缓存中取。如果出现commit操作就会清空缓存数据，下次就去数据库中查询。二级缓存的作用域是Mapper(nameSpace)，所有的查询操作会先查缓存看是否存在，不存在就查数据库。</span></h5><h2><a name="sql的执行顺序" class="md-header-anchor"></a><span>Sql的执行顺序</span></h2><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">from-where-groupby-having-select-orderby-limit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 26px;"></div><div class="CodeMirror-gutters" style="height: 26px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h2><a name="spring-boot-的核心注解是哪个它主要由哪几个注解组成的" class="md-header-anchor"></a><span>Spring Boot 的核心注解是哪个？它主要由哪几个注解组成的？</span></h2><h5><a name="核心注解是springbootapplication里面有包含三个重要注解springbootconfigurationenableautoconfigurationcomponentscanspringbootconfiguration表示这也是springboot的一个配置类componentscan注解配置自动扫描可以指定basepackage标明扫描路径不指明的话默认扫描componentscan所在类的同级类和同级目录下的类所以boot项目的入口类一般会放在顶层目录就可以扫描到全部类了-enableautoconfiguration自动配置类springboot的核心里面又有个import注解表示把values属性的类加到ioc容器中这个类里有一个方法selectimports返回一个string数组里面是需要加载的类的全限定类名一层一层找下去的话其实就是找在classpath下查找meta-infspringfactories文件中以enableautoconfigurationgetname为key的string列表springfactories中就有各种xxxautoconfigruation然后在加载" class="md-header-anchor"></a><span>核心注解是@SpringBootApplication，里面有包含三个重要注解@SpringBootConfiguration，@EnableAutoConfiguration，@ComponentScan。@SpringBootConfiguration表示这也是springboot的一个配置类。@ComponentScan注解，配置自动扫描。可以指定basePackage标明扫描路径，不指明的话默认扫描@ComponentScan所在类的同级类和同级目录下的类，所以boot项目的入口类一般会放在顶层目录就可以扫描到全部类了。 @EnableAutoConfiguration自动配置类，springboot的核心。里面又有个@import注解表示把values属性的类加到ioc容器中。这个类里有一个方法selectImports(),返回一个string数组，里面是需要加载的类的全限定类名。一层一层找下去的话其实就是找在classpath下查找META-INF/spring.factories文件中以EnableAutoConfiguration.getName为key的string列表。spring.factories中就有各种xxxAutoConfigruation然后在加载。</span></h5><h5><a name="然后run方法的话是new了一个springapplicationrun在run方法里面有三个重要的方法createapplicationcontextpreparecontextrefreshcontextcontext在new-speingapplicationcontext的时候会选择启动方式有三种响应式web不内嵌web服务器使用外部的tomcat应用程序基于servlet嵌入web-server服务器然后读取meta-infspringfactories下的applicationcontextinitializer初始化器applicationlistener监听器加到集合中然后在启动run在run方法中首先开了一个秒表记录启动时间然后读取meta-infspringfactories中applicationlistener放到集合中然后循环调用starting然后创建context判断是以哪种方式启动通过反射创建相应的对象然后对conetxt做前置处理然后刷新context初始化ioc容器然后后置处理器处理然后停止计时器循环所有listener调用started方法再执行所有的runner运行器最后在循环调用listener的running方法" class="md-header-anchor"></a><span>然后run方法的话是new了一个SpringApplication.run()，在run方法里面有三个重要的方法createApplicationContext()，prepareContext(),refreshContext(context)。在new SpeingApplicationContext的时候会选择启动方式，有三种，响应式web，不内嵌web服务器使用外部的tomcat，应用程序基于servlet，嵌入web server服务器。然后读取META-INF.spring.factories下的ApplicationContextInitializer(初始化器)，ApplicationListener(监听器)加到集合中，然后在启动run()。在run()方法中首先开了一个秒表记录启动时间。然后读取META-INF/spring.factories中ApplicationListener放到集合中，然后循环调用starting。然后创建context，判断是以哪种方式启动通过反射创建相应的对象。然后对conetxt做前置处理，然后刷新context初始化ioc容器，然后后置处理器处理，然后停止计时器，循环所有listener调用started()方法。再执行所有的runner运行器。最后在循环调用listener的running()方法</span></h5><h2><a name="mybatis的四大对象" class="md-header-anchor"></a><span>Mybatis的四大对象</span></h2><h4><a name="executor执行器statementhandler语句处理器parameterhandler参数处理器resultsethandler结果集处理器" class="md-header-anchor"></a><span>Executor(执行器)，StatementHandler(语句处理器)，ParameterHandler(参数处理器)，ResultSetHandler(结果集处理器)。</span></h4><ul><li><h5><a name="executor是一个执行器真正与数据库交互的parameterhandler负责入参的具体设置statementhandler负责与jdbc层交互对预编译语句进行参数设置resultsethandler负责把结果集与java对象进行映射baseexecutorcachingexecutorbaseexecutor是executor的三个重要子类" class="md-header-anchor"></a><strong><span>Executor是一个执行器，真正与数据库交互的。ParameterHandler负责入参的具体设置。StatementHandler负责与JDBC层交互，对预编译语句进行参数设置。ResultSetHandler负责把结果集与java对象进行映射。BaseExecutor，CachingExecutor。BaseExecutor是Executor的三个重要子类</span></strong></h5></li><li><h5><a name="simpleexecutor简单执行器reuseexecutor可重用的执行器）batchexecutor批量专用执行器）默认为简单执行器每次执行updateselect就会开启一个statement对象用完之后立刻关闭" class="md-header-anchor"></a><span>SimpleExecutor(简单执行器),ReuseExecutor（可重用的执行器）,BatchExecutor（批量专用执行器）。默认为简单执行器，每次执行update，select就会开启一个Statement对象，用完之后立刻关闭。</span></h5></li><li><h5><a name="reuseexecutor是执行sql的时候以sql为key进行查找没有就创建用完之后不会关闭而是存入map中可以重复使用" class="md-header-anchor"></a><strong><span>ReuseExecutor是执行sql的时候以sql为key进行查找，没有就创建，用完之后不会关闭而是存入map中，可以重复使用。</span></strong></h5></li><li><h5><a name="batchexecutor执行update的时候会把所有的sql都添加到批处理中等待统一执行他们的作用范围都在sqlsession中" class="md-header-anchor"></a><strong><span>BatchExecutor执行update的时候会把所有的sql都添加到批处理中等待统一执行。他们的作用范围都在sqlSession中。</span></strong></h5></li></ul><h2><a name="zookeeper的zabzookeeper原子广播协议" class="md-header-anchor"></a><span>Zookeeper的ZAB(zookeeper原子广播)协议</span></h2><h5><a name="用来保证zookeeper的数据一致性包括两种基本模式消息广播崩溃恢复首先给所有的follower发送一个写请求生成一个提议	propose推送给follower然后follower接受propose放入缓存中再向leader发一个ack应答当leader接受到的ack大于从机个数除以2时就发送commit请求给从机让从机提交数据这就是zab协议的消息广播模式当leader服务器出现网络问题或中断时zab协议就会进入崩溃恢复模式然后选举产生新的leader同时集群中有半数的机器与leader完成同步就会退出崩溃恢复模式进入消息广播机制" class="md-header-anchor"></a><span>用来保证zookeeper的数据一致性。包括两种基本模式：消息广播，崩溃恢复。首先给所有的follower发送一个写请求生成一个提议(</span><span>	</span><span>Propose)，推送给follower，然后follower接受propose放入缓存中，再向Leader发一个ack应答，当leader接受到的ack大于从机个数除以2时就发送commit请求给从机让从机提交数据，这就是ZAB协议的消息广播模式。当leader服务器出现网络问题或中断时，Zab协议就会进入崩溃恢复模式，然后选举产生新的leader同时集群中有半数的机器与leader完成同步就会退出崩溃恢复模式，进入消息广播机制。</span></h5><h2><a name="zookeeper的选举策略" class="md-header-anchor"></a><span>Zookeeper的选举策略</span></h2><h5><a name="节点有四种状态" class="md-header-anchor"></a><span>节点有四种状态：</span></h5><ul><li><strong><span>looking:</span></strong><span>寻找leader状态，此时集群中没有leader，需要进行选举</span></li><li><strong><span>leading:</span></strong><span>领导者状态，表示这个服务器是leader</span></li><li><strong><span>following:</span></strong><span>跟随者状态，表示这个服务器是follower</span></li><li><strong><span>observing:</span></strong><span>观察者状态，表示这个服务器时observer，这个节点不参与选举</span></li></ul><h5><a name="原理每个server发出一个投票由于是初始状态每个服务器都会把自己当成leader给自己投票模型是一个myid-zxidmyid就是自己的idzxid就是投给哪个服务器的id计算投票的时候会优先检查zxidzxid较大的优先作为leader如果zxid相同就比较myidmyid较大的作为leader然后更新自身投票统计投票判断是否有过半的机器接收到相同的投票信息最后修改状态确定了leader其他的都是follower" class="md-header-anchor"></a><span>原理:每个server发出一个投票，由于是初始状态，每个服务器都会把自己当成leader给自己投票。模型是一个(myid, zxid)，myid就是自己的id，zxid就是投给哪个服务器的id。计算投票的时候会优先检查zxid，zxid较大的优先作为leader，如果zxid相同，就比较myid，myid较大的作为leader，然后更新自身投票。统计投票判断是否有过半的机器接收到相同的投票信息，最后修改状态，确定了leader其他的都是follower。</span></h5><h2><a name="zookeeper的watcher机制" class="md-header-anchor"></a><span>Zookeeper的watcher机制</span></h2><h5><a name="类似于监听器本质就是观察者模式的应用应用场景用zookeeper实现发布订阅功能原理就是zk-客户端把watcher注册到zk-服务器中然后把watcher添加到watchermanager中watcher一旦监听到zk服务器中的节点发生变化此时zk服务器就会通知watchermanager调用回调方法" class="md-header-anchor"></a><span>类似于监听器，本质就是观察者模式的应用。应用场景用Zookeeper实现发布订阅功能。原理就是zk 客户端把watcher注册到zk 服务器中，然后把watcher添加到watchermanager中，watcher一旦监听到zk服务器中的节点发生变化，此时zk服务器就会通知watchermanager调用回调方法。</span></h5><h2><a name="feign远程调用原理" class="md-header-anchor"></a><span>Feign远程调用原理</span></h2><h5><a name="首先feign会找加了feignclient注解的接口然后根据jdk自带的动态代理生成这个类的proxy对象然后交给ioc容器管理发请求使用到的就是这个代理对象然后通过bean信息和request-template创建出request模板发请求然后请求没有发送成功还有一个内置的重试器会有一个最大尝试次数发送请求然后feign发http请求性能很差因为每次发送请求的时候都会创建新的httpurlconnection连接但是可以使用httpclient-okhttp3等来替换用到了两种设计模式代理模式模板方法模式" class="md-header-anchor"></a><span>首先feign会找加了@FeignClient注解的接口。然后根据jdk自带的动态代理生成这个类的proxy对象，然后交给ioc容器管理，发请求使用到的就是这个代理对象。然后通过Bean信息和request Template创建出request模板发请求，然后请求没有发送成功还有一个内置的重试器，会有一个最大尝试次数发送请求。然后feign发http请求性能很差，因为每次发送请求的时候都会创建新的HttpURLConnection连接，但是可以使用httpclient， okhttp3等来替换。用到了两种设计模式，代理模式模板方法模式。</span></h5><h2><a name="线程池" class="md-header-anchor"></a><span>线程池</span></h2><h4><a name="排队策略" class="md-header-anchor"></a><span>排队策略</span></h4><ul><li><span>无界队列：队列没有大小限制，可以一直接受任务，常用的无界队列有LinkedBlockingQueue。但是这种队列会容易出现OOM，因为线程处理时间长，后面的任务都到队列中，导致OOM。</span></li><li><span>有界队列：常用的有两类，遵循FIFO的如ArrayBlockingQueue，另一类就是优先级队列PriorityBlockingQueue，</span></li><li><span>同步移交队列：常用的SynchronousQueue，要将一个元素放入SynchronousQueue中，必须有另一个线程正在等待接收这个元素。SynchronousQueue只能存一个任务，当想存进去时要有另一个线程消费任务才能存进去，想消费的时候必须要有线程来存才可以，这样就是一次配对过程</span></li></ul><h4><a name="线程池中的队列" class="md-header-anchor"></a><span>线程池中的队列</span></h4><ol start='' ><li><span>ArrayBlockingQueue：规定大小的BlockingQueue，构造函数必须带一个int参数来表示大小，所包含的对象是以FIFO顺序排序的，是有界阻塞队列，使用数组实现的。线程安全。关于它的公平性可以再构造函数中指定</span></li><li><span>LinkedBlockingQueue： 大小不定的BlockingQueue(阻塞队列)，构造函数带参数生成的阻塞队列就有大小限制，不带参数大小就是Integer.MAX_VALUE来决定。包含的对象是根据FIFO排序的</span></li><li><span>PriorityBlockingQueue：类似LinkedBlockingQueue，但是包含对象的排序规则是自然排序或者构造函数的Comparator决定的</span></li><li><span>SynchronousQueue： 特殊的阻塞队列，是同步移交队列，就是说生产和消费必须同时。每个插入操作必须等另一个线程进行移除操作才能执行，否则一直阻塞。队列不能为null。</span></li><li><span>DelayQueue：是一个无界队列，其中的对象只能等到过期才能从队列中取走，是有序且不能为null的，注意队列的头对象延迟到期时间最长</span></li></ol><h4><a name="线程池的四种拒绝策略" class="md-header-anchor"></a><span>线程池的四种拒绝策略</span></h4><ol start='' ><li><h5><a name="abortpolicy中止策略这个是默认的拒绝策略饱和时会抛rejectedexecutionexception异常" class="md-header-anchor"></a><span>AbortPolicy中止策略：这个是默认的拒绝策略，饱和时会抛RejectedExecutionException异常</span></h5></li><li><h5><a name="discardpolicy抛弃策略-当队列饱和了后续的任务直接抛弃" class="md-header-anchor"></a><span>DiscardPolicy抛弃策略： 当队列饱和了后续的任务直接抛弃</span></h5></li><li><h5><a name="discardoldestpolicy抛弃旧任务策略-抛弃最早未处理的任务如果队列使用priorityblockingqueue优先级队列会把优先级最高的任务抛弃不建议组合使用" class="md-header-anchor"></a><span>DiscardOldestPolicy抛弃旧任务策略： 抛弃最早未处理的任务，如果队列使用PriorityBlockingQueue优先级队列，会把优先级最高的任务抛弃，不建议组合使用</span></h5></li><li><h5><a name="callerrunspolicy调用者运行-这个策略不会抛弃也不会抛出异常它会把饱和的任务退回给调用者运行在执行任务的时候主线程无法提交新任务从而线程池中的工作线程就有时间吧任务处理完成" class="md-header-anchor"></a><span>CallerRunsPolicy调用者运行： 这个策略不会抛弃也不会抛出异常，它会把饱和的任务退回给调用者运行，在执行任务的时候，主线程无法提交新任务，从而线程池中的工作线程就有时间吧任务处理完成</span></h5></li></ol><h4><a name="executors创建的四种队列" class="md-header-anchor"></a><span>Executors创建的四种队列</span></h4><ul><li><p><strong><span>newFixedThreadPool(正规线程)：</span></strong><span>会创建一个固定长度的线程池，达到线程池最大数量后就放入队列</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>5</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">public static ExecutorService newFixedThreadPool(int nThreads) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  return new ThreadPoolExecutor(nThreads, nThreads, //最大线程数</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0L, TimeUnit.MILLISECONDS,  // 存活时间 &nbsp; 时间单位</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  new LinkedBlockingQueue&lt;Runnable&gt;()); // 队列</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="height: 130px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre></li><li><p><strong><span>newCachedThreadPool(缓存池线程)：</span></strong><span>会为每个任务添加一个线程单独处理，但是又一个超时机制，超过60s没有用到就回收了，缺点就是没有考虑到实际内存大小</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>5</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">public static ExecutorService newCachedThreadPool() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  return new ThreadPoolExecutor(0, Integer.MAX_VALUE, // 核心线程数为0， 最大线程数</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  60L, TimeUnit.SECONDS, //超时时间60s</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  new SynchronousQueue&lt;Runnable&gt;()); // 队列</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="height: 130px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre></li><li><p><strong><span>newSingleThreadExecutor(单例线程池)：</span></strong><span>遇到任务只能一个一个处理，处理不了就加到队列中。没有并发操作</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>6</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">public static ExecutorService newSingleThreadExecutor() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  return new FinalizableDelegatedExecutorService</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  (new ThreadPoolExecutor(1, 1, // 核心线程数，最大线程数都为1</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0L, TimeUnit.MILLISECONDS, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  new LinkedBlockingQueue&lt;Runnable&gt;()));</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 156px;"></div><div class="CodeMirror-gutters" style="height: 156px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre></li><li><p><strong><span>newScheduledThreadPool：</span></strong><span>创建一个定长线程池，支持定时及周期性任务执行。</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>11</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">public static ScheduledExecutorService newScheduledThreadPool(</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  int corePoolSize, ThreadFactory threadFactory) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  return new ScheduledThreadPoolExecutor(corePoolSize, threadFactory);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">// 构造方法</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">public ScheduledThreadPoolExecutor(int corePoolSize,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ThreadFactory threadFactory) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  new DelayedWorkQueue(), threadFactory);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="height: 286px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre></li></ul><h4><a name="threadpoolexecutor创建线程" class="md-header-anchor"></a><span>ThreadPoolExecutor创建线程</span></h4><h6><a name="面试题一个线程池中core7-max-20-queue50-此时进来100个并发怎么分配" class="md-header-anchor"></a><span>面试题：一个线程池中core：7， max: 20, queue:50， 此时进来100个并发怎么分配</span></h6><h6><a name="答7个分配给核心线程13个分配能创建的最大线程队列再存50个剩下30个使用拒绝策略拒绝掉" class="md-header-anchor"></a><span>答：7个分配给核心线程，13个分配能创建的最大线程，队列再存50个，剩下30个使用拒绝策略拒绝掉</span></h6><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>14</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable">ThreadPoolExecutor</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">corePoolSize</span>, <span class="cm-comment">//核心线程数</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">maximumPoolSize</span>, <span class="cm-comment">//最大线程数</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">long</span> <span class="cm-variable">keepAliveTime</span>, <span class="cm-comment">//存活时间</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">TimeUnit</span> <span class="cm-variable">unit</span>, <span class="cm-comment">// 时间单位</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">BlockingQueue</span><span class="cm-operator">&lt;</span><span class="cm-variable">Runnable</span><span class="cm-operator">&gt;</span> <span class="cm-variable">workQueue</span>, <span class="cm-comment">// 队列</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ThreadFactory</span> <span class="cm-variable">threadFactory</span>, <span class="cm-comment">// 线程工厂</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">RejectedExecutionHandler</span> <span class="cm-variable">handler</span>) &nbsp;<span class="cm-comment">// 拒绝策略</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">new</span> <span class="cm-variable">ThreadPoolExecutor</span>(<span class="cm-variable">pool</span>.<span class="cm-variable">getCoreSize</span>(), </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">pool</span>.<span class="cm-variable">getMaxSize</span>(), </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">pool</span>.<span class="cm-variable">getKeepAliveTime</span>(),</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">TimeUnit</span>.<span class="cm-variable">SECONDS</span>, </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">new</span> <span class="cm-variable">LinkedBlockingDeque</span><span class="cm-operator">&lt;&gt;</span>(<span class="cm-number">10000</span>), <span class="cm-variable">Executors</span>.<span class="cm-variable">defaultThreadFactory</span>(),</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">new</span> <span class="cm-variable">ThreadPoolExecutor</span>.<span class="cm-variable">AbortPolicy</span>());</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 364px;"></div><div class="CodeMirror-gutters" style="height: 364px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre><h4><a name="线程池原理" class="md-header-anchor"></a><span>线程池原理</span><span>	</span></h4><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>40</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 存放线程池的运行状态 (runState) 和线程池内有效线程的数量 (workerCount)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-keyword">final</span> <span class="cm-variable">AtomicInteger</span> <span class="cm-variable">ctl</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">AtomicInteger</span>(<span class="cm-variable">ctlOf</span>(<span class="cm-variable">RUNNING</span>, <span class="cm-number">0</span>));</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">int</span> <span class="cm-def">workerCountOf</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">c</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">c</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">CAPACITY</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-keyword">final</span> <span class="cm-variable">BlockingQueue</span><span class="cm-operator">&lt;</span><span class="cm-variable">Runnable</span><span class="cm-operator">&gt;</span> <span class="cm-variable">workQueue</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-def">execute</span>(<span class="cm-variable">Runnable</span> <span class="cm-variable">command</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 如果任务为null，则抛出异常。</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">command</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">NullPointerException</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// ctl 中保存的线程池当前的一些状态信息</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">c</span> <span class="cm-operator">=</span> <span class="cm-variable">ctl</span>.<span class="cm-variable">get</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//  下面会涉及到 3 步 操作</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 1.首先判断当前线程池中执行的任务数量是否小于 corePoolSize</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 如果小于的话，通过addWorker(command, true)新建一个线程，并将任务(command)添加到该线程中；然后，启动该线程从而执行任务。</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">workerCountOf</span>(<span class="cm-variable">c</span>) <span class="cm-operator">&lt;</span> <span class="cm-variable">corePoolSize</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">addWorker</span>(<span class="cm-variable">command</span>, <span class="cm-atom">true</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">c</span> <span class="cm-operator">=</span> <span class="cm-variable">ctl</span>.<span class="cm-variable">get</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 2.如果当前执行的任务数量大于等于 corePoolSize 的时候就会走到这里</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 通过 isRunning 方法判断线程池状态，线程池处于 RUNNING 状态才会被并且队列可以加入任务，该任务才会被加入进去</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">isRunning</span>(<span class="cm-variable">c</span>) <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">workQueue</span>.<span class="cm-variable">offer</span>(<span class="cm-variable">command</span>)) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">recheck</span> <span class="cm-operator">=</span> <span class="cm-variable">ctl</span>.<span class="cm-variable">get</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 再次获取线程池状态，如果线程池状态不是 RUNNING 状态就需要从任务队列中移除任务，并尝试判断线程是否全部执行完毕。同时执行拒绝策略。</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">isRunning</span>(<span class="cm-variable">recheck</span>) <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">remove</span>(<span class="cm-variable">command</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">reject</span>(<span class="cm-variable">command</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 如果当前线程池为空就新创建一个线程并执行。</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">workerCountOf</span>(<span class="cm-variable">recheck</span>) <span class="cm-operator">==</span> <span class="cm-number">0</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">addWorker</span>(<span class="cm-atom">null</span>, <span class="cm-atom">false</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//3. 通过addWorker(command, false)新建一个线程，并将任务(command)添加到该线程中；然后，启动该线程从而执行任务。</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">37</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//如果addWorker(command, false)执行失败，则通过reject()执行相应的拒绝策略的内容。</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">38</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">addWorker</span>(<span class="cm-variable">command</span>, <span class="cm-atom">false</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">39</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">reject</span>(<span class="cm-variable">command</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">40</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1092px;"></div><div class="CodeMirror-gutters" style="height: 1092px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre><p><img src="../img/image-20211020104704858.png" referrerpolicy="no-referrer" alt="image-20211020104704858"><span> </span></p><h2><a name="死锁" class="md-header-anchor"></a><span>死锁</span></h2><h5><a name="产生死锁的四个条件" class="md-header-anchor"></a><span>产生死锁的四个条件</span></h5><ol start='' ><li><span>互斥资源： 就是资源在同一时间只能被一个进程占用 (一次性吧所有资源分配好)</span></li><li><span>请求和保持： 当进程请求资源时阻塞，对已经持有的资源不进行释放   (超时释放)</span></li><li><span>不可剥夺资源： 进程获的资源未使用完时，不能被剥夺，只能等执行完才释放 (即当某进程获得了部分资源，但得不到其它资源，则释放已占有的资源)</span></li><li><span>循环等待： 几个进程之间形成头尾相接的循环等待资源的关系 (每一个进程按编号递增的顺序请求资源)</span></li></ol><h5><a name="用代码实现" class="md-header-anchor"></a><span>用代码实现</span></h5><details>
  <summary>查看代码</summary>
  <pre><code> 
	public class DeadLock {
	    public static String obj1 = "obj1";
	    public static String obj2 = "obj2";
	    public static void main(String[] args){
	        Thread a = new Thread(new Lock1());
	        Thread b = new Thread(new Lock2());
	        a.start();
	        b.start();
	    }    
	}
	class Lock1 implements Runnable{
	    @Override
	    public void run(){
	        try{
	            System.out.println("Lock1 running");
	            while(true){
	                synchronized(DeadLock.obj1){
	                    System.out.println("Lock1 lock obj1");
	                    Thread.sleep(3000);//获取obj1后先等一会儿，让Lock2有足够的时间锁住obj2
	                    synchronized(DeadLock.obj2){
	                        System.out.println("Lock1 lock obj2");
	                    }
	                }
	            }
	        }catch(Exception e){
	            e.printStackTrace();
	        }
	    }
	}
	class Lock2 implements Runnable{
	    @Override
	    public void run(){
	        try{
	            System.out.println("Lock2 running");
	            while(true){
	                synchronized(DeadLock.obj2){
	                    System.out.println("Lock2 lock obj2");
	                    Thread.sleep(3000);
	                    synchronized(DeadLock.obj1){
	                        System.out.println("Lock2 lock obj1");
	                    }
	                }
	            }
	        }catch(Exception e){
	            e.printStackTrace();
	        }
	    }
	}
  </code></pre>
</details><h2><a name="深入理解java内存模型httpswwwjianshucomp15106e9c4bf3" class="md-header-anchor"></a><span>深入理解Java内存模型](</span><a href='https://www.jianshu.com/p/15106e9c4bf3' target='_blank' class='url'>https://www.jianshu.com/p/15106e9c4bf3</a><span>)</span></h2><h2><a name="tcp和udp" class="md-header-anchor"></a><span>TCP和UDP</span></h2><h4><a name="tcp和udphttpszhuanlanzhihucomp226071844" class="md-header-anchor"></a><a href='https://zhuanlan.zhihu.com/p/226071844'><span>TCP和UDP</span></a></h4><h2><a name="rabbitmq的工作原理" class="md-header-anchor"></a><span>RabbitMQ的工作原理</span></h2><h5><a name="首先rabbbitmq是一个实现了amqp高级消息队列协议的消息队列它分为三个角色生产者代理消费者生产者就是往代理里发信息这个代理就是rabbitmq-server然后在由消费者来监听队列拿到消息进行消费消息发送原理就是发消息的时候会跟rabbitmq建立连接一个tcp连接然后通过账号密码连接上了就会创建一条信道channel然后传输消息发消息并不是直接直接发到队列里当然也有发到交换机然后在通过交换机根据bindkey发到队列" class="md-header-anchor"></a><span>首先rabbbitmq是一个实现了AMQP(高级消息队列协议)的消息队列。它分为三个角色，生产者，代理，消费者。生产者就是往代理里发信息，这个代理就是rabbitmq server，然后在由消费者来监听队列拿到消息进行消费。消息发送原理就是发消息的时候会跟rabbitmq建立连接一个TCP连接，然后通过账号密码连接上了就会创建一条信道channel然后传输消息。发消息并不是直接直接发到队列里(当然也有)，发到交换机然后在通过交换机根据BindKey发到队列。</span></h5><h5><a name="rabbitmq有几个重要概念connectionfactory连接管理器）应用程序和rabbitmq建立连接的管理器channel信道传输信息的通道exchange交换机用于接收和分配消息quene队列用于存储生产者的消息routingkey路由键根据路由键吧生产者的消息分配给不同的交换机bindingkey绑定键把队列跟交换机进行绑定vhost虚拟主机每个虚拟主机都有自己的交换机队列创建用户的时候必须指定vhost相当于一个namespace" class="md-header-anchor"></a><span>rabbitmq有几个重要概念，ConnectionFactory（连接管理器）:应用程序和rabbitmq建立连接的管理器。Channel(信道)：传输信息的通道。Exchange(交换机)：用于接收和分配消息。Quene(队列)：用于存储生产者的消息。RoutingKey(路由键)：根据路由键吧生产者的消息分配给不同的交换机。BindingKey(绑定键)：把队列跟交换机进行绑定。vhost(虚拟主机)：每个虚拟主机都有自己的交换机队列，创建用户的时候必须指定vhost，相当于一个namespace</span></h5><h2><a name="雪花算法" class="md-header-anchor"></a><span>雪花算法</span></h2><h5><a name="其核心算法就是使用一个64bit的long型数字作为全局唯一id且id引入了时间戳基本保持自增这64bit中有1个bit是不用的其中41个bit作为毫秒数用10bit作为机器id12bit作为序列号" class="md-header-anchor"></a><span>其核心算法就是使用一个64bit的long型数字作为全局唯一id，且id引入了时间戳，基本保持自增。这64bit中有1个bit是不用的，其中41个bit作为毫秒数，用10bit作为机器id，12bit作为序列号。</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">0  |  0001100  10100010 &nbsp; 10001001  01011100  00  |  10001  |  1 &nbsp; 1001  |  0000 &nbsp; 00000000 </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 26px;"></div><div class="CodeMirror-gutters" style="height: 26px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>4</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">第一部分： 1个bit，这个是无意义的，因为二进制里第一个bit如果是1，那么就都是负数，生成的id一般都是正数，所以是0</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">第二部分： 41个bit，表示时间戳，单位是毫秒</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">第三部分： 10个bit，记录工作机器id，代表是这个服务最多可以部署在2^10台机器上，就是1024台</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">第四部分： 12个bit，这个是用来记录同一个毫秒内产生的不同id。它可以代表的最大正整数是2^12 - 1 = 4096，就是说可以用这12bit代表的数字来区分统一毫秒内4096个不同id</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="height: 130px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h5><a name="简单来说你的某个服务假设要生成一个全局唯一-id那么就可以发送一个请求给部署了-snowflake-算法的系统由这个-snowflake-算法系统来生成唯一-id" class="md-header-anchor"></a><span>简单来说，你的某个服务假设要生成一个全局唯一 id，那么就可以发送一个请求给部署了 SnowFlake 算法的系统，由这个 SnowFlake 算法系统来生成唯一 id。</span></h5><h5><a name="这个-snowflake-算法系统首先肯定是知道自己所在的机房和机器的比如机房-id--17机器-id--12接着-snowflake-算法系统接收到这个请求之后首先就会用二进制位运算的方式生成一个-64-bit-的-long-型-id64-个-bit-中的第一个-bit-是无意义的" class="md-header-anchor"></a><span>这个 SnowFlake 算法系统首先肯定是知道自己所在的机房和机器的，比如机房 id = 17，机器 id = 12。####接着 SnowFlake 算法系统接收到这个请求之后，首先就会用二进制位运算的方式生成一个 64 bit 的 long 型 id，64 个 bit 中的第一个 bit 是无意义的。</span></h5><h5><a name="接着-41-个-bit就可以用当前时间戳单位到毫秒）然后接着-5-个-bit-设置上这个机房-id还有-5-个-bit-设置上机器-id" class="md-header-anchor"></a><span>接着 41 个 bit，就可以用当前时间戳（单位到毫秒），然后接着 5 个 bit 设置上这个机房 id，还有 5 个 bit 设置上机器 id。</span></h5><h5><a name="最后再判断一下当前这台机房的这台机器上这一毫秒内这是第几个请求给这次生成-id-的请求累加一个序号作为最后的-12-个-bit" class="md-header-anchor"></a><span>最后再判断一下，当前这台机房的这台机器上这一毫秒内，这是第几个请求，给这次生成 id 的请求累加一个序号，作为最后的 12 个 bit。</span></h5><h5><a name="最终一个-64-个-bit-的-id-就出来了类似于" class="md-header-anchor"></a><span>最终一个 64 个 bit 的 id 就出来了，类似于：  </span></h5><blockquote><p><span>0  |  0001100  10100010   10001001  01011100  00  |  10001  |  1   1001  |  0000   00000000 </span></p></blockquote><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 47px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 43px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>131</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -43px; width: 43px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">IdWorker</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//因为二进制里第一个 bit 为如果是 1，那么都是负数，但是我们生成的 id 都是正数，所以第一个 bit 统一都是 0。</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//机器ID  2进制5位  32位减掉1位 31个</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">workerId</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//机房ID 2进制5位  32位减掉1位 31个</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">datacenterId</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//代表一毫秒内生成的多个id的最新序号  12位 4096 -1 = 4095 个</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">sequence</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//设置一个时间初始值 &nbsp;  2^41 - 1 &nbsp; 差不多可以用69年</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">twepoch</span> <span class="cm-operator">=</span> <span class="cm-number">1585644268888L</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//5位的机器id</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">workerIdBits</span> <span class="cm-operator">=</span> <span class="cm-number">5L</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//5位的机房id</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">datacenterIdBits</span> <span class="cm-operator">=</span> <span class="cm-number">5L</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//每毫秒内产生的id数 2 的 12次方</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">sequenceBits</span> <span class="cm-operator">=</span> <span class="cm-number">12L</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 这个是二进制运算，就是5 bit最多只能有31个数字，也就是说机器id最多只能是32以内</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">maxWorkerId</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">1L</span> <span class="cm-variable">^</span> (<span class="cm-operator">-</span><span class="cm-number">1L</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">workerIdBits</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 这个是一个意思，就是5 bit最多只能有31个数字，机房id最多只能是32以内</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">maxDatacenterId</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">1L</span> <span class="cm-variable">^</span> (<span class="cm-operator">-</span><span class="cm-number">1L</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">datacenterIdBits</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">workerIdShift</span> <span class="cm-operator">=</span> <span class="cm-variable">sequenceBits</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">datacenterIdShift</span> <span class="cm-operator">=</span> <span class="cm-variable">sequenceBits</span> <span class="cm-operator">+</span> <span class="cm-variable">workerIdBits</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">timestampLeftShift</span> <span class="cm-operator">=</span> <span class="cm-variable">sequenceBits</span> <span class="cm-operator">+</span> <span class="cm-variable">workerIdBits</span> <span class="cm-operator">+</span> <span class="cm-variable">datacenterIdBits</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">sequenceMask</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">1L</span> <span class="cm-variable">^</span> (<span class="cm-operator">-</span><span class="cm-number">1L</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">sequenceBits</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//记录产生时间毫秒数，判断是否是同1毫秒</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">lastTimestamp</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">1L</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">long</span> <span class="cm-variable">getWorkerId</span>(){</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-variable">workerId</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">long</span> <span class="cm-variable">getDatacenterId</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-variable">datacenterId</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">long</span> <span class="cm-variable">getTimestamp</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-variable">System</span>.<span class="cm-variable">currentTimeMillis</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">37</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">38</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">39</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">40</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-variable">IdWorker</span>(<span class="cm-variable-3">long</span> <span class="cm-variable">workerId</span>, <span class="cm-variable-3">long</span> <span class="cm-variable">datacenterId</span>, <span class="cm-variable-3">long</span> <span class="cm-variable">sequence</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">41</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">42</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 检查机房id和机器id是否超过31 不能小于0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">43</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span> (<span class="cm-variable">workerId</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">maxWorkerId</span> <span class="cm-operator">||</span> <span class="cm-variable">workerId</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">44</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">IllegalArgumentException</span>(</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">45</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"worker Id can't be greater than %d or less than 0"</span>,<span class="cm-variable">maxWorkerId</span>));</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">46</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">47</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">48</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span> (<span class="cm-variable">datacenterId</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">maxDatacenterId</span> <span class="cm-operator">||</span> <span class="cm-variable">datacenterId</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">49</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">50</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">IllegalArgumentException</span>(</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">51</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"datacenter Id can't be greater than %d or less than 0"</span>,<span class="cm-variable">maxDatacenterId</span>));</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">52</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">53</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">this</span>.<span class="cm-variable">workerId</span> <span class="cm-operator">=</span> <span class="cm-variable">workerId</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">54</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">this</span>.<span class="cm-variable">datacenterId</span> <span class="cm-operator">=</span> <span class="cm-variable">datacenterId</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">55</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">this</span>.<span class="cm-variable">sequence</span> <span class="cm-operator">=</span> <span class="cm-variable">sequence</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">56</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">57</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">58</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 这个是核心方法，通过调用nextId()方法，让当前这台机器上的snowflake算法程序生成一个全局唯一的id</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">59</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-keyword">synchronized</span> <span class="cm-variable-3">long</span> <span class="cm-variable">nextId</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">60</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 这儿就是获取当前时间戳，单位是毫秒</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">61</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">long</span> <span class="cm-variable">timestamp</span> <span class="cm-operator">=</span> <span class="cm-variable">timeGen</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">62</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span> (<span class="cm-variable">timestamp</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">lastTimestamp</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">63</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">64</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">err</span>.<span class="cm-variable">printf</span>(</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">65</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-string">"clock is moving backwards. Rejecting requests until %d."</span>, <span class="cm-variable">lastTimestamp</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">66</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">RuntimeException</span>(</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">67</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">String</span>.<span class="cm-variable">format</span>(<span class="cm-string">"Clock moved backwards. Refusing to generate id for %d milliseconds"</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">68</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">lastTimestamp</span> <span class="cm-operator">-</span> <span class="cm-variable">timestamp</span>));</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">69</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">70</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">71</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 下面是说假设在同一个毫秒内，又发送了一个请求生成一个id</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">72</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 这个时候就得把seqence序号给递增1，最多就是4096</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">73</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span> (<span class="cm-variable">lastTimestamp</span> <span class="cm-operator">==</span> <span class="cm-variable">timestamp</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">74</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">75</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 这个意思是说一个毫秒内最多只能有4096个数字，无论你传递多少进来，</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">76</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//这个位运算保证始终就是在4096这个范围内，避免你自己传递个sequence超过了4096这个范围</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">77</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">sequence</span> <span class="cm-operator">=</span> (<span class="cm-variable">sequence</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">&amp;</span> <span class="cm-variable">sequenceMask</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">78</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//当某一毫秒的时间，产生的id数 超过4095，系统会进入等待，直到下一毫秒，系统继续产生ID</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">79</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span> (<span class="cm-variable">sequence</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">80</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">timestamp</span> <span class="cm-operator">=</span> <span class="cm-variable">tilNextMillis</span>(<span class="cm-variable">lastTimestamp</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">81</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">82</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">83</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>} <span class="cm-keyword">else</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">84</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">sequence</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">85</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">86</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 这儿记录一下最近一次生成id的时间戳，单位是毫秒</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">87</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">lastTimestamp</span> <span class="cm-operator">=</span> <span class="cm-variable">timestamp</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">88</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 这儿就是最核心的二进制位运算操作，生成一个64bit的id</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">89</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 先将当前时间戳左移，放到41 bit那儿；将机房id左移放到5 bit那儿；将机器id左移放到5 bit那儿；将序号放最后12 bit</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">90</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 最后拼接起来成一个64 bit的二进制数字，转换成10进制就是个long型</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">91</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> ((<span class="cm-variable">timestamp</span> <span class="cm-operator">-</span> <span class="cm-variable">twepoch</span>) <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">timestampLeftShift</span>) <span class="cm-operator">|</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">92</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>(<span class="cm-variable">datacenterId</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">datacenterIdShift</span>) <span class="cm-operator">|</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">93</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>(<span class="cm-variable">workerId</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">workerIdShift</span>) <span class="cm-operator">|</span> <span class="cm-variable">sequence</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">94</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">95</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">96</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">/**</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">97</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-comment">* 当某一毫秒的时间，产生的id数 超过4095，系统会进入等待，直到下一毫秒，系统继续产生ID</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">98</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-comment">* @param lastTimestamp</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">99</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-comment">* @return</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">100</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-comment">*/</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">101</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">tilNextMillis</span>(<span class="cm-variable-3">long</span> <span class="cm-variable">lastTimestamp</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">102</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">103</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">long</span> <span class="cm-variable">timestamp</span> <span class="cm-operator">=</span> <span class="cm-variable">timeGen</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">104</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">105</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span> (<span class="cm-variable">timestamp</span> <span class="cm-operator">&lt;=</span> <span class="cm-variable">lastTimestamp</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">106</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">timestamp</span> <span class="cm-operator">=</span> <span class="cm-variable">timeGen</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">107</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">108</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-variable">timestamp</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">109</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">110</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//获取当前时间戳</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">111</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">long</span> <span class="cm-variable">timeGen</span>(){</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">112</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-variable">System</span>.<span class="cm-variable">currentTimeMillis</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">113</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">114</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">115</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">/**</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">116</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-comment">*  main 测试类</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">117</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-comment">* @param args</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">118</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-comment">*/</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">119</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">120</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-number">1</span><span class="cm-operator">&amp;</span><span class="cm-number">4596</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">121</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-number">2</span><span class="cm-operator">&amp;</span><span class="cm-number">4596</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">122</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-number">6</span><span class="cm-operator">&amp;</span><span class="cm-number">4596</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">123</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-number">6</span><span class="cm-operator">&amp;</span><span class="cm-number">4596</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">124</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-number">6</span><span class="cm-operator">&amp;</span><span class="cm-number">4596</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">125</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-number">6</span><span class="cm-operator">&amp;</span><span class="cm-number">4596</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">126</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span>IdWorker worker = new IdWorker(1,1,1);</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">127</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span>for (int i = 0; i &lt; 22; i++) {</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">128</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>System.out.println(worker.nextId());</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 34px;">129</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">130</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -43px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 34px;">131</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 3458px;"></div><div class="CodeMirror-gutters" style="height: 3458px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 42px;"></div></div></div></div></pre><h5><a name="优点" class="md-header-anchor"></a><span>优点：</span></h5><ul><li><span>高性能高可用：生成时不依赖于数据库，完全在内存中生成。</span></li><li><span>容量大：每秒中能生成数百万的自增ID。</span></li><li><span>ID自增：存入数据库中，索引效率高。</span></li></ul><h5><a name="缺点" class="md-header-anchor"></a><span>缺点：</span></h5><ul><li><span>依赖与系统时间的一致性，如果系统时间被回调，或者改变，可能会造成id冲突或者重复。</span></li></ul><h2><a name="数据库三范式" class="md-header-anchor"></a><span>数据库三范式</span></h2><ul><li><p><span>1NF：字段原子性，不可分。</span></p></li><li><p><span>2NF：有主键，非主键字段依赖主键。确保每个表只描述一个事物</span></p></li><li><p><span>3NF：非主键字段不能互相依赖，每列都和主键有直接关系，不存在传递依赖</span></p><h5><a name="第一范式表字段1-字段2字段21字段22字段3-" class="md-header-anchor"></a><span>第一范式：表：字段1、 字段2(字段2.1、字段2.2)、字段3 ......</span></h5><h5><a name="第二范式表学号课程号姓名学分-这个表说明了两个事物姓名依赖学号学分依赖课程号" class="md-header-anchor"></a><span>第二范式：表：学号、课程号、姓名、学分; 这个表说明了两个事物，姓名依赖学号，学分依赖课程号</span></h5><h5><a name="第三范式表学号姓名-年龄-所在学院学院联系电话学院联系电话存在依赖传递学号-→-所在学院-→-学院地点-学院电话" class="md-header-anchor"></a><span>第三范式：表：学号、姓名、 年龄、 所在学院、学院联系电话、学院联系电话；存在依赖传递(学号) → (所在学院) → (学院地点, 学院电话)</span></h5></li></ul><h2><a name="从输入url到浏览器显示页面发生了什么" class="md-header-anchor"></a><span>从输入URL到浏览器显示页面发生了什么</span></h2><h5><a name="网络7层协议" class="md-header-anchor"></a><span>网络7层协议</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>9</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">从顶层到底层7 - 1</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">7 应用层 |</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">6 表示层 |<span class="cm-tab" role="presentation" cm-text="	"> </span>&lt;应用层&gt;HTTP，HTML</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">5 会话层 |</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4 传输层 <span class="cm-tab" role="presentation" cm-text="	">  </span>|&lt;传输层&gt;TCP,UDP</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3 网络层<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-tab" role="presentation" cm-text="	">   </span>|&lt;网络层&gt;IPv4,IPv6</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;">2 数据链路层<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>|&lt;1和2都是这个 以太网等&gt;<span class="cm-tab" role="presentation" cm-text="	"> </span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1 物理层<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>  |<span class="cm-tab" role="presentation" cm-text="	"> </span> &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 234px;"></div><div class="CodeMirror-gutters" style="height: 234px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><ol start='' ><li><span>在浏览器输入url地址：例如</span><a href='http://www.baidu.com' target='_blank' class='url'>http://www.baidu.com</a><span>，指出以http为传输协议，</span><a href='http://www.baidu.com' target='_blank' class='url'>www.baidu.com</a><span>为域名，一般可以用ip或域名，但是用域名的话想让让计算机理解这个地址还是要解析成ip</span></li><li><span>应用层DNS解析域名：客户端先检查本地是否有对应的ip，找到则返回响应的ip地址，若没找到就请求上级DNS服务器，直到找到或找到根节点</span></li><li><span>应用层客户端发送HTTP请求：HTTP请求包含HTTP请求报头和请求主体，请求方法中包含了请求的方法(GET/POST),目标url，遵循的协议(http/https)，返回的消息是否缓存，是否发送cookie等</span></li><li><span>传输层TCP报文： TCP通过三次握手保证数据安全。首先发送端发送一个带有SYN(synchronize)标志的数据包给接收端，在一定时间内等待回复，传回一个ACK/SYN标志的数据包表示确认，客户端在发送一个ACK标志的数据举报表示握手成功。在这期间发送端在延迟时间内没收到回复则默认接收方没收到请求并再次发送，直到回复为止</span></li><li><span>网络层IP协议查询MAC地址： IP协议的作用就是把TCP等个好的数据包发送给接收方，要想发送过去还得知道接收方的MAC地址。ARP协议可以把ip解析成MAC地址</span></li><li><span>数据到达数据链路层：找到对方的MAC地址后即开始发送传输数据</span></li><li><span>服务器接收数据：接收端服务器在链路层接收到数据包，再一层一层向上传到应用层，然后把分段的数据包重新组成原来的HTTP报文</span></li><li><span>服务器响应请求:服务端接收到HTTP请求后，查找客户端要找的资源并返回响应报文，响应报文中有一个很重要的信息--状态码，比如200就是请求成功，500就是服务端出错。响应报文也包含重定向url，客户端接收后再重新改变</span></li><li><span>服务器返回响应文件：请求成功后hi返回响应页面，然后在进行页面渲染</span></li></ol><h2><a name="springspringmvc与springboot三者的关系" class="md-header-anchor"></a><span>Spring、SpringMVC与SpringBoot三者的关系</span></h2><h5><a name="spring最初使用iocdiaop解耦应用然后springmvc就是基于spring的一个mvc框架主要解决web问题因为spring配置太麻烦所以就推出springboot用来简化开发springboot可以实现spring和springmvc的功能优点就是简化配置可以切换内嵌容器起步依赖比如需要创建一个web项目导入spring-boot-starter-web即可简化部署" class="md-header-anchor"></a><span>Spring最初使用ioc，di，aop解耦应用。然后springmvc就是基于spring的一个MVC框架，主要解决Web问题，因为spring配置太麻烦，所以就推出springboot用来简化开发。springboot可以实现spring和springmvc的功能，优点就是简化配置，可以切换内嵌容器，起步依赖，比如需要创建一个web项目，导入spring-boot-starter-web即可，简化部署</span></h5><h2><a name="谈hibernatejpa与spring-data-jpa三者之间的关系" class="md-header-anchor"></a><span>谈hibernate，jpa与spring data jpa三者之间的关系</span></h2><h5><a name="首先jpa就是java-持久化-api是sun公司推出的一套基于orm的规范" class="md-header-anchor"></a><span>首先jpa就是java 持久化 api，是sun公司推出的一套基于ORM的规范</span></h5><h5><a name="hibernate是一个全自动的orm框架它把pojo对象和数据库建立映射关系可以自动生成sql语句可以说hibernate是jpa的一种实现方式" class="md-header-anchor"></a><span>Hibernate是一个全自动的orm框架，它把POJO对象和数据库建立映射关系，可以自动生成sql语句，可以说hibernate是JPA的一种实现方式</span></h5><h5><a name="spring-data-jpa是spring提供了一套对jpa操作的封装是jpa规范下专门用来进行数据持久化的解决方案总的来说jpa是一种规范hibernate是jpa的一种实现而spring-data-jpa是对jpa更高级的封装让操作数据库更简单" class="md-header-anchor"></a><span>Spring Data JPA是spring提供了一套对JPA操作的封装，是JPA规范下专门用来进行数据持久化的解决方案总的来说JPA是一种规范，hibernate是JPA的一种实现，而Spring Data JPA是对JPA更高级的封装，让操作数据库更简单。</span></h5><h5><a name="使用spring-data-jpa步骤" class="md-header-anchor"></a><span>使用spring data jpa步骤</span></h5><ul><li><p><span>导入依赖</span></p></li><li><p><span>在实体类上标注几个注解@Entity，@Table，  @Data</span></p><ul><li><span>@Entity：表示这个类是和数据库表对应的实体类</span></li><li><span>@Table： 表示是和哪张表对应</span></li><li><span>@Data是lombok的注解</span></li></ul></li><li><p><span>在主键字段上添加@Id表示这个字段是主键 加@GeneratedValue表示主键自增</span></p></li><li><p><span>然后在写一个接口继承JpaRepository，这个接口的泛型有两个参数，一个是这个接口对应的实体类，一个是主键字段的类型</span></p></li><li><p><span>可以再application.yml文件中配置spring.jpa.show-sql：true/false来表示是否显示SQL语句</span></p></li></ul><h2><a name="实现定时任务的几种方式" class="md-header-anchor"></a><span>实现定时任务的几种方式</span></h2><h5><a name="1-timer这是java自带的timer类这个类允许你调度timertask任务使用这种方式可以让你的程序某一个频度执行但是不能在指定时间执行一般用得少" class="md-header-anchor"></a><span>1. Timer:这是java自带的Timer类，这个类允许你调度TimerTask任务。使用这种方式可以让你的程序某一个频度执行，但是不能在指定时间执行，一般用得少</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>13</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">TestTimer</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">TimerTask</span> <span class="cm-variable">timerTask</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">TimerTask</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"task  run:"</span><span class="cm-operator">+</span> <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>());</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  };</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Timer</span> <span class="cm-variable">timer</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Timer</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//安排指定的任务在指定的时间开始进行重复的固定延迟执行。这里是每3秒执行一次</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">timer</span>.<span class="cm-variable">schedule</span>(<span class="cm-variable">timerTask</span>,<span class="cm-number">10</span>,<span class="cm-number">3000</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 338px;"></div><div class="CodeMirror-gutters" style="height: 338px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre><h5><a name="2-scheduledexecutorservice-也是jdk自带的类是基于线程池设计的定时任务类每个调度任务都会分配到线程池中的一个线程去执行就是说任务是并发执行互不影响" class="md-header-anchor"></a><span>2. ScheduledExecutorService: 也是jdk自带的类，是基于线程池设计的定时任务类。每个调度任务都会分配到线程池中的一个线程去执行，就是说任务是并发执行，互不影响。</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>9</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">TestScheduledExecutorService</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ScheduledExecutorService</span> <span class="cm-variable">service</span> <span class="cm-operator">=</span> <span class="cm-variable">Executors</span>.<span class="cm-variable">newSingleThreadScheduledExecutor</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 参数：1、任务体 2、首次执行的延时时间</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// &nbsp; &nbsp;  3、任务执行间隔 4、间隔时间单位</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">service</span>.<span class="cm-variable">scheduleAtFixedRate</span>(()<span class="cm-operator">-&gt;</span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"taskScheduledExecutorService "</span><span class="cm-operator">+</span><span class="cm-keyword">new</span> <span class="cm-variable">Date</span>()),</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-number">0</span>, <span class="cm-number">3</span>, <span class="cm-variable">TimeUnit</span>.<span class="cm-variable">SECONDS</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 234px;"></div><div class="CodeMirror-gutters" style="height: 234px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h5><a name="3spring-taskspring30以后自带的task可以把它看成一个轻量级的quartz而且使用起来比quartz简单许多" class="md-header-anchor"></a><span>3.Spring Task：Spring3.0以后自带的task，可以把它看成一个轻量级的Quartz,而且使用起来比Quartz简单许多</span></h5><ul><li><p><span>单线程方式：使同一个线程串行执行，如果只有一个定时任务，没问题。任务如果增加，一个任务卡死，后面的任务阻塞</span></p><ul><li><p><span>先导入依赖</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="xml" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>20</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependencies</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springframework.boot<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>spring-boot-starter-web<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springframework.boot<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>spring-boot-starter<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.projectlombok<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>lombok<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">optional</span><span class="cm-tag cm-bracket">&gt;</span>true<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">optional</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span>org.springframework.boot<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">groupId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span>spring-boot-starter-test<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">artifactId</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span>test<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">scope</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependency</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">dependencies</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 520px;"></div><div class="CodeMirror-gutters" style="height: 520px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre></li><li><p><span>创建任务类</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>32</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Component</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@EnableScheduling</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//@Async</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">AlarmTask</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**默认是fixedDelay 上一次执行完毕时间后执行下一轮*/</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">@Scheduled</span>(<span class="cm-variable">cron</span> <span class="cm-operator">=</span> <span class="cm-string">"0/5 * * * * *"</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() <span class="cm-keyword">throws</span> <span class="cm-variable">InterruptedException</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">6000</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span class="cm-variable">getName</span>()<span class="cm-operator">+</span><span class="cm-string">"=====&gt;&gt;&gt;&gt;&gt;使用cron  {}"</span><span class="cm-operator">+</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>(<span class="cm-variable">System</span>.<span class="cm-variable">currentTimeMillis</span>()<span class="cm-operator">/</span><span class="cm-number">1000</span>));</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**fixedRate:上一次开始执行时间点之后5秒再执行*/</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Scheduled</span>(<span class="cm-variable">fixedRate</span> <span class="cm-operator">=</span> <span class="cm-number">5000</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run1</span>() <span class="cm-keyword">throws</span> <span class="cm-variable">InterruptedException</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">6000</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span class="cm-variable">getName</span>()<span class="cm-operator">+</span><span class="cm-string">"=====&gt;&gt;&gt;&gt;&gt;使用fixedRate  {}"</span><span class="cm-operator">+</span>(<span class="cm-variable">System</span>.<span class="cm-variable">currentTimeMillis</span>()<span class="cm-operator">/</span><span class="cm-number">1000</span>));</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**fixedDelay:上一次执行完毕时间点之后5秒再执行*/</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Scheduled</span>(<span class="cm-variable">fixedDelay</span> <span class="cm-operator">=</span> <span class="cm-number">5000</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run2</span>() <span class="cm-keyword">throws</span> <span class="cm-variable">InterruptedException</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">7000</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span class="cm-variable">getName</span>()<span class="cm-operator">+</span><span class="cm-string">"=====&gt;&gt;&gt;&gt;&gt;使用fixedDelay  {}"</span><span class="cm-operator">+</span>(<span class="cm-variable">System</span>.<span class="cm-variable">currentTimeMillis</span>()<span class="cm-operator">/</span><span class="cm-number">1000</span>));</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**第一次延迟2秒后执行，之后按fixedDelay的规则每5秒执行一次*/</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Scheduled</span>(<span class="cm-variable">initialDelay</span> <span class="cm-operator">=</span> <span class="cm-number">2000</span>, <span class="cm-variable">fixedDelay</span> <span class="cm-operator">=</span> <span class="cm-number">5000</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run3</span>(){</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span class="cm-variable">getName</span>()<span class="cm-operator">+</span><span class="cm-string">"=====&gt;&gt;&gt;&gt;&gt;使用initialDelay  {}"</span><span class="cm-operator">+</span>(<span class="cm-variable">System</span>.<span class="cm-variable">currentTimeMillis</span>()<span class="cm-operator">/</span><span class="cm-number">1000</span>));</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 936px;"></div><div class="CodeMirror-gutters" style="height: 936px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre></li></ul></li></ul><p>&nbsp;</p><ul><li><p><span>多线程方式：添加一个配置类.然后在定时任务的类或者方法上添加@Async 。最后重启项目，每一个任务都是在不同的线程中</span>
<span>	</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>19</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@Configuration</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">@EnableAsync</span> &nbsp;<span class="cm-comment">//开启异步事件的支持</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">AsyncConfig</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp; <span class="cm-comment">/*</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp;<span class="cm-comment">此处成员变量应该使用@Value从配置中读取</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">corePoolSize</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">maxPoolSize</span> <span class="cm-operator">=</span> <span class="cm-number">200</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">queueCapacity</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp;<span class="cm-meta">@Bean</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">Executor</span> <span class="cm-variable">taskExecutor</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ThreadPoolTaskExecutor</span> <span class="cm-variable">executor</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ThreadPoolTaskExecutor</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">executor</span>.<span class="cm-variable">setCorePoolSize</span>(<span class="cm-variable">corePoolSize</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">executor</span>.<span class="cm-variable">setMaxPoolSize</span>(<span class="cm-variable">maxPoolSize</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">executor</span>.<span class="cm-variable">setQueueCapacity</span>(<span class="cm-variable">queueCapacity</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">executor</span>.<span class="cm-variable">initialize</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">executor</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 494px;"></div><div class="CodeMirror-gutters" style="height: 494px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre></li></ul><h5><a name="4quartz这是一个功能强大的调度器可以让你的程序在指定时间运行也可以按照某一频度执行配置起来稍复杂" class="md-header-anchor"></a><span>4.Quartz:这是一个功能强大的调度器，可以让你的程序在指定时间运行，也可以按照某一频度执行，配置起来稍复杂</span></h5><h2><a name="java中类及方法的加载顺序" class="md-header-anchor"></a><span>Java中类及方法的加载顺序</span></h2><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>63</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">A</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">int</span> <span class="cm-variable">numA</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">numA2</span>; </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">static</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"A的静态字段 : "</span> <span class="cm-operator">+</span> <span class="cm-variable">numA</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"A的静态代码块"</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"A的成员变量  : "</span> <span class="cm-operator">+</span> <span class="cm-variable">numA2</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"A的非静态代码块"</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">A</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"A的构造器"</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">B</span> <span class="cm-keyword">extends</span> <span class="cm-variable">A</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">int</span> <span class="cm-variable">numB</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">numB2</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">static</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"B的静态字段 : "</span> <span class="cm-operator">+</span> <span class="cm-variable">numB</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"B的静态代码块"</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"B的成员变量 : "</span> <span class="cm-operator">+</span> <span class="cm-variable">numB2</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"B的非静态代码块"</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">B</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"B的构造器"</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">37</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">38</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">39</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">Box</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">40</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">41</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A</span> <span class="cm-variable">ab</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">B</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">42</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"---"</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">43</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ab</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">B</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">44</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">45</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">46</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">结果</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">47</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">A的静态字段</span> : <span class="cm-number">0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">48</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">A的静态代码块</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">49</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">B的静态字段</span> : <span class="cm-number">0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">50</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">B的静态代码块</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">51</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">A的成员变量</span>  : <span class="cm-number">0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">52</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">A的非静态代码块</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">53</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">A的构造器</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">54</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">B的成员变量</span> : <span class="cm-number">0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">55</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">B的非静态代码块</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">56</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">B的构造器</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">57</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">---</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">58</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">A的成员变量</span>  : <span class="cm-number">0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">59</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">A的非静态代码块</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">60</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">A的构造器</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">61</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">B的成员变量</span> : <span class="cm-number">0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">62</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">B的非静态代码块</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">63</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">B的构造器</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1638px;"></div><div class="CodeMirror-gutters" style="height: 1638px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre><h5><a name="无参构造父类的静态字段----父类的静态代码块----子类的静态字段----子类的静态代码块----父类成员变量非静态字段----父类的非静态代码块----父类构造器----子类成员变量----子类成员变量----子类非静态代码块----子类构造器" class="md-header-anchor"></a><span>无参构造：父类的静态字段 --&gt; 父类的静态代码块 --&gt; 子类的静态字段 --&gt; 子类的静态代码块 --&gt; 父类成员变量(非静态字段) --&gt; 父类的非静态代码块 --&gt; 父类构造器 --&gt; 子类成员变量 --&gt; 子类成员变量 --&gt; 子类非静态代码块 --&gt; 子类构造器</span></h5><h5><a name="有参构造改成调用b的有参构造如果没有指定a的构造器就默认是无参的new-b还是会执行a的无参构造" class="md-header-anchor"></a><span>有参构造：改成调用B的有参构造，如果没有指定A的构造器就默认是无参的，new B();还是会执行A的无参构造</span></h5><h2><a name="数据结构" class="md-header-anchor"></a><span>数据结构</span></h2><h5><a name="数组数组是一个在内存中连续存储多个元素的结构在内存中的分配也是连续的数组元素可以通过下标访问查询快增删改慢数组大小定长" class="md-header-anchor"></a><span>数组：数组是一个在内存中连续存储多个元素的结构，在内存中的分配也是连续的，数组元素可以通过下标访问。查询快，增删改慢。数组大小定长</span></h5><h5><a name="链表内存是不连续的每个元素包含两个节点一个存放数据另一个存放下一个节点的引用地址增删改快查询慢不需要初始容量可以任意加减元素" class="md-header-anchor"></a><span>链表：内存是不连续的，每个元素包含两个节点，一个存放数据，另一个存放下一个节点的引用地址。增删改快，查询慢。不需要初始容量，可以任意加减元素。</span></h5><h5><a name="队列队列可以在一头添加元素从另一头出来先进先出的原则" class="md-header-anchor"></a><span>队列：队列可以在一头添加元素，从另一头出来，先进先出的原则。</span></h5><h5><a name="栈特点是先进后出只能操作栈顶不能操作栈底" class="md-header-anchor"></a><span>栈：特点是先进后出，只能操作栈顶，不能操作栈底。</span></h5><h5><a name="散列表根据键值直接进行访问的数据结构就是把key通过hash函数转成整形数字然后用该数字对数组取余得到的值就是数组的下标value就存在这里散列表是数组的衍生结构所以查询速度快删除增加比较慢所以采用拉链法早期的hashmap就是这样当两个key定位到数组同一个位置看是否key相同不相同则使用拉链法跟在后面" class="md-header-anchor"></a><span>散列表：根据键值直接进行访问的数据结构，就是把key通过hash函数转成整形数字然后用该数字对数组取余，得到的值就是数组的下标，value就存在这里。散列表是数组的衍生结构所以查询速度快，删除增加比较慢。所以采用拉链法，早期的hashmap就是这样。当两个key定位到数组同一个位置，看是否key相同，不相同则使用拉链法跟在后面。</span></h5><ul><li><img src="../img/image-20211015201416458.png" referrerpolicy="no-referrer" alt="image-20211015201416458"><span> </span></li></ul><h5><a name="树就像一颗倒着的数根朝上叶子朝下每个节点都有零个或多个子节点每个非根节点只有一个根节点比如二叉树的特点就是每个节点只有两个子节点左边节点的值比右边节点的小查询快增删改也快" class="md-header-anchor"></a><span>树：就像一颗倒着的数，根朝上叶子朝下。每个节点都有零个或多个子节点，每个非根节点只有一个根节点。比如二叉树的特点就是每个节点只有两个子节点，左边节点的值比右边节点的小。查询快，增删改也快</span></h5><p><img src="../img/image-20211018102707165.png" referrerpolicy="no-referrer" alt="image-20211018102707165"><span> </span></p><h5><a name="堆就是用数组实现的二叉树总是一棵完全二叉树分为两种大顶堆和小顶堆差别在于排序方式大顶堆的根节点比每个子节点都大小顶堆则相反比每个子节点都小因为堆有序的特点一般用来做数组中的排序称为堆排序" class="md-header-anchor"></a><span>堆：就是用数组实现的二叉树，总是一棵完全二叉树。分为两种，大顶堆和小顶堆，差别在于排序方式。大顶堆的根节点比每个子节点都大，小顶堆则相反，比每个子节点都小。因为堆有序的特点，一般用来做数组中的排序，称为堆排序。</span></h5><ul><li><p><img src="../img/image-20211015201812605.png" referrerpolicy="no-referrer" alt="image-20211015201812605"><span> </span></p></li><li><p><span>[10, 7, 2, 5, 1]吧这个数组用堆来显示，首先把数组中元素在堆中的位置算出来，如果i是索引可以根据下面的公式算出来</span>
<span>	</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>3</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">parent(i) = floor((i - 1)/2)  父节点位置</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">left(i) &nbsp; = 2i + 1<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>  左边子节点位置</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">right(i)  = 2i + 2<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>  右边子节点位置</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 78px;"></div><div class="CodeMirror-gutters" style="height: 78px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre></li></ul><figure><table><thead><tr><th><span>Node</span></th><th><span>array index</span></th><th><span>Parent index</span></th><th><span>Left child</span></th><th><span>Right child</span></th></tr></thead><tbody><tr><td><span>10</span></td><td><span>0</span></td><td><span>-1</span></td><td><span>1</span></td><td><span>2</span></td></tr><tr><td><span>7</span></td><td><span>1</span></td><td><span>0</span></td><td><span>3</span></td><td><span>4</span></td></tr><tr><td><span>5</span></td><td><span>2</span></td><td><span>0</span></td><td><span>5</span></td><td><span>6</span></td></tr><tr><td><span>2</span></td><td><span>3</span></td><td><span>1</span></td><td><span>7</span></td><td><span>8</span></td></tr><tr><td><span>1</span></td><td><span>4</span></td><td><span>1</span></td><td><span>9</span></td><td><span>10</span></td></tr></tbody></table></figure><h5><a name="注意根节点10没有父节点因为--1-不是一个有效的数组索引同样节点-25和1-没有子节点因为这些索引已经超过了数组的大小所以我们在使用这些索引值的时候需要保证是有效的索引值" class="md-header-anchor"></a><span>注意：根节点(10)没有父节点，因为 -1 不是一个有效的数组索引。同样，节点 (2)，(5)和(1) 没有子节点，因为这些索引已经超过了数组的大小，所以我们在使用这些索引值的时候需要保证是有效的索引值。</span></h5><h5><a name="图暂时不提" class="md-header-anchor"></a><span>图:暂时不提</span></h5><h5><a name="二叉树平衡二叉树红黑树b树b树httpswwwjianshucompb597aa97c9de" class="md-header-anchor"></a><a href='https://www.jianshu.com/p/b597aa97c9de'><span>二叉树、平衡二叉树、红黑树、B树、B+树</span></a></h5><h5><a name="二叉树左边子树的值比父节点的小右边子树得值比父节点大正常情况下数的结构很正常不正常的时候就是节点都在同一条直线上形成链表导致查询速度变慢就引出了平衡二叉树" class="md-header-anchor"></a><span>二叉树：左边子树的值比父节点的小，右边子树得值比父节点大。正常情况下数的结构很正常。不正常的时候就是节点都在同一条直线上，形成链表，导致查询速度变慢，就引出了平衡二叉树</span></h5><h5><a name="完全二叉树除了最后一层其他层都是满的或者在右边缺少连续若干节点父节点和子节点有对应关系当根节点为x时左边子节点的值为2x右边节点为2x--1" class="md-header-anchor"></a><span>完全二叉树：除了最后一层其他层都是满的，或者在右边缺少连续若干节点，父节点和子节点有对应关系。当根节点为x时，左边子节点的值为2x，右边节点为2x + 1。</span></h5><p><img src="../img/image-20211018103727924.png" referrerpolicy="no-referrer" alt="image-20211018103727924"><span> </span></p><h5><a name="平衡二叉树是基于二分法的策略提高查找速度的二叉树结构跟二叉树差不多使用算法实现实现节点数据结构的平衡平衡二叉树能保证数据的左右节点层级相差不会大于1而且不会有重复值" class="md-header-anchor"></a><span>平衡二叉树：是基于二分法的策略提高查找速度的二叉树结构。跟二叉树差不多。使用算法实现实现节点数据结构的平衡。平衡二叉树能保证数据的左右节点层级相差不会大于1。而且不会有重复值</span></h5><h5><a name="红黑树平衡二叉树不是解决退化链表的最好方案因为它要求左右节点层级相差不大于1导致每次插入删除时都会破坏这条规则需要左旋右旋来调整成为符合要求的平衡树保证平衡的母的就是为了减少树的高度树的敢对越低查询起来越快红黑树的特点" class="md-header-anchor"></a><span>红黑树:平衡二叉树不是解决退化链表的最好方案，因为它要求左右节点层级相差不大于1，导致每次插入删除时都会破坏这条规则，需要左旋右旋来调整成为符合要求的平衡树。保证平衡的母的就是为了减少树的高度，树的敢对越低查询起来越快。红黑树的特点：</span></h5><ul><li><span>节点要么是黑色要么是红色</span></li><li><span>根节点是黑色</span></li><li><span>每个空叶子结点都是黑色</span></li><li><span>如果一个节点为红色，那他的子节点必须是黑色</span></li><li><span>从一个节点到该节点的子节点的所有路径上包含相同数目的黑节点</span></li></ul><h5><a name="b树属于多叉树又叫平衡多路查找树" class="md-header-anchor"></a><span>B树：属于多叉树又叫平衡多路查找树。</span></h5><h5><a name="b树" class="md-header-anchor"></a><span>B+树：</span></h5><h2><a name="tomcat源码分析" class="md-header-anchor"></a><span>Tomcat源码分析</span></h2><h5><a name="tomcat的初始化和启动" class="md-header-anchor"></a><span>tomcat的初始化和启动:</span></h5><blockquote><p><span>启动tomcat的时候使用start.sh脚本，就相当于调用tomcat中Bootstrap类的main方法且参数是start。首先新建一个Bootstrap对象，然后调用init()方法，这一步初始化了类加载器，还有通过反射创建Catalina对象。第二步因为传的参数是start。 然后调用load()方法，这里调用的load方法是Bootstrap的实质上是调用的Catalina对象的，主要做的就是加载server.xml文件。第三步调用start()方法，实质上也是调用Cataline的start()方法，启动Server组件，然后Server组件会带动其他组件一起启动，如service，connector，Engine，Host， Context，Wrapper组件，最后载调用Cataline的await()方法，循环等待接收shutdown命令。</span></p></blockquote><h5><a name="tomcat的关闭流程" class="md-header-anchor"></a><span>tomcat的关闭流程</span></h5><blockquote><p><span>关闭Tomcat的时候使用shutdown.sh脚本，相当于传的stop参数。这里也是创建一个Bootstrap对象，然后调用stopServer()方法，本质上也是调用Cataline的stopServer方法，主要是根据server.xml创建一个server对象，然后用地址跟端口连接之前启动的socket对象，发送shutdown指令来关闭。</span></p></blockquote><h2><a name="java中string类型有没有长度的限制" class="md-header-anchor"></a><span>Java中String类型有没有长度的限制</span></h2><h5><a name="编译期的限制字符串的utf8编码值的字节数不能超过65535字符串的长度不能超过65534是因为常量池的限制少一个字节是因为还需要存一个结束命令" class="md-header-anchor"></a><span>编译期的限制：字符串的UTF8编码值的字节数不能超过65535，字符串的长度不能超过65534；是因为常量池的限制，少一个字节是因为还需要存一个结束命令。</span></h5><h5><a name="运行时限制字符串的长度不能超过231-1占用的内存数不能超过虚拟机能够提供的最大值因为string的长度是数组的长度能显示最大的数就是231-1" class="md-header-anchor"></a><span>运行时限制：字符串的长度不能超过2^31-1，占用的内存数不能超过虚拟机能够提供的最大值。因为String的长度是数组的长度，能显示最大的数就是2^31-1</span></h5><h2><a name="java类加载过程" class="md-header-anchor"></a><span>Java类加载过程</span></h2><h4><a name="类的声明周期-加载----连接----初始化----使用----卸载" class="md-header-anchor"></a><span>类的声明周期： 加载 –&gt; 连接 –&gt; 初始化 –&gt; 使用 –&gt; 卸载</span></h4><p><img src="../img/image-20211021101349606.png" referrerpolicy="no-referrer" alt="image-20211021101349606"><span> </span></p><h5><a name="加载" class="md-header-anchor"></a><span>加载：</span></h5><ul><li><h6><a name="通过类的全类名获取定义这个类的二进制字节流将字节流所代表的的静态存储结构转换成方法区的运行时数据结构在内存中生成该类的class对象" class="md-header-anchor"></a><span>通过类的全类名获取定义这个类的二进制字节流，将字节流所代表的的静态存储结构转换成方法区的运行时数据结构，在内存中生成该类的Class对象。</span></h6></li></ul><h5><a name="连接" class="md-header-anchor"></a><span>连接</span></h5><ul><li><h6><a name="验证校验文件格式元数据字节码等" class="md-header-anchor"></a><span>验证：校验文件格式，元数据，字节码等</span></h6></li><li><h6><a name="准备分配内存并给静态变量设置初始值" class="md-header-anchor"></a><span>准备：分配内存并给静态变量设置初始值</span></h6></li><li><h6><a name="解析是虚拟机将常量池内的符号引用替换为直接引用的过程" class="md-header-anchor"></a><span>解析：是虚拟机将常量池内的符号引用替换为直接引用的过程</span></h6></li></ul><h5><a name="初始化" class="md-header-anchor"></a><span>初始化</span></h5><ul><li><h6><a name="执行初始化方法开始加载字节码文件" class="md-header-anchor"></a><span>执行初始化方法，开始加载字节码文件</span></h6></li></ul><h5><a name="卸载" class="md-header-anchor"></a><span>卸载</span></h5><ul><li><h6><a name="就是被gc回收需要满足三个条件" class="md-header-anchor"></a><span>就是被GC回收，需要满足三个条件</span></h6><ul><li><h6><a name="堆中不存在该类的实例对象" class="md-header-anchor"></a><span>堆中不存在该类的实例对象</span></h6></li><li><h6><a name="该类在其他地方没有被引用" class="md-header-anchor"></a><span>该类在其他地方没有被引用</span></h6></li><li><h6><a name="该类的类加载器实例已经被gc" class="md-header-anchor"></a><span>该类的类加载器实例已经被GC</span></h6></li></ul></li></ul><h2><a name="java类加载器" class="md-header-anchor"></a><span>Java类加载器</span></h2><ul><li><h4><a name="bootstrapclassloader启动类加载器最顶层的类加载器c实现负责加载基础核心jar包" class="md-header-anchor"></a><span>BootstrapClassLoader(启动类加载器)：最顶层的类加载器，C++实现负责加载基础核心jar包</span></h4></li><li><h4><a name="extensionclassloader扩展类加载器主要负责加载系统变量所指定路径下的jar包" class="md-header-anchor"></a><span>ExtensionClassLoader(扩展类加载器)：主要负责加载系统变量所指定路径下的jar包</span></h4></li><li><h4><a name="appclassloader应用程序类加载器加载当前应用classpath下的所有jar包和类" class="md-header-anchor"></a><span>AppClassLoader(应用程序类加载器)：加载当前应用classpath下的所有jar包和类</span></h4></li><li><p><img src="../img/image-20211021112540096.png" referrerpolicy="no-referrer" alt="image-20211021112540096"><span> </span></p></li></ul><h2><a name="java创建对象的过程" class="md-header-anchor"></a><span>Java创建对象的过程</span></h2><h5><a name="step1-类加载检查" class="md-header-anchor"></a><span>Step1： 类加载检查</span></h5><blockquote><p><span>new对象的时候，会首先看有没有加载，解析，初始化过，如果没有就要先执行类加载过程</span></p></blockquote><h5><a name="step2-分配内存" class="md-header-anchor"></a><span>Step2： 分配内存</span></h5><blockquote><p><span>为新生对象分配内存</span></p></blockquote><h5><a name="step3-初始化零值" class="md-header-anchor"></a><span>Step3： 初始化零值</span></h5><blockquote><p><span>虚拟机要将分配到的内存空间都初始化为0值</span></p></blockquote><h5><a name="step4-设置对象头" class="md-header-anchor"></a><span>Step4： 设置对象头</span></h5><blockquote><p><span>初始完成后要对对象进行必要的设置，设置类的原数据，对象的hash之类的。</span></p><p><img src="../img/image-20211016115041855.png" referrerpolicy="no-referrer" alt="image-20211016115041855"><span> </span></p></blockquote><h5><a name="step5-执行init方法" class="md-header-anchor"></a><span>Step5： 执行init方法</span></h5><blockquote><p><span>执行完init方法就创建出来了</span></p></blockquote><h2><a name="zuul和gateway的区别" class="md-header-anchor"></a><span>zuul和gateway的区别</span></h2><h5><a name="zuul" class="md-header-anchor"></a><span>zuul</span></h5><ul><li><span>zuul使用的阻塞式的api。没有提供异步支持,都是servlet实现，都是处理http请求</span></li></ul><blockquote><p><span>工作原理: zuul的核心是一系列的过滤链，有pre post  error route这四种过滤器，分别在请求之前执行，请求之后，请求出错执行，第四种是用于转发请求的。还可以自定义filter，实现zuulFilter即可，用户请求首先到pre，然后到route，然后转发到其他微服务，然后执行post，在走filter的时候如果出错了就会进入error，然后返回。</span><span>	</span></p><p><img src="./img/2.png" referrerpolicy="no-referrer"><span> </span></p></blockquote><h5><a name="gateway" class="md-header-anchor"></a><span>gateway</span></h5><ul><li><span>gateway用的是webflux，不能servlet容器一起使用，引入spring-boot-starter-web会报错，提供了异步支持，都是servlet实现，都是处理http请求</span></li></ul><blockquote><p><span>请求到gateway时在gateway handle mapping中找到与请求匹配的路由，然后发送到gateway web handler。handler在通过指的的过滤器链吧请求发到其他服务，然后返回。首先进来执行的是过滤器的pre方法，请求返回的时候执行的post方法，遵循后进先出的原则</span>
<img src="./img/1.png" referrerpolicy="no-referrer"></p></blockquote><h5><a name="gateway三大概念" class="md-header-anchor"></a><span>gateway三大概念</span></h5><ul><li><span>路由： 构建网关的基本模块，由id, uri, 断言, 过滤器组成，如果断言为true就匹配该路由</span></li><li><span>断言： 可以匹配请求头或者请求参数，匹配成功就进行路由，相当于匹配规则</span></li><li><span>过滤： 可以在请求前后执行对请求进行修改</span></li></ul><h2><a name="redis哨兵模式和主从区别哨兵选举的原理主从复制原理" class="md-header-anchor"></a><span>Redis哨兵模式和主从区别，哨兵选举的原理，主从复制原理</span></h2><h4><a name="rdb" class="md-header-anchor"></a><span>rdb</span></h4><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>12</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">触发规则</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>15 分钟 1次</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>5分钟 10次</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>1分钟 10000次</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>使用 save bgsave命令</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">工作原理</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>触发快照之后会fork出一个子线程，主线程继续接受命令，子线程进行复制，复制完成后会覆盖掉原来的rdb文件</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">优点</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>保存和还原大规模数据快，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">缺点</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>对数据的一致性和完整性就没那么友好，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>fork子线程的时候等于是克隆了一份主线程的数据，如果内存小数据量大可能会崩</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 312px;"></div><div class="CodeMirror-gutters" style="height: 312px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre><h4><a name="aof" class="md-header-anchor"></a><span>aof</span></h4><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>15</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;">触发规则<span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>每执行一个命令就触发</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>每秒触发</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>跟系统同步触发</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;">工作原理<span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>会记录下每次操作的命令写到文件中，然后恢复的时候就把文件里的命令全部执行一次</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rewrite原理</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>当aof文件是上次rewrite后文件的一倍且大于64m时触发</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>重写会fork一个子线程，然后重写一个新的aof文件，并不会读取原来的aof文件，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>在重写的时候，主线程接受到的命令会存到缓冲池中，重写完成后，会把缓冲池的数据添加到rewrite文件中然后覆盖原来的aof文件，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;">优点<span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>数据完整性保存的比较好</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;">缺点<span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>恢复数据慢</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>每秒同步会导致性能差</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 390px;"></div><div class="CodeMirror-gutters" style="height: 390px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre><h4><a name="主从复制原理" class="md-header-anchor"></a><span>主从复制原理</span></h4><p><img src="../img/image-20211023153425193.png" referrerpolicy="no-referrer" alt="image-20211023153425193"><span> </span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">主库启动之后，从库启动会进行一次全量同步，再进行增量同步。</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 26px;"></div><div class="CodeMirror-gutters" style="height: 26px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h5><a name="全量复制" class="md-header-anchor"></a><span>全量复制</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>3</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">从库连接主库向主库发送同步命令，主库接受到之后执行bgsave命令生成rdb文件并使用缓冲区接受新的命令</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">bgsave执行完后吧rdb文件发给从库，从库丢弃之前的数据开始载入rdb文件，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">主库发送完rdb文件之后会向从库发送缓冲区的写命令，从库载入完成后接受写命令并执行</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 78px;"></div><div class="CodeMirror-gutters" style="height: 78px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h5><a name="增量复制" class="md-header-anchor"></a><span>增量复制</span></h5><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">增量复制是指主库从库都运行起来后，主库接受到的写命令，就往从库发送一个写命令，从库接受到并执行</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 26px;"></div><div class="CodeMirror-gutters" style="height: 26px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h4><a name="哨兵模式" class="md-header-anchor"></a><span>哨兵模式</span></h4><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 39px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>28</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">作用：</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>监控：会不断的检查你的主服务器和从服务器是否运作正常</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>提醒：当某个redis节点出现故障的时候，会通过api发送通知</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>自动故障转移：当主服务器不可用时，会选举一个从服务器升级成主服务器，其他从服务器会复制新的主服务器</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>每个哨兵会启动三个定时任务</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>1. 每隔一秒向所有的master， slave，别的sentinel发送ping命令来检测心跳</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>2. sentinel每隔2s向master的sentinel发送自己的信息，用来信息交换</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>3. 每隔10s向master，salve发送info命令获取最新的拓扑结构</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>判断master宕机</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>主观下线：当每秒ping每秒master，超过默认值30s后没有响应就认为主观下线了。</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>客观下线： </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>sentinel节点会向其他sentinel节点发送主观下线的节点信息，ip端口啥的询问其他sentinel是否同意下线</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>每个sentinel都到信息后会判断结果，如果认为下线就会回复</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>sentinel收到回复后判断是否大于等于quorum(5个sentinel，quorum=2，只需要两个同意就下线，为3就需要5个节点都同意)就认为这个节点下线了</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>选举sentinel来进行故障转移的过程</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>判断master下线的节点向其他节点发送信息，会带上自己的一个id</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>目标节点回复，由于这个过程是先到先得的原则，节点1给节点2发信息，节点2回复节点1，节点3在回复节点2就会被拒绝</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>当节点发现选自己的节点个数超过了majority，那么就是领头结点</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>如果没有一个节点达到majority，就会过段时间重新选举</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>故障转移过程</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>首先会排除掉不满足条件的slave</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>已经下线的salve</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>5s没有回复info信息的slave</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>选主过程</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>选择优先级最高的节点，通过sentinel配置，值越小优先级越高</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>第一步相同就选offset最大的，越大表示同步的数据越多</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>第二步也相同就选择run id比较小的</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>选主完成后想slave发送salveof命令同步数据</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 754px;"></div><div class="CodeMirror-gutters" style="height: 754px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre><h2><a name="mysql主从复制原理" class="md-header-anchor"></a><span>Mysql主从复制原理</span></h2><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>4</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. 主线程会把写操作记录二进制binlog日志，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. salve服务会在一定时间间隔内探测master的binlog文件是否改变，如果改变了就启动一个I/O线程请求master二进制事件</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. 同时主节点会为每个I/O线程启动一个dump线程，向其发送二进制事件，并保存在relay-log中继日志中，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4. 从节点从中继日志中读取二进制日志在本地重放，然后启动一个sql线程执行，使得与master数据一致。然后进入睡眠状态等待二次唤醒</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 104px;"></div><div class="CodeMirror-gutters" style="height: 104px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><p><img src="../img/image-20211023145425039.png" referrerpolicy="no-referrer" alt="image-20211023145425039"><span> </span></p><h4><a name="mysql主从延迟" class="md-header-anchor"></a><span>mysql主从延迟</span></h4><h5><a name="原因" class="md-header-anchor"></a><span>原因：</span></h5><ul><li><span>主库写压力过大，因为主库可以并发，从库不能，所以导致写入速度慢出现延迟</span></li><li><span>主库写binlog是顺序写，速度快，从库从中继日志中读取由sql线程重放，是随机的，写入磁盘就比较慢</span></li><li><span>sql线程是单线程，执行sql的时候阻塞住了就会一直等待，直到成功了才会继续执行</span></li></ul><h5><a name="判断方法-可以使用show-slave-status命令查看主从延迟" class="md-header-anchor"></a><span>判断方法： 可以使用show slave status命令查看主从延迟</span></h5><h5><a name="解决方法mysql56以后提供了并行复制方式通过把sql线程转换为多个work线程来重放" class="md-header-anchor"></a><span>解决方法;mysql5.6以后提供了并行复制方式，通过把sql线程转换为多个work线程来重放。</span></h5><h2><a name="mysql可重复读的实现mvcc和锁参考链接httpszhuanlanzhihucomp118658549" class="md-header-anchor"></a><span>Mysql可重复读的实现(mvcc和锁),</span><a href='https://zhuanlan.zhihu.com/p/118658549'><span>参考链接</span></a></h2><h4><a name="事务的行锁" class="md-header-anchor"></a><span>事务的行锁</span></h4><ul><li><strong><span>共享锁</span></strong><span>：也叫读锁，允许事务读取一行记录。</span><code>Select … lock in share mode</code><span>语句能够获得共享锁</span></li><li><strong><span>排它锁</span></strong><span>：也叫写锁，允许事务更新或删除一行记录。</span><code>Select … for update</code><span>(特殊的select，用mysql简单实现分布式锁经常用它）、Update、delete语句能够获得排它锁</span></li></ul><h4><a name="多版本并发控制mvcc" class="md-header-anchor"></a><span>多版本并发控制MVCC</span></h4><p><span>上面说的加锁是悲观锁方式，mvcc是乐观锁方式，可以提高性能。所谓多版本就是一行记录在数据库中存储了多个版本，每个版本以事务ID作为版本号。每个事务都有一个唯一的事务ID，是事务开始时向事务系统申请的，并且按照顺序严格递增，如果一行记录被多个事务修改，就会产生多个版本的记录。</span></p><p><img src="../img/image-20211022105247956.png" referrerpolicy="no-referrer" alt="image-20211022105247956"><span> </span></p><p><span>经过两次事务的操作，value从22变成了19，同时保留了三个事务id，15,25,30.。在记录多版本的基础上，需要用一致性视图来做版本的可见性判断。</span></p><h4><a name="一致性视图逻辑" class="md-header-anchor"></a><span>一致性视图逻辑</span></h4><p><span>读未提交没有一致性视图，串行化使用锁来保证并发。读未提交是</span><strong><span>在每个SQL开始执行的时候</span></strong><span>创建一致性视图。可重复读是</span><strong><span>在事务开始的时候</span></strong><span>创建一致性视图的</span></p><ul><li><span>当一个事务开启的时候，会向系统申请一个新事务id，此时可能还有多个正在进行的其他事务没有提交，因此在那一瞬间是有多个活跃的未提交事务id</span></li><li><span>将这些未提交的事务id组成一个数组，数组里最小的事务id记录为</span><strong><span>低水位</span></strong><span>，当前系统创建多的事务id的最大值+1记录为</span><strong><span>高水位</span></strong><span>，这个事务id数组和高水位就组成了</span><strong><span>一致性视图</span></strong></li></ul><p><span>当前事务中，读取其他某一行的记录，对其中版本号的可见性判断有五种情况</span></p><p><img src="../img/image-20211022111537564.png" referrerpolicy="no-referrer" alt="image-20211022111537564"><span> </span></p><ul><li><p><span>如果版本号小于</span><strong><span>低水位</span></strong><span>， 说明事务已经提交，可见。</span></p></li><li><p><span>如果版本号大于</span><strong><span>高水位</span></strong><span>， 说明这行数据的事务id版本是在快照后产生的，不可见。</span></p></li><li><p><span>如果事务id大于</span><strong><span>低水位</span></strong><span>，小于</span><strong><span>高水位</span></strong><span>，分两种情况：</span></p><ul><li><span>如果包含在事务id数组中，表示这个版本在事务启动的时候还没提交，不可见。</span></li><li><span>如果不在数组汇总，表示这个版本在事务启动时已经提交，可见。</span></li></ul><blockquote><p><span>例子：</span></p><p><span>系统创建过的事务id： 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15</span></p><p><span>事务A启动，拍个快照。此时未提交的事务id有：7， 8， 9</span></p><p><span>一致性视图就是：数组：[7,8,9]，低水位：1， 高水位： 16（15 + 1）</span></p></blockquote><ul><li><p><span>对于任意数据的可见性判断如下：</span></p><ul><li><span>小于7的说明已经提交，可见。</span></li><li><span>大于16的，说明是快照后产生的，不可见</span></li><li><span>10-15，不在数组中，说明已经提交了，可见</span></li><li><span>7， 8， 9在数组汇总，没有提交，不可见</span></li></ul></li></ul></li></ul><h5><a name="并发insert案例" class="md-header-anchor"></a><span>并发insert案例</span></h5><ul><li><p><img src="../img/image-20211022113805144.png" referrerpolicy="no-referrer" alt="image-20211022113805144"><span> </span></p></li><li><p><span>在不同隔离级别下Time5、Time7、Time9事务A查询到的值</span></p><ul><li><span>读未提交： 2， 2， 2</span></li><li><span>读已提交： 1， 2， 2</span></li><li><span>可重复读： 1， 1， 2</span></li><li><span>可串行化： 1， 1， 2（事务A提交前会有行锁锁住数据，所以得事务A先提交，后续事务才能提交）</span></li></ul></li></ul><h5><a name="并发update案例" class="md-header-anchor"></a><span>并发update案例</span></h5><ul><li><img src="../img/image-20211022114927871.png" referrerpolicy="no-referrer" alt="image-20211022114927871"><span> </span></li><li><span>事务A读取到的值为1，事务B读取到的值为3</span></li><li><span>原因：事务C首先锁住这一行+1后，事务B再锁这行+1，所以值为3。 即使是可重复读级别，事务</span><strong><span>更新数据</span></strong><span>的时候只能用</span><strong><span>当前读</span></strong><span>，不然update就出现数据不一致了。如果当前记录的行锁被其他事务占用，就需要进入锁等待。读已提交和可重复读逻辑类似，最主要的区别是创建一致性视图的时机，可重复读是在事务开始时，之后事务里的其他查询都用这个视图，读已提交是执行SQL的时候创建新的一致性视图。</span></li></ul><h2><a name="mysql-join底层实现" class="md-header-anchor"></a><span>Mysql Join底层实现</span></h2><p><span>mysql底层join实现只支持一种算法： 嵌套循环连接（</span><strong><span>Nested-Loop Join</span></strong><span>），</span><strong><span>Nested-Loop Join</span></strong><span>有三种变种：</span></p><ul><li><strong><span>Simple Nested-Loop Join：</span></strong><span>简单嵌套循环连接</span></li><li><strong><span>Index Nested-Loop Join：</span></strong><span>索引嵌套循环连接</span></li><li><strong><span>Block Nested-Loop Join：</span></strong><span>块索引嵌套连接</span></li></ul><h4><a name="simple-nested-loop-join简单嵌套）" class="md-header-anchor"></a><span>Simple Nested-Loop Join（简单嵌套）</span></h4><ul><li><span>A为驱动表，B为非驱动表。从A中取出数据1，遍历B，将匹配到的数据放到result，以此类推，每条A表的数据都会轮询B。</span></li></ul><p><img src="../img/image-20211022141842627.png" referrerpolicy="no-referrer" alt="image-20211022141842627"><span> </span></p><h4><a name="index-nested-loop-join索引嵌套）" class="md-header-anchor"></a><span>Index Nested-Loop Join（索引嵌套）</span></h4><ul><li><p><span>需要查询时，关联非驱动表的索引，通过索引来减少比较，加速查询。在查询时驱动表会根据关联字段的索引到非驱动表查找数据，找到对应的值，此时分两种情况：</span></p><ul><li><span>索引不是主键索引，需要回表查询(根据索引携带的主键信息查询数据)，先关联索引再根据主键ID查询，性能慢很多</span></li><li><span>如果关联字段是主键索引，速度会非常快，直接就能定位到数据</span></li></ul></li></ul><p><img src="../img/image-20211022142035332.png" referrerpolicy="no-referrer" alt="image-20211022142035332"><span> </span></p><h4><a name="block-nested-loop-join块嵌套）" class="md-header-anchor"></a><span>Block Nested-Loop Join（块嵌套）</span></h4><ul><li><p><span>如果是非驱动表的索引会走嵌套索引，但是join的列不是索引，就会采用</span><code>Block Nested-Loop Join</code><span>。首先将驱动表的结果放入集中所有与join相关的列都先缓存到join buffer中(当查找完后，就可以将匹配的记录从内存与非驱动表放到result返回)，然后批量与非驱动表进行匹配，将第一种中的多次比较合并为一次，降低了非驱动表的访问频率。默认情况下join_buffer_size=256k（可以通过</span></p><p><code>show variables like &#39;join_%&#39;</code><span>查看大小）</span></p></li></ul><p><img src="../img/image-20211022142940837.png" referrerpolicy="no-referrer" alt="image-20211022142940837"><span> </span></p><p><span>BNL 算法：将外层循环的行/结果集存入join buffer, 内层循环的每一行与整个buffer中的记录做比较，从而减少内层循环的次数.</span>
<span>举例来说，外层循环的结果集是100行，使用NLJ 算法需要扫描内部表100次，如果使用BNL算法，先把对Outer Loop表(外部表)每次读取的10行记录放到join buffer,然后在InnerLoop表(内部表)中直接匹配这10行数据，内存循环就可以一次与这10行进行比较, 这样只需要比较10次，对内部表的扫描减少了9/10。所以BNL算法就能够显著减少内层循环表扫描的次数。</span></p><h2><a name="spring-bean的生命周期" class="md-header-anchor"></a><span>Spring bean的生命周期</span></h2><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>9</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">首先读取配置文件实例化bean</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">然后设置对象的属性</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">检查有没有实现了*Aware接口，实现了就调用对应的方法 比如实现了BeanNameAware就调用setBeanName()方法，传入Bean的名字</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">如果有BeanPostProcessor对象，就执行里面的before方法</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">如果实现了InitializingBean接口， 就调用afeterPropertiesSet()方法</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">然后在执行init-method指定的方法</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">再执行BeanPostProcessor的after方法</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">然后要销毁的时候实现了DisposableBean，就执行destroy()方法</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">如果配置了destroy-method属性，就执行对象的方法，bean就销毁了</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 234px;"></div><div class="CodeMirror-gutters" style="height: 234px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h2><a name="seata执行流程" class="md-header-anchor"></a><span>Seata执行流程</span></h2><ul><li><span>首先TM向TC申请开启一个全局事务，全局事务创建成功并生成全局唯一的XID</span></li><li><span>XID在微服务调用链路的上下文中传播</span></li><li><span>RM开始执行这个分支事务，首先会解析这条SQL语句生成对应的UNDO_LOG记录，里面包含分支事务id，全局事务id等用来回滚</span></li><li><span>RM会在本地事务中执行业务SQL和UNDO_LOG的插入。在提交这个事务之前会向TC申请这行记录的全局锁。如果申请不到就说明正在别其他事务修改，然后就会在一段时间重试，重试失败则回滚本地事务并告诉TC执行失败了。</span></li><li><span>申请到全局锁之后就直接提交本地事务并告诉TC执行成功，但是不会释放全局锁，全局锁的释放取决于第二阶段是提交还是回滚</span></li><li><span>TC根据所有分支事务的执行结果，向RM下发提交或者回滚。如果收到提交命令，首先释放全局锁，然后把提交请求放入一个异步任务队列中，把提交成功的结果返回给TC，提交请求里其实就只是吧undo_log记录删除</span></li><li><span>如果接受到的是回滚命令，将会根据undo_log中的记录生成回滚语句进行回滚，然后才释放锁</span></li></ul><h2><a name="feign远程调用原理-n1117" class="md-header-anchor"></a><span>Feign远程调用原理</span></h2><ul><li><span>首先会扫描所有</span><code>@FeignClients</code><span>注解修饰的类然后被调用的时候通过JDK动态代理生成代理类，把代理类注入到ioc容器中，由代理类去进行调用。针对代理类的调用都会转发给</span><code>InvocationHandler</code><span>进行处理, 用这个Handler完成转换，发送接收，翻译HTTP响应等工作。当HTTP请求出现IO异常时，Feign内置了一个重试器，会有一个最大尝试次数发送请求。Feign真正发送请求的是交给client来做，默认使用的是JDK自带的</span><code>HttpURLConnection</code><span>，之所以默认的性能差是因为每次发送都会创建一个这个对象，可以使用</span><code>Apache HttpClient</code><span> 或者其他的来替换。</span></li></ul><p><img src="../img/image-20211103211857837.png" referrerpolicy="no-referrer" alt="image-20211103211857837"><span> </span></p><h2><a name="rabbitmq相关" class="md-header-anchor"></a><span>Rabbitmq相关</span></h2><h4><a name="rabbitmq重复消费" class="md-header-anchor"></a><span>Rabbitmq重复消费</span></h4><blockquote><p><span>场景： 统计pv/uv的时候，数据量比较大，然后中间消费者宕机了，然后再次启动消费者的时候就会继续消费宕机时的那条数据，就重复消费了</span></p><p><span>rabbitmq发消息过来带一个全局id，然后在监听到消息的时候先判断redis有没有这个消息id，没有的话就消费，有的话就丢弃</span></p></blockquote><h4><a name="rabbitmq可靠传输丢失消息问题" class="md-header-anchor"></a><span>Rabbitmq可靠传输，丢失消息问题</span></h4><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>5</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">使用Confirm模式，发送方确认模式</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">使用接收方确认模式就是手动ack</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">队列，交换机，消息都持久化</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">当使用手动ack的时候，如果返回false或者拒绝消息，消息就会回到队列头部然后重新发送，如此往复，就会造成死循环。然后导致消息堆积，正常的消息无法消费。此时应该ack，然后重新发送消息，这样消息就到了队列的尾部了。</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 156px;"></div><div class="CodeMirror-gutters" style="height: 156px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h4><a name="rabbitmq消息堆积或者mq快满了" class="md-header-anchor"></a><span>Rabbitmq消息堆积或者MQ快满了</span></h4><ul><li><span>增加消费者</span></li><li><span>默认消费是串行消费的，改成并行消费，有两个重要参数concurrentConsumers，prefetchCount。var1是设置并发消费者的个数，var2是设置每次从队列里面取出多少条消息</span></li><li><span>先启动消费者，然后写一个临时分发程序，把旧topic数据分发到新topic，新topic容量要比旧topic大，然后让多个消费者来消费，消费完之后再把架构恢复到原来的样子正常消费</span></li></ul><h4><a name="保证rabbitmq的消息的顺序性" class="md-header-anchor"></a><span>保证RabbitMQ的消息的顺序性</span></h4><ul><li><p><span>原因： 首先顺序不对的原因是因为一个队列对应多个消费者，消息分发到不同的消费者就乱套了。</span></p></li><li><p><span>解决方案：</span></p><ul><li><span>第一种可以使用一个队列对应一个消费者来解决，但是如果中间某个消息出问题造成消息重新入队就会打乱顺序。</span></li><li><span>第二种在一个就是给消息编号，用一个字段去记录顺序。当消费者接受到一条消息首先看有没有带上一条消息的id，没有就正常消费然保存起来。如果有带就看数据库中这条消息有没有被消费，没有消费就过段时间在查一次，如果还是没有就重新入队，如果上条消息已经消费了这条就可以正常消费</span></li></ul></li></ul><h4><a name="消息投递过程" class="md-header-anchor"></a><span>消息投递过程</span></h4><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>4</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">生产者连接到broker，建立connection和channel，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">然后初始化交换机和队列，设置是否持久化等属性，通过路由键把交换机和队列绑定，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">然后把消息发到broker，根据路由键匹配队列，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">匹配了就存在对列中，没匹配就丢弃或者退回给生产者，然后关闭channel和connection</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 104px;"></div><div class="CodeMirror-gutters" style="height: 104px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h4><a name="消息接受过程" class="md-header-anchor"></a><span>消息接受过程</span></h4><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>2</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">连接rabbitmq broker 然后建立connection channel，然后消费订阅队列中的消息，使用ack告诉rabbitmq消息消费了，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">然后从队列中删除消息，然后关闭channel， connection</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="height: 52px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h4><a name="消息确认机制事务confirm）" class="md-header-anchor"></a><span>消息确认机制（事务+Confirm）</span></h4><h6><a name="事务" class="md-header-anchor"></a><span>事务</span><span>	</span></h6><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>2</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rabbitmq中跟事务有关的方法有三个，txSelect(), txCommit(), txRollback(),第一个用于把channel设置成transaction模式，第二个用来提交事务，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">第三个用来回滚事务，如果提交成功了就说明消息到了borker，如果出现异常就可以回滚事务。事务方式会降低rabbitmq性能</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 78px;"></div><div class="CodeMirror-gutters" style="height: 78px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h6><a name="confirm模式" class="md-header-anchor"></a><span>Confirm模式</span></h6><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>2</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">设置成confirm模式，生产者发送消息到borker，在这个channel上发的消息都会带上一个从1开始的唯一id，borker收到之后会发送一个确认给生产者，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">里面包含了唯一id，生产者就知道消息投递到了，好处就是confirm是异步的，不用等待上一条信息，发送消息后成功或者失败都会进回调方法，然后处理该消息.</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 104px;"></div><div class="CodeMirror-gutters" style="height: 104px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre><h2><a name="zookeeper相关" class="md-header-anchor"></a><span>Zookeeper相关</span></h2><h4><a name="watch机制" class="md-header-anchor"></a><span>watch机制</span></h4><ul><li><span>首先把watcher注册到zkServer中，然后吧watcher添加到watchManager中，当zkServer中的节点发生改变的时候，就会触发回调，通知到watcher</span></li></ul><h4><a name="集群角色" class="md-header-anchor"></a><span>集群角色</span></h4><ul><li><span>有leader，follower，observer三个角色，第一个是领导，提供读写操作，负责投票的发起和决议 ，第二个是追随者，提供读服务，参与投票，</span>
<span>第三个为客户端提供读服务，不参与投票，如果是写服务就转发给leader。</span></li></ul><h4><a name="集群中的服务器状态" class="md-header-anchor"></a><span>集群中的服务器状态</span></h4><ul><li><span>LOOKING: 寻找leader</span></li><li><span>LEADING: leader状态，对应节点是leader</span></li><li><span>FOLLOWING: following状态，对应节点是follower</span></li><li><span>OBSERVING: observer状态，对应节点是observer，不参与投票</span></li></ul><h4><a name="集群选举过程" class="md-header-anchor"></a><span>集群选举过程</span></h4><h6><a name="当网络中断或者崩溃后就会进入选举分四个阶段" class="md-header-anchor"></a><span>当网络中断或者崩溃后就会进入选举，分四个阶段</span></h6><ul><li><p><span>选举阶段：所有节点一开始都处于选举节点，投票超过半数就可以成为准leader节点</span></p></li><li><p><span>发现阶段：follower跟准leader进行通信，同步follower最接接受的事务提议</span></p></li><li><p><span>同步阶段：主要是leader吧上个阶段得到的提议历史同步到集群中的所有副本，同步完成后才成为真正的leader</span></p></li><li><p><span>广播阶段：使用zab协议进行广播，这个阶段zk集群才能对外提供服务，leader可以进行消息广播，当新的节点加入的时候也要同步数据</span></p><h6><a name="原理" class="md-header-anchor"></a><span>原理： </span></h6><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>2</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">刚开始每个server都会投一票给自己，票的结构是(服务器的logicClock, myid, zxid),收到外部选票后，首先比较zxid，大的作为leader，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zxid相同就比较myid，myid大的作为leader，然后更新自身选票。超过半数之后leader进入LEADING状态，follower进入FOLLOWING状态</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 78px;"></div><div class="CodeMirror-gutters" style="height: 78px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre></li></ul><h4><a name="zab协议" class="md-header-anchor"></a><span>zab协议</span></h4><h5><a name="zk中集群通过zab协议原子广播来保证数据一致性支持崩溃恢复和恢复数据一致性步骤如下" class="md-header-anchor"></a><span>zk中集群通过zab协议(原子广播)来保证数据一致性，支持崩溃恢复和恢复数据一致性。步骤如下：</span></h5><ol start='' ><li><span>客户端向leader发写请求</span></li><li><span>leader将写请求已proposal的形式发给所有follower并等待ack</span></li><li><span>follower收到后返回ack</span></li><li><span>leader得到超过半数ack(leader自己有一个)，就像后面的follower，observer发送commit</span></li><li><span>leader把处理结果返回给客户端</span></li></ol><h2><a name="其他" class="md-header-anchor"></a><span>其他</span></h2><h3><a name="刷新网关路由" class="md-header-anchor"></a><span>刷新网关路由</span></h3><ul><li><span>继承路由定位器，实现refresh方法，然后refresh方法中调用了doRefresh，其实是调用了locateRoutes方法，</span>
<span>然后在实现locateRoutes方法，在这里面从数据库查询路由信息，然后加上路由前缀，然后在返回。</span>
<span>然后添加一个刷新接口，刷新接口主要是用到了监听器，发布一个事件，然后监听到之后就刷新。</span></li></ul><h3><a name="动态数据源" class="md-header-anchor"></a><span>动态数据源</span></h3><ul><li><span>首先自定义一个注解，里面有个key表示是master还是slave，然后存到threadLocal中。然后继承AbstractRoutingDataSource用来切换数据源，重写一个方法返回threadLocal中的key，然后配置数据源，把两个数据源配置好加入到继承了AbstractRoutingDataSource的类中，</span>
<span>他是AbstractRoutingDataSource的子类可以设置默认数据源，还有一个数据源map。最后使用的数据源是map中key和AbstractRoutingDataSource实现类中返回的key相同的那个数据源。</span></li></ul><h3><a name="设计模式" class="md-header-anchor"></a><span>设计模式</span></h3><ul><li><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 31px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 27px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>8</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -27px; width: 27px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">单例：spring中的bean默认都是单例</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">工厂： 项目中响应对象使用工厂模式构建</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">代理： jdk动态代理cglib代理</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">适配器： springmvc的处理适配器，</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">模板方法： spring中的jdbctemplate等都是模板方法模式</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">策略： 用来消除代码中的if else，有八种工单，每种工单都继承一个父类，有一个获取工单信息方法，然后通过构造方法传入上下文中，注入上下文，调用方法</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 18px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">责任链： tomcat中的过滤链，security的filter都是</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -27px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 18px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">观察者： spring的refresh()中使用到了，Spring 事件驱动模型就是观察者模式很经典的一个应用。</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 234px;"></div><div class="CodeMirror-gutters" style="height: 234px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 26px;"></div></div></div></div></pre></li></ul><h3><a name="关于高并发下的秒杀方案" class="md-header-anchor"></a><span>关于高并发下的秒杀方案</span></h3><ol start='' ><li><span>首先把商品存放到redis中，key为商品id，value为库存数量。</span></li><li><span>然后只有当用户提交订单的时候才减少库存，为了防止用户恶意下单，重复提交，使用redis来保证幂等性，</span>
<span>往redis中存一个key，过期时间一分钟，一分钟之内只能提交一次，或者前端设置点击一次按钮变灰，后续在恢复。</span></li><li><span>从redis中获取key，然后判断key的increment，跟购买数量比较，如果小于购买数量就取消订单。大于购买数量就执行，</span></li><li><span>等用户支付完成，然后再使用乐观锁修改数据库，减少库存。如果用户取消支付，则把库存加回去</span></li><li><span>订单跟库存可以使用分布式事务来保证一致</span></li></ol><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 832px; left: 109px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 35px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">集合框架源码</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hasmap原理</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  红黑树</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">多线程</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">数据结构</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">常用设计模式</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">JVM内存模型，垃圾回收机制</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MYSQL主从复制，读写分离，索引优化</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  mysqI索引结构,特点，为什么使用这个</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  b+树</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  关于mysql索引</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  mysql底层原理</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  mysql join底层原理</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  Mysql的锁</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  mvcc的实现</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">redis数据结构，主从复制，哨兵模式，分布式锁</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mybatis，mybatis-plus</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">spring</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  spring bean的加载过程</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">springboot注解原理，run方法原理</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">security</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gateway &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">feign </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hystrix </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nacos &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">seata</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">dubbo </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zookeeper </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zuul</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rabbitmq</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">定时任务xxl-job</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 26px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">布隆过滤器</span></pre></div><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -35px; width: 35px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -35px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 26px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">锁升级过程</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 858px;"></div><div class="CodeMirror-gutters" style="height: 858px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 34px;"></div></div></div></div></pre><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p></div>
</body>
</html>